(function(ve,ae){typeof exports=="object"&&typeof module<"u"?ae(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],ae):(ve=typeof globalThis<"u"?globalThis:ve||self,ae(ve["react-marzipano"]={},ve.react))})(this,function(ve,ae){"use strict";function Co(e,t){for(var r=0;r<t.length;r++){const i=t[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in e)){const a=Object.getOwnPropertyDescriptor(i,n);a&&Object.defineProperty(e,n,a.get?a:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function So(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Po(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}),r}function Ft(){}Ft.prototype.addEventListener=function(e,t){var r=this.__events=this.__events||{},i=r[e]=r[e]||[];i.indexOf(t)<0&&i.push(t)},Ft.prototype.removeEventListener=function(e,t){var r=this.__events=this.__events||{},i=r[e];if(i){var n=i.indexOf(t);n>=0&&i.splice(n,1)}},Ft.prototype.emit=function(e,t){var r=this.__events=this.__events||{},i=r[e],n=Array.prototype.slice.call(arguments,1);if(i)for(var a=0;a<i.length;a++){var s=i[a];s.apply(this,n)}};function Lo(e){for(var t in Ft.prototype)Ft.prototype.hasOwnProperty(t)&&(e.prototype[t]=Ft.prototype[t])}var se=Lo;function Ro(){return typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return Date.now()}}var gt=Ro(),wn=gt;function $o(e,t){this.fn=e,this.cb=t,this.cfn=null}function Qe(e){this._queue=[],this._delay=e&&e.delay||0,this._paused=e&&!!e.paused||!1,this._currentTask=null,this._lastFinished=null}Qe.prototype.length=function(){return this._queue.length},Qe.prototype.push=function(e,t){var r=new $o(e,t),i=this._cancel.bind(this,r);return this._queue.push(r),this._next(),i},Qe.prototype.pause=function(){this._paused||(this._paused=!0)},Qe.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},Qe.prototype._start=function(e){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=e;var t=this._finish.bind(this,e);if(e.cfn=e.fn(t),typeof e.cfn!="function")throw new Error("WorkQueue: function is not cancellable")},Qe.prototype._finish=function(e){var t=Array.prototype.slice.call(arguments,1);if(this._currentTask!==e)throw new Error("WorkQueue: called finish on wrong task");e.cb.apply(null,t),this._currentTask=null,this._lastFinished=wn(),this._next()},Qe.prototype._cancel=function(e){var t=Array.prototype.slice.call(arguments,1);if(this._currentTask===e)e.cfn.apply(null,t);else{var r=this._queue.indexOf(e);r>=0&&(this._queue.splice(r,1),e.cb.apply(null,t))}},Qe.prototype._next=function(){if(!this._paused&&this._queue.length&&!this._currentTask){if(this._lastFinished!=null){var e=wn()-this._lastFinished,t=this._delay-e;if(t>0){setTimeout(this._next.bind(this),t);return}}var r=this._queue.shift();this._start(r)}};var xn=Qe;function Ao(e,t,r,i){i=i||{};var n;r!=null&&r.absoluteWidth!=null?n=r.absoluteWidth/e:r!=null&&r.relativeWidth!=null?n=r.relativeWidth:n=1;var a;r&&r.absoluteHeight!=null?a=r.absoluteHeight/t:r!=null&&r.relativeHeight!=null?a=r.relativeHeight:a=1;var s;r!=null&&r.absoluteX!=null?s=r.absoluteX/e:r!=null&&r.relativeX!=null?s=r.relativeX:s=0;var o;return r!=null&&r.absoluteY!=null?o=r.absoluteY/t:r!=null&&r.relativeY!=null?o=r.relativeY:o=0,i.x=s,i.y=o,i.width=n,i.height=a,i}var Mn=Ao;function zo(e){return function(r){var i,n;try{n=e()}catch(a){i=a}finally{i?r(i):r(null,n)}}}var En=zo;function Oo(e){var t=!1,r;return function(){return t||(t=!0,r=e.apply(null,arguments)),r}}var vi=Oo,Io=vi;function Do(e){return function(){if(!arguments.length)throw new Error("cancelized: expected at least one argument");var r=Array.prototype.slice.call(arguments,0),i=r[r.length-1]=Io(r[r.length-1]);function n(){i.apply(null,arguments)}return e.apply(null,r),n}}var Tn=Do;function Ho(e){for(var t in e)e.hasOwnProperty(t)&&(e[t]=void 0)}var ie=Ho;function fi(){this._renderers={}}fi.prototype.set=function(e,t,r){this._renderers[e]||(this._renderers[e]={}),this._renderers[e][t]=r},fi.prototype.get=function(e,t){var r=this._renderers[e]&&this._renderers[e][t];return r||null};var Fo=fi,Vo=se,No=xn,ko=Mn,jo=En,Wo=Tn,Yo=ie,qo=Fo;function Xo(e,t){return e.cmp(t)}function Uo(e,t){return-e.cmp(t)}function J(e){this._progressive=!!(e&&e.progressive),this._layers=[],this._renderers=[],this._tilesToLoad=[],this._tilesToRender=[],this._tmpVisible=[],this._tmpChildren=[],this._width=0,this._height=0,this._tmpRect={},this._tmpSize={},this._createTextureWorkQueue=new No,this._emitRenderInvalid=this._emitRenderInvalid.bind(this),this._rendererRegistry=new qo}Vo(J),J.prototype.destroy=function(){this.removeAllLayers(),Yo(this)},J.prototype.registerRenderer=function(e,t,r){return this._rendererRegistry.set(e,t,r)},J.prototype.domElement=function(){throw new Error("Stage implementation must override domElement")},J.prototype.width=function(){return this._width},J.prototype.height=function(){return this._height},J.prototype.size=function(e){return e=e||{},e.width=this._width,e.height=this._height,e},J.prototype.setSize=function(e){this._width=e.width,this._height=e.height,this.setSizeForType(),this.emit("resize"),this._emitRenderInvalid()},J.prototype.setSizeForType=function(e){throw new Error("Stage implementation must override setSizeForType")},J.prototype.loadImage=function(){throw new Error("Stage implementation must override loadImage")},J.prototype._emitRenderInvalid=function(){this.emit("renderInvalid")},J.prototype.validateLayer=function(e){throw new Error("Stage implementation must override validateLayer")},J.prototype.listLayers=function(){return[].concat(this._layers)},J.prototype.hasLayer=function(e){return this._layers.indexOf(e)>=0},J.prototype.addLayer=function(e,t){if(this._layers.indexOf(e)>=0)throw new Error("Layer already in stage");if(t==null&&(t=this._layers.length),t<0||t>this._layers.length)throw new Error("Invalid layer position");this.validateLayer(e);var r=e.geometry().type,i=e.view().type,n=this._rendererRegistry.get(r,i);if(!n)throw new Error("No "+this.type+" renderer avaiable for "+r+" geometry and "+i+" view");var a=this.createRenderer(n);this._layers.splice(t,0,e),this._renderers.splice(t,0,a),e.addEventListener("viewChange",this._emitRenderInvalid),e.addEventListener("effectsChange",this._emitRenderInvalid),e.addEventListener("fixedLevelChange",this._emitRenderInvalid),e.addEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},J.prototype.moveLayer=function(e,t){var r=this._layers.indexOf(e);if(r<0)throw new Error("No such layer in stage");if(t<0||t>=this._layers.length)throw new Error("Invalid layer position");e=this._layers.splice(r,1)[0];var i=this._renderers.splice(r,1)[0];this._layers.splice(t,0,e),this._renderers.splice(t,0,i),this._emitRenderInvalid()},J.prototype.removeLayer=function(e){var t=this._layers.indexOf(e);if(t<0)throw new Error("No such layer in stage");var r=this._layers.splice(t,1)[0],i=this._renderers.splice(t,1)[0];this.destroyRenderer(i),r.removeEventListener("viewChange",this._emitRenderInvalid),r.removeEventListener("effectsChange",this._emitRenderInvalid),r.removeEventListener("fixedLevelChange",this._emitRenderInvalid),r.removeEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},J.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},J.prototype.startFrame=function(){throw new Error("Stage implementation must override startFrame")},J.prototype.endFrame=function(){throw new Error("Stage implementation must override endFrame")},J.prototype.render=function(){var e,t,r=this._tilesToLoad,i=this._tilesToRender,n=!0,a,s=this._width,o=this._height,h=this._tmpRect,l=this._tmpSize;if(!(s<=0||o<=0)){for(this.startFrame(),e=0;e<this._layers.length;e++)this._layers[e].textureStore().startFrame();for(e=0;e<this._layers.length;e++){var c=this._layers[e],f=c.effects(),u=c.view(),p=c.textureStore(),m=this._renderers[e],x=this._layers.length-e,y,M;if(ko(s,o,f&&f.rect,h),!(h.width<=0||h.height<=0)){for(l.width=h.width*this._width,l.height=h.height*this._height,u.setSize(l),m.startLayer(c,h),a=this._collectTiles(c,p),t=0;t<r.length;t++)y=r[t],p.markTile(y);for(t=0;t<i.length;t++)y=i[t],M=p.texture(y),m.renderTile(y,M,c,x);c.emit("renderComplete",a),a||(n=!1),m.endLayer(c,h)}}for(e=0;e<this._layers.length;e++)this._layers[e].textureStore().endFrame();this.endFrame(),this.emit("renderComplete",n)}},J.prototype._collectTiles=function(e,t){var r=this._tilesToLoad,i=this._tilesToRender,n=this._tmpVisible;r.length=0,i.length=0,n.length=0,e.visibleTiles(n);for(var a=!0,s=0;s<n.length;s++){var o=n[s],h;this._collectTileToLoad(o),t.texture(o)?(h=!1,this._collectTileToRender(o)):(h=this._collectChildren(o,t),a=!1),this._collectParents(o,t,h)}return r.sort(Xo),i.sort(Uo),a},J.prototype._collectChildren=function(e,t){var r=this._tmpChildren,i=!0;do{if(r.length=0,!e.children(r))break;i=!1;for(var n=0;n<r.length;n++)e=r[n],t.texture(e)?(this._collectTileToLoad(e),this._collectTileToRender(e)):i=!0}while(i&&r.length===1);return i},J.prototype._collectParents=function(e,t,r){for(var i=this._progressive;(i||r)&&(e=e.parent())!=null;){if(r){if(t.texture(e))this._collectTileToRender(e),r=!1;else if(!this._progressive)continue}this._collectTileToLoad(e)||(i=!1)}return r},J.prototype._collectTileToLoad=function(e){return this._collectTileIntoList(e,this._tilesToLoad)},J.prototype._collectTileToRender=function(e){return this._collectTileIntoList(e,this._tilesToRender)},J.prototype._collectTileIntoList=function(e,t){for(var r=!1,i=0;i<t.length;i++)if(e.equals(t[i])){r=!0;break}return r||t.push(e),!r},J.prototype.createTexture=function(e,t,r){var i=this;function n(){return new i.TextureClass(i,e,t)}var a=Wo(jo(n));return this._createTextureWorkQueue.push(a,function(s,o){r(s,e,t,o)})};var Bo=J,Go=function(){return typeof window<"u"?window:typeof self<"u"?self:typeof ci<"u"?ci:null}(),bn=Go,Cn=bn,Zo=se,Ko=ie,ui={HTMLImageElement:["naturalWidth","naturalHeight"],HTMLCanvasElement:["width","height"],ImageBitmap:["width","height"]};function st(e){var t=!1;for(var r in ui)if(Cn[r]&&e instanceof Cn[r]){t=!0,this._widthProp=ui[r][0],this._heightProp=ui[r][1];break}if(!t)throw new Error("Unsupported pixel source");this._element=e}Zo(st),st.prototype.destroy=function(){Ko(this)},st.prototype.element=function(){return this._element},st.prototype.width=function(){return this._element[this._widthProp]},st.prototype.height=function(){return this._element[this._heightProp]},st.prototype.timestamp=function(){return 0},st.prototype.isDynamic=function(){return!1};var di=st;function Qo(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}var je=Qo,Jo=je;function Sn(e){this.constructor.super_.apply(this,arguments),this.message=e}Jo(Sn,Error);var Pn=Sn,Ln={exports:{}};/*!
 * Bowser - a browser detector
 * https://github.com/ded/bowser
 * MIT License | (c) Dustin Diaz 2015
 */(function(e){(function(t,r,i){e.exports?e.exports=i():t[r]=i()})(ci,"bowser",function(){var t=!0;function r(l){function c($e){var Me=l.match($e);return Me&&Me.length>1&&Me[1]||""}function f($e){var Me=l.match($e);return Me&&Me.length>1&&Me[2]||""}var u=c(/(ipod|iphone|ipad)/i).toLowerCase(),p=/like android/i.test(l),m=!p&&/android/i.test(l),x=/nexus\s*[0-6]\s*/i.test(l),y=!x&&/nexus\s*[0-9]+/i.test(l),M=/CrOS/.test(l),b=/silk/i.test(l),L=/sailfish/i.test(l),R=/tizen/i.test(l),$=/(web|hpw)(o|0)s/i.test(l),P=/windows phone/i.test(l),k=!P&&/windows/i.test(l),X=!u&&!b&&/macintosh/i.test(l),j=!m&&!L&&!R&&!$&&/linux/i.test(l),W=f(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),D=c(/version\/(\d+(\.\d+)?)/i),U=/tablet/i.test(l)&&!/tablet pc/i.test(l),Y=!U&&/[^-]mobi/i.test(l),z=/xbox/i.test(l),w;/opera/i.test(l)?w={name:"Opera",opera:t,version:D||c(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(l)?w={name:"Opera",opera:t,version:c(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||D}:/SamsungBrowser/i.test(l)?w={name:"Samsung Internet for Android",samsungBrowser:t,version:D||c(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(l)?w={name:"NAVER Whale browser",whale:t,version:c(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(l)?w={name:"MZ Browser",mzbrowser:t,version:c(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(l)?w={name:"Opera Coast",coast:t,version:D||c(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(l)?w={name:"Focus",focus:t,version:c(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(l)?w={name:"Yandex Browser",yandexbrowser:t,version:D||c(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(l)?w={name:"UC Browser",ucbrowser:t,version:c(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(l)?w={name:"Maxthon",maxthon:t,version:c(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(l)?w={name:"Epiphany",epiphany:t,version:c(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(l)?w={name:"Puffin",puffin:t,version:c(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(l)?w={name:"Sleipnir",sleipnir:t,version:c(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(l)?w={name:"K-Meleon",kMeleon:t,version:c(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:P?(w={name:"Windows Phone",osname:"Windows Phone",windowsphone:t},W?(w.msedge=t,w.version=W):(w.msie=t,w.version=c(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(l)?w={name:"Internet Explorer",msie:t,version:c(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:M?w={name:"Chrome",osname:"Chrome OS",chromeos:t,chromeBook:t,chrome:t,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(l)?w={name:"Microsoft Edge",msedge:t,version:W}:/vivaldi/i.test(l)?w={name:"Vivaldi",vivaldi:t,version:c(/vivaldi\/(\d+(\.\d+)?)/i)||D}:L?w={name:"Sailfish",osname:"Sailfish OS",sailfish:t,version:c(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(l)?w={name:"SeaMonkey",seamonkey:t,version:c(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(l)?(w={name:"Firefox",firefox:t,version:c(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(l)&&(w.firefoxos=t,w.osname="Firefox OS")):b?w={name:"Amazon Silk",silk:t,version:c(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(l)?w={name:"PhantomJS",phantom:t,version:c(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(l)?w={name:"SlimerJS",slimer:t,version:c(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(l)||/rim\stablet/i.test(l)?w={name:"BlackBerry",osname:"BlackBerry OS",blackberry:t,version:D||c(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:$?(w={name:"WebOS",osname:"WebOS",webos:t,version:D||c(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(l)&&(w.touchpad=t)):/bada/i.test(l)?w={name:"Bada",osname:"Bada",bada:t,version:c(/dolfin\/(\d+(\.\d+)?)/i)}:R?w={name:"Tizen",osname:"Tizen",tizen:t,version:c(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||D}:/qupzilla/i.test(l)?w={name:"QupZilla",qupzilla:t,version:c(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||D}:/chromium/i.test(l)?w={name:"Chromium",chromium:t,version:c(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||D}:/chrome|crios|crmo/i.test(l)?w={name:"Chrome",chrome:t,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:m?w={name:"Android",version:D}:/safari|applewebkit/i.test(l)?(w={name:"Safari",safari:t},D&&(w.version=D)):u?(w={name:u=="iphone"?"iPhone":u=="ipad"?"iPad":"iPod"},D&&(w.version=D)):/googlebot/i.test(l)?w={name:"Googlebot",googlebot:t,version:c(/googlebot\/(\d+(\.\d+))/i)||D}:w={name:c(/^(.*)\/(.*) /),version:f(/^(.*)\/(.*) /)},!w.msedge&&/(apple)?webkit/i.test(l)?(/(apple)?webkit\/537\.36/i.test(l)?(w.name=w.name||"Blink",w.blink=t):(w.name=w.name||"Webkit",w.webkit=t),!w.version&&D&&(w.version=D)):!w.opera&&/gecko\//i.test(l)&&(w.name=w.name||"Gecko",w.gecko=t,w.version=w.version||c(/gecko\/(\d+(\.\d+)?)/i)),!w.windowsphone&&(m||w.silk)?(w.android=t,w.osname="Android"):!w.windowsphone&&u?(w[u]=t,w.ios=t,w.osname="iOS"):X?(w.mac=t,w.osname="macOS"):z?(w.xbox=t,w.osname="Xbox"):k?(w.windows=t,w.osname="Windows"):j&&(w.linux=t,w.osname="Linux");function Oe($e){switch($e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}var re="";w.windows?re=Oe(c(/Windows ((NT|XP)( \d\d?.\d)?)/i)):w.windowsphone?re=c(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):w.mac?(re=c(/Mac OS X (\d+([_\.\s]\d+)*)/i),re=re.replace(/[_\s]/g,".")):u?(re=c(/os (\d+([_\s]\d+)*) like mac os x/i),re=re.replace(/[_\s]/g,".")):m?re=c(/android[ \/-](\d+(\.\d+)*)/i):w.webos?re=c(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):w.blackberry?re=c(/rim\stablet\sos\s(\d+(\.\d+)*)/i):w.bada?re=c(/bada\/(\d+(\.\d+)*)/i):w.tizen&&(re=c(/tizen[\/\s](\d+(\.\d+)*)/i)),re&&(w.osversion=re);var Be=!w.windows&&re.split(".")[0];return U||y||u=="ipad"||m&&(Be==3||Be>=4&&!Y)||w.silk?w.tablet=t:(Y||u=="iphone"||u=="ipod"||m||x||w.blackberry||w.webos||w.bada)&&(w.mobile=t),w.msedge||w.msie&&w.version>=10||w.yandexbrowser&&w.version>=15||w.vivaldi&&w.version>=1||w.chrome&&w.version>=20||w.samsungBrowser&&w.version>=4||w.whale&&s([w.version,"1.0"])===1||w.mzbrowser&&s([w.version,"6.0"])===1||w.focus&&s([w.version,"1.0"])===1||w.firefox&&w.version>=20||w.safari&&w.version>=6||w.opera&&w.version>=10||w.ios&&w.osversion&&w.osversion.split(".")[0]>=6||w.blackberry&&w.version>=10.1||w.chromium&&w.version>=20?w.a=t:w.msie&&w.version<10||w.chrome&&w.version<20||w.firefox&&w.version<20||w.safari&&w.version<6||w.opera&&w.version<10||w.ios&&w.osversion&&w.osversion.split(".")[0]<6||w.chromium&&w.version<20?w.c=t:w.x=t,w}var i=r(typeof navigator<"u"&&navigator.userAgent||"");i.test=function(l){for(var c=0;c<l.length;++c){var f=l[c];if(typeof f=="string"&&f in i)return!0}return!1};function n(l){return l.split(".").length}function a(l,c){var f=[],u;if(Array.prototype.map)return Array.prototype.map.call(l,c);for(u=0;u<l.length;u++)f.push(c(l[u]));return f}function s(l){for(var c=Math.max(n(l[0]),n(l[1])),f=a(l,function(u){var p=c-n(u);return u=u+new Array(p+1).join(".0"),a(u.split("."),function(m){return new Array(20-m.length).join("0")+m}).reverse()});--c>=0;){if(f[0][c]>f[1][c])return 1;if(f[0][c]===f[1][c]){if(c===0)return 0}else return-1}}function o(l,c,f){var u=i;typeof c=="string"&&(f=c,c=void 0),c===void 0&&(c=!1),f&&(u=r(f));var p=""+u.version;for(var m in l)if(l.hasOwnProperty(m)&&u[m]){if(typeof l[m]!="string")throw new Error("Browser version in the minVersion map should be a string: "+m+": "+String(l));return s([p,l[m]])<0}return c}function h(l,c,f){return!o(l,c,f)}return i.isUnsupportedBrowser=o,i.compareVersions=s,i.check=h,i._detect=r,i.detect=r,i})})(Ln);var pi=Ln.exports,_i=di,eh=Pn,th=pi,Rn=bn,rh=vi,ih=!!Rn.createImageBitmap&&!th.firefox,nh={imageOrientation:"flipY",premultiplyAlpha:"premultiply"};function Lr(e){this._stage=e}Lr.prototype.loadImage=function(e,t,r){var i=this,n=new Image;n.crossOrigin="anonymous";var a=t&&t.x||0,s=t&&t.y||0,o=t&&t.width||1,h=t&&t.height||1;r=rh(r),n.onload=function(){i._handleLoad(n,a,s,o,h,r)},n.onerror=function(){i._handleError(e,r)},n.src=e;function l(){n.onload=n.onerror=null,n.src="",r.apply(null,arguments)}return l},Lr.prototype._handleLoad=function(e,t,r,i,n,a){if(t===0&&r===0&&i===1&&n===1){a(null,new _i(e));return}if(t*=e.naturalWidth,r*=e.naturalHeight,i*=e.naturalWidth,n*=e.naturalHeight,ih)Rn.createImageBitmap(e,t,r,i,n,nh).then(function(h){a(null,new _i(h))});else{var s=document.createElement("canvas");s.width=i,s.height=n;var o=s.getContext("2d");o.drawImage(e,t,r,i,n,0,0,i,n),a(null,new _i(s))}},Lr.prototype._handleError=function(e,t){t(new eh("Network error: "+e))};var ah=Lr,sh=1;function oh(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var e=window.screen;if(e&&e.deviceXDPI&&e.logicalXDPI)return e.deviceXDPI/e.logicalXDPI;if(e&&e.systemXDPI&&e.logicalXDPI)return e.systemXDPI/e.logicalXDPI}return sh}var Rr=oh;function hh(e){return(e&e-1)==0}var lh=hh;function mi(e){for(var t=document.documentElement.style,r=["Moz","Webkit","Khtml","O","ms"],i=0;i<r.length;i++){var n=r[i],a=e[0].toUpperCase()+e.slice(1),s=n+a;if(s in t)return s}return e}function ch(e){var t=mi(e);return function(i){return i.style[t]}}function yi(e){var t=mi(e);return function(i,n){return i.style[t]=n}}var $n=yi("transform"),An=yi("transformOrigin");function vh(e){$n(e,"translateZ(0)")}function fh(e){An(e,"0 0 0")}function uh(e){e.style.position="absolute"}function dh(e,t,r){e.style.left=t+"px",e.style.top=r+"px"}function ph(e,t,r){e.style.width=t+"px",e.style.height=r+"px"}function _h(e){e.style.width=e.style.height=0}function mh(e){e.style.width=e.style.height="100%"}function yh(e){e.style.overflow="hidden"}function gh(e){e.style.overflow="visible"}function wh(e){e.style.pointerEvents="none"}var Pe={prefixProperty:mi,getWithVendorPrefix:ch,setWithVendorPrefix:yi,setTransform:$n,setTransformOrigin:An,setNullTransform:vh,setNullTransformOrigin:fh,setAbsolute:uh,setPixelPosition:dh,setPixelSize:ph,setNullSize:_h,setFullSize:mh,setOverflowHidden:yh,setOverflowVisible:gh,setNoPointerEvents:wh},xh=Bo,Mh=ah,Eh=pi,Th=je,bh=Rr,zn=lh,Ch=Pe.setAbsolute,Sh=Pe.setFullSize,Ph=ie,Lh={videoUseTexImage2D:Eh.chrome};function Rh(e,t){var r={alpha:!0,premultipliedAlpha:!0,antialias:!!(t&&t.antialias),preserveDrawingBuffer:!!(t&&t.preserveDrawingBuffer)},i=e.getContext&&(e.getContext("webgl",r)||e.getContext("experimental-webgl",r));if(!i)throw new Error("Could not get WebGL context");return t.wrapContext&&(i=t.wrapContext(i)),i}function pe(e){e=e||{};var t=this;this.constructor.super_.call(this,e),this._generateMipmaps=e.generateMipmaps!=null?e.generateMipmaps:!1,this._loader=new Mh(this),this._domElement=document.createElement("canvas"),Ch(this._domElement),Sh(this._domElement),this._gl=Rh(this._domElement,e),this._handleContextLoss=function(){t.emit("webglcontextlost"),t._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=[]}Th(pe,xh),pe.prototype.destroy=function(){this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this.constructor.super_.prototype.destroy.call(this)},pe.prototype.domElement=function(){return this._domElement},pe.prototype.webGlContext=function(){return this._gl},pe.prototype.setSizeForType=function(){var e=bh();this._domElement.width=e*this._width,this._domElement.height=e*this._height},pe.prototype.loadImage=function(e,t,r){return this._loader.loadImage(e,t,r)},pe.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},pe.prototype.validateLayer=function(e){var t=e.geometry().maxTileSize(),r=this.maxTextureSize();if(t>r)throw new Error("Layer has level with tile size larger than maximum texture size ("+t+" vs. "+r+")")},pe.prototype.createRenderer=function(e){for(var t=this._rendererInstances,r=0;r<t.length;r++)if(t[r]instanceof e)return t[r];var i=new e(this._gl);return t.push(i),i},pe.prototype.destroyRenderer=function(e){var t=this._rendererInstances;if(this._renderers.indexOf(e)<0){e.destroy();var r=t.indexOf(e);r>=0&&t.splice(r,1)}},pe.prototype.startFrame=function(){var e=this._gl;if(!e)throw new Error("Bad WebGL context - maybe context was lost?");e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)},pe.prototype.endFrame=function(){},pe.prototype.takeSnapshot=function(e){(typeof e!="object"||e==null)&&(e={});var t=e.quality;if(typeof t>"u"&&(t=75),typeof t!="number"||t<0||t>100)throw new Error("WebGLStage: Snapshot quality needs to be a number between 0 and 100");return this.render(),this._domElement.toDataURL("image/jpeg",t/100)},pe.type=pe.prototype.type="webgl";function gi(e,t,r){this._stage=e,this._gl=e._gl,this._texture=null,this._timestamp=null,this._width=this._height=null,this.refresh(t,r)}gi.prototype.refresh=function(e,t){var r=this._gl,i=this._stage,n,a=t.timestamp();if(a!==this._timestamp){var s=t.element(),o=t.width(),h=t.height();if(o!==this._width||h!==this._height){var l=i.maxTextureSize();if(o>l)throw new Error("Texture width larger than max size ("+o+" vs. "+l+")");if(h>l)throw new Error("Texture height larger than max size ("+h+" vs. "+l+")");this._texture&&r.deleteTexture(n),n=this._texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,n),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,s)}else n=this._texture,r.bindTexture(r.TEXTURE_2D,n),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s instanceof HTMLVideoElement&&Lh.videoUseTexImage2D?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,s):r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,s);i._generateMipmaps&&zn(o)&&zn(h)?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),this._timestamp=a,this._width=o,this._height=h}},gi.prototype.destroy=function(){this._texture&&this._gl.deleteTexture(this._texture),Ph(this)},pe.TextureClass=pe.prototype.TextureClass=gi;var On=pe,A=1e-6,N=typeof Float32Array<"u"?Float32Array:Array,Fe=Math.random;function $h(e){N=e}var Ah=Math.PI/180;function zh(e){return e*Ah}function Oh(e,t){return Math.abs(e-t)<=A*Math.max(1,Math.abs(e),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});const Ih=Object.freeze(Object.defineProperty({__proto__:null,get ARRAY_TYPE(){return N},EPSILON:A,RANDOM:Fe,equals:Oh,setMatrixArrayType:$h,toRadian:zh},Symbol.toStringTag,{value:"Module"}));function Dh(){var e=new N(4);return N!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function Hh(e){var t=new N(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Fh(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Vh(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Nh(e,t,r,i){var n=new N(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function kh(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function jh(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function Wh(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r*a-n*i;return s?(s=1/s,e[0]=a*s,e[1]=-i*s,e[2]=-n*s,e[3]=r*s,e):null}function Yh(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function qh(e){return e[0]*e[3]-e[2]*e[1]}function In(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],h=r[1],l=r[2],c=r[3];return e[0]=i*o+a*h,e[1]=n*o+s*h,e[2]=i*l+a*c,e[3]=n*l+s*c,e}function Xh(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=i*h+a*o,e[1]=n*h+s*o,e[2]=i*-o+a*h,e[3]=n*-o+s*h,e}function Uh(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],h=r[1];return e[0]=i*o,e[1]=n*o,e[2]=a*h,e[3]=s*h,e}function Bh(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function Gh(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function Zh(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Kh(e){return Math.hypot(e[0],e[1],e[2],e[3])}function Qh(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function Jh(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Dn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function el(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function tl(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=t[0],o=t[1],h=t[2],l=t[3];return Math.abs(r-s)<=A*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=A*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-h)<=A*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-l)<=A*Math.max(1,Math.abs(a),Math.abs(l))}function rl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function il(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}var nl=In,al=Dn;const sl=Object.freeze(Object.defineProperty({__proto__:null,LDU:Qh,add:Jh,adjoint:Yh,clone:Hh,copy:Fh,create:Dh,determinant:qh,equals:tl,exactEquals:el,frob:Kh,fromRotation:Bh,fromScaling:Gh,fromValues:Nh,identity:Vh,invert:Wh,mul:nl,multiply:In,multiplyScalar:rl,multiplyScalarAndAdd:il,rotate:Xh,scale:Uh,set:kh,str:Zh,sub:al,subtract:Dn,transpose:jh},Symbol.toStringTag,{value:"Module"}));function ol(){var e=new N(6);return N!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function hl(e){var t=new N(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ll(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function cl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function vl(e,t,r,i,n,a){var s=new N(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=n,s[5]=a,s}function fl(e,t,r,i,n,a,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e}function ul(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=r*a-i*n;return h?(h=1/h,e[0]=a*h,e[1]=-i*h,e[2]=-n*h,e[3]=r*h,e[4]=(n*o-a*s)*h,e[5]=(i*s-r*o)*h,e):null}function dl(e){return e[0]*e[3]-e[1]*e[2]}function Hn(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],l=r[0],c=r[1],f=r[2],u=r[3],p=r[4],m=r[5];return e[0]=i*l+a*c,e[1]=n*l+s*c,e[2]=i*f+a*u,e[3]=n*f+s*u,e[4]=i*p+a*m+o,e[5]=n*p+s*m+h,e}function pl(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],l=Math.sin(r),c=Math.cos(r);return e[0]=i*c+a*l,e[1]=n*c+s*l,e[2]=i*-l+a*c,e[3]=n*-l+s*c,e[4]=o,e[5]=h,e}function _l(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],l=r[0],c=r[1];return e[0]=i*l,e[1]=n*l,e[2]=a*c,e[3]=s*c,e[4]=o,e[5]=h,e}function ml(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],l=r[0],c=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=s,e[4]=i*l+a*c+o,e[5]=n*l+s*c+h,e}function yl(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function gl(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function wl(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function xl(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function Ml(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function El(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function Fn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function Tl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function bl(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function Cl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function Sl(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=t[0],l=t[1],c=t[2],f=t[3],u=t[4],p=t[5];return Math.abs(r-h)<=A*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-l)<=A*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-c)<=A*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-f)<=A*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-u)<=A*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(o-p)<=A*Math.max(1,Math.abs(o),Math.abs(p))}var Pl=Hn,Ll=Fn;const Rl=Object.freeze(Object.defineProperty({__proto__:null,add:El,clone:hl,copy:ll,create:ol,determinant:dl,equals:Sl,exactEquals:Cl,frob:Ml,fromRotation:yl,fromScaling:gl,fromTranslation:wl,fromValues:vl,identity:cl,invert:ul,mul:Pl,multiply:Hn,multiplyScalar:Tl,multiplyScalarAndAdd:bl,rotate:pl,scale:_l,set:fl,str:xl,sub:Ll,subtract:Fn,translate:ml},Symbol.toStringTag,{value:"Module"}));function Vn(){var e=new N(9);return N!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function $l(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Al(e){var t=new N(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function zl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ol(e,t,r,i,n,a,s,o,h){var l=new N(9);return l[0]=e,l[1]=t,l[2]=r,l[3]=i,l[4]=n,l[5]=a,l[6]=s,l[7]=o,l[8]=h,l}function Il(e,t,r,i,n,a,s,o,h,l){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=h,e[8]=l,e}function Dl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Hl(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Fl(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],l=t[7],c=t[8],f=c*s-o*l,u=-c*a+o*h,p=l*a-s*h,m=r*f+i*u+n*p;return m?(m=1/m,e[0]=f*m,e[1]=(-c*i+n*l)*m,e[2]=(o*i-n*s)*m,e[3]=u*m,e[4]=(c*r-n*h)*m,e[5]=(-o*r+n*a)*m,e[6]=p*m,e[7]=(-l*r+i*h)*m,e[8]=(s*r-i*a)*m,e):null}function Vl(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],l=t[7],c=t[8];return e[0]=s*c-o*l,e[1]=n*l-i*c,e[2]=i*o-n*s,e[3]=o*h-a*c,e[4]=r*c-n*h,e[5]=n*a-r*o,e[6]=a*l-s*h,e[7]=i*h-r*l,e[8]=r*s-i*a,e}function Nl(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],h=e[7],l=e[8];return t*(l*a-s*h)+r*(-l*n+s*o)+i*(h*n-a*o)}function Nn(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=t[8],u=r[0],p=r[1],m=r[2],x=r[3],y=r[4],M=r[5],b=r[6],L=r[7],R=r[8];return e[0]=u*i+p*s+m*l,e[1]=u*n+p*o+m*c,e[2]=u*a+p*h+m*f,e[3]=x*i+y*s+M*l,e[4]=x*n+y*o+M*c,e[5]=x*a+y*h+M*f,e[6]=b*i+L*s+R*l,e[7]=b*n+L*o+R*c,e[8]=b*a+L*h+R*f,e}function kl(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=t[8],u=r[0],p=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=s,e[4]=o,e[5]=h,e[6]=u*i+p*s+l,e[7]=u*n+p*o+c,e[8]=u*a+p*h+f,e}function jl(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=t[8],u=Math.sin(r),p=Math.cos(r);return e[0]=p*i+u*s,e[1]=p*n+u*o,e[2]=p*a+u*h,e[3]=p*s-u*i,e[4]=p*o-u*n,e[5]=p*h-u*a,e[6]=l,e[7]=c,e[8]=f,e}function Wl(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Yl(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function ql(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Xl(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ul(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Bl(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r+r,o=i+i,h=n+n,l=r*s,c=i*s,f=i*o,u=n*s,p=n*o,m=n*h,x=a*s,y=a*o,M=a*h;return e[0]=1-f-m,e[3]=c-M,e[6]=u+y,e[1]=c+M,e[4]=1-l-m,e[7]=p-x,e[2]=u-y,e[5]=p+x,e[8]=1-l-f,e}function Gl(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],l=t[7],c=t[8],f=t[9],u=t[10],p=t[11],m=t[12],x=t[13],y=t[14],M=t[15],b=r*o-i*s,L=r*h-n*s,R=r*l-a*s,$=i*h-n*o,P=i*l-a*o,k=n*l-a*h,X=c*x-f*m,j=c*y-u*m,W=c*M-p*m,D=f*y-u*x,U=f*M-p*x,Y=u*M-p*y,z=b*Y-L*U+R*D+$*W-P*j+k*X;return z?(z=1/z,e[0]=(o*Y-h*U+l*D)*z,e[1]=(h*W-s*Y-l*j)*z,e[2]=(s*U-o*W+l*X)*z,e[3]=(n*U-i*Y-a*D)*z,e[4]=(r*Y-n*W+a*j)*z,e[5]=(i*W-r*U-a*X)*z,e[6]=(x*k-y*P+M*$)*z,e[7]=(y*R-m*k-M*L)*z,e[8]=(m*P-x*R+M*b)*z,e):null}function Zl(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Kl(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Ql(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Jl(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function kn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function ec(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function tc(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function rc(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function ic(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],l=e[7],c=e[8],f=t[0],u=t[1],p=t[2],m=t[3],x=t[4],y=t[5],M=t[6],b=t[7],L=t[8];return Math.abs(r-f)<=A*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-u)<=A*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-p)<=A*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-m)<=A*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-x)<=A*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(o-y)<=A*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(h-M)<=A*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(l-b)<=A*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-L)<=A*Math.max(1,Math.abs(c),Math.abs(L))}var nc=Nn,ac=kn;const sc=Object.freeze(Object.defineProperty({__proto__:null,add:Jl,adjoint:Vl,clone:Al,copy:zl,create:Vn,determinant:Nl,equals:ic,exactEquals:rc,frob:Ql,fromMat2d:Ul,fromMat4:$l,fromQuat:Bl,fromRotation:ql,fromScaling:Xl,fromTranslation:Yl,fromValues:Ol,identity:Dl,invert:Fl,mul:nc,multiply:Nn,multiplyScalar:ec,multiplyScalarAndAdd:tc,normalFromMat4:Gl,projection:Zl,rotate:jl,scale:Wl,set:Il,str:Kl,sub:ac,subtract:kn,translate:kl,transpose:Hl},Symbol.toStringTag,{value:"Module"}));function oc(){var e=new N(16);return N!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function hc(e){var t=new N(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function lc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function cc(e,t,r,i,n,a,s,o,h,l,c,f,u,p,m,x){var y=new N(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=i,y[4]=n,y[5]=a,y[6]=s,y[7]=o,y[8]=h,y[9]=l,y[10]=c,y[11]=f,y[12]=u,y[13]=p,y[14]=m,y[15]=x,y}function vc(e,t,r,i,n,a,s,o,h,l,c,f,u,p,m,x,y){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=h,e[8]=l,e[9]=c,e[10]=f,e[11]=u,e[12]=p,e[13]=m,e[14]=x,e[15]=y,e}function jn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fc(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function uc(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],l=t[7],c=t[8],f=t[9],u=t[10],p=t[11],m=t[12],x=t[13],y=t[14],M=t[15],b=r*o-i*s,L=r*h-n*s,R=r*l-a*s,$=i*h-n*o,P=i*l-a*o,k=n*l-a*h,X=c*x-f*m,j=c*y-u*m,W=c*M-p*m,D=f*y-u*x,U=f*M-p*x,Y=u*M-p*y,z=b*Y-L*U+R*D+$*W-P*j+k*X;return z?(z=1/z,e[0]=(o*Y-h*U+l*D)*z,e[1]=(n*U-i*Y-a*D)*z,e[2]=(x*k-y*P+M*$)*z,e[3]=(u*P-f*k-p*$)*z,e[4]=(h*W-s*Y-l*j)*z,e[5]=(r*Y-n*W+a*j)*z,e[6]=(y*R-m*k-M*L)*z,e[7]=(c*k-u*R+p*L)*z,e[8]=(s*U-o*W+l*X)*z,e[9]=(i*W-r*U-a*X)*z,e[10]=(m*P-x*R+M*b)*z,e[11]=(f*R-c*P-p*b)*z,e[12]=(o*j-s*D-h*X)*z,e[13]=(r*D-i*j+n*X)*z,e[14]=(x*L-m*$-y*b)*z,e[15]=(c*$-f*L+u*b)*z,e):null}function dc(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],l=t[7],c=t[8],f=t[9],u=t[10],p=t[11],m=t[12],x=t[13],y=t[14],M=t[15];return e[0]=o*(u*M-p*y)-f*(h*M-l*y)+x*(h*p-l*u),e[1]=-(i*(u*M-p*y)-f*(n*M-a*y)+x*(n*p-a*u)),e[2]=i*(h*M-l*y)-o*(n*M-a*y)+x*(n*l-a*h),e[3]=-(i*(h*p-l*u)-o*(n*p-a*u)+f*(n*l-a*h)),e[4]=-(s*(u*M-p*y)-c*(h*M-l*y)+m*(h*p-l*u)),e[5]=r*(u*M-p*y)-c*(n*M-a*y)+m*(n*p-a*u),e[6]=-(r*(h*M-l*y)-s*(n*M-a*y)+m*(n*l-a*h)),e[7]=r*(h*p-l*u)-s*(n*p-a*u)+c*(n*l-a*h),e[8]=s*(f*M-p*x)-c*(o*M-l*x)+m*(o*p-l*f),e[9]=-(r*(f*M-p*x)-c*(i*M-a*x)+m*(i*p-a*f)),e[10]=r*(o*M-l*x)-s*(i*M-a*x)+m*(i*l-a*o),e[11]=-(r*(o*p-l*f)-s*(i*p-a*f)+c*(i*l-a*o)),e[12]=-(s*(f*y-u*x)-c*(o*y-h*x)+m*(o*u-h*f)),e[13]=r*(f*y-u*x)-c*(i*y-n*x)+m*(i*u-n*f),e[14]=-(r*(o*y-h*x)-s*(i*y-n*x)+m*(i*h-n*o)),e[15]=r*(o*u-h*f)-s*(i*u-n*f)+c*(i*h-n*o),e}function pc(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],h=e[7],l=e[8],c=e[9],f=e[10],u=e[11],p=e[12],m=e[13],x=e[14],y=e[15],M=t*s-r*a,b=t*o-i*a,L=t*h-n*a,R=r*o-i*s,$=r*h-n*s,P=i*h-n*o,k=l*m-c*p,X=l*x-f*p,j=l*y-u*p,W=c*x-f*m,D=c*y-u*m,U=f*y-u*x;return M*U-b*D+L*W+R*j-$*X+P*k}function Wn(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=t[8],u=t[9],p=t[10],m=t[11],x=t[12],y=t[13],M=t[14],b=t[15],L=r[0],R=r[1],$=r[2],P=r[3];return e[0]=L*i+R*o+$*f+P*x,e[1]=L*n+R*h+$*u+P*y,e[2]=L*a+R*l+$*p+P*M,e[3]=L*s+R*c+$*m+P*b,L=r[4],R=r[5],$=r[6],P=r[7],e[4]=L*i+R*o+$*f+P*x,e[5]=L*n+R*h+$*u+P*y,e[6]=L*a+R*l+$*p+P*M,e[7]=L*s+R*c+$*m+P*b,L=r[8],R=r[9],$=r[10],P=r[11],e[8]=L*i+R*o+$*f+P*x,e[9]=L*n+R*h+$*u+P*y,e[10]=L*a+R*l+$*p+P*M,e[11]=L*s+R*c+$*m+P*b,L=r[12],R=r[13],$=r[14],P=r[15],e[12]=L*i+R*o+$*f+P*x,e[13]=L*n+R*h+$*u+P*y,e[14]=L*a+R*l+$*p+P*M,e[15]=L*s+R*c+$*m+P*b,e}function _c(e,t,r){var i=r[0],n=r[1],a=r[2],s,o,h,l,c,f,u,p,m,x,y,M;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*a+t[12],e[13]=t[1]*i+t[5]*n+t[9]*a+t[13],e[14]=t[2]*i+t[6]*n+t[10]*a+t[14],e[15]=t[3]*i+t[7]*n+t[11]*a+t[15]):(s=t[0],o=t[1],h=t[2],l=t[3],c=t[4],f=t[5],u=t[6],p=t[7],m=t[8],x=t[9],y=t[10],M=t[11],e[0]=s,e[1]=o,e[2]=h,e[3]=l,e[4]=c,e[5]=f,e[6]=u,e[7]=p,e[8]=m,e[9]=x,e[10]=y,e[11]=M,e[12]=s*i+c*n+m*a+t[12],e[13]=o*i+f*n+x*a+t[13],e[14]=h*i+u*n+y*a+t[14],e[15]=l*i+p*n+M*a+t[15]),e}function mc(e,t,r){var i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function yc(e,t,r,i){var n=i[0],a=i[1],s=i[2],o=Math.hypot(n,a,s),h,l,c,f,u,p,m,x,y,M,b,L,R,$,P,k,X,j,W,D,U,Y,z,w;return o<A?null:(o=1/o,n*=o,a*=o,s*=o,h=Math.sin(r),l=Math.cos(r),c=1-l,f=t[0],u=t[1],p=t[2],m=t[3],x=t[4],y=t[5],M=t[6],b=t[7],L=t[8],R=t[9],$=t[10],P=t[11],k=n*n*c+l,X=a*n*c+s*h,j=s*n*c-a*h,W=n*a*c-s*h,D=a*a*c+l,U=s*a*c+n*h,Y=n*s*c+a*h,z=a*s*c-n*h,w=s*s*c+l,e[0]=f*k+x*X+L*j,e[1]=u*k+y*X+R*j,e[2]=p*k+M*X+$*j,e[3]=m*k+b*X+P*j,e[4]=f*W+x*D+L*U,e[5]=u*W+y*D+R*U,e[6]=p*W+M*D+$*U,e[7]=m*W+b*D+P*U,e[8]=f*Y+x*z+L*w,e[9]=u*Y+y*z+R*w,e[10]=p*Y+M*z+$*w,e[11]=m*Y+b*z+P*w,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function gc(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],s=t[5],o=t[6],h=t[7],l=t[8],c=t[9],f=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+l*i,e[5]=s*n+c*i,e[6]=o*n+f*i,e[7]=h*n+u*i,e[8]=l*n-a*i,e[9]=c*n-s*i,e[10]=f*n-o*i,e[11]=u*n-h*i,e}function wc(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],h=t[3],l=t[8],c=t[9],f=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-l*i,e[1]=s*n-c*i,e[2]=o*n-f*i,e[3]=h*n-u*i,e[8]=a*i+l*n,e[9]=s*i+c*n,e[10]=o*i+f*n,e[11]=h*i+u*n,e}function xc(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],h=t[3],l=t[4],c=t[5],f=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+l*i,e[1]=s*n+c*i,e[2]=o*n+f*i,e[3]=h*n+u*i,e[4]=l*n-a*i,e[5]=c*n-s*i,e[6]=f*n-o*i,e[7]=u*n-h*i,e}function Mc(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ec(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tc(e,t,r){var i=r[0],n=r[1],a=r[2],s=Math.hypot(i,n,a),o,h,l;return s<A?null:(s=1/s,i*=s,n*=s,a*=s,o=Math.sin(t),h=Math.cos(t),l=1-h,e[0]=i*i*l+h,e[1]=n*i*l+a*o,e[2]=a*i*l-n*o,e[3]=0,e[4]=i*n*l-a*o,e[5]=n*n*l+h,e[6]=a*n*l+i*o,e[7]=0,e[8]=i*a*l+n*o,e[9]=n*a*l-i*o,e[10]=a*a*l+h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function bc(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Cc(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sc(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yn(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=i+i,h=n+n,l=a+a,c=i*o,f=i*h,u=i*l,p=n*h,m=n*l,x=a*l,y=s*o,M=s*h,b=s*l;return e[0]=1-(p+x),e[1]=f+b,e[2]=u-M,e[3]=0,e[4]=f-b,e[5]=1-(c+x),e[6]=m+y,e[7]=0,e[8]=u+M,e[9]=m-y,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Pc(e,t){var r=new N(3),i=-t[0],n=-t[1],a=-t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=i*i+n*n+a*a+s*s;return f>0?(r[0]=(o*s+c*i+h*a-l*n)*2/f,r[1]=(h*s+c*n+l*i-o*a)*2/f,r[2]=(l*s+c*a+o*n-h*i)*2/f):(r[0]=(o*s+c*i+h*a-l*n)*2,r[1]=(h*s+c*n+l*i-o*a)*2,r[2]=(l*s+c*a+o*n-h*i)*2),Yn(e,t,r),e}function qn(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Xn(e,t){var r=t[0],i=t[1],n=t[2],a=t[4],s=t[5],o=t[6],h=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(a,s,o),e[2]=Math.hypot(h,l,c),e}function Un(e,t){var r=new N(3);Xn(r,t);var i=1/r[0],n=1/r[1],a=1/r[2],s=t[0]*i,o=t[1]*n,h=t[2]*a,l=t[4]*i,c=t[5]*n,f=t[6]*a,u=t[8]*i,p=t[9]*n,m=t[10]*a,x=s+c+m,y=0;return x>0?(y=Math.sqrt(x+1)*2,e[3]=.25*y,e[0]=(f-p)/y,e[1]=(u-h)/y,e[2]=(o-l)/y):s>c&&s>m?(y=Math.sqrt(1+s-c-m)*2,e[3]=(f-p)/y,e[0]=.25*y,e[1]=(o+l)/y,e[2]=(u+h)/y):c>m?(y=Math.sqrt(1+c-s-m)*2,e[3]=(u-h)/y,e[0]=(o+l)/y,e[1]=.25*y,e[2]=(f+p)/y):(y=Math.sqrt(1+m-s-c)*2,e[3]=(o-l)/y,e[0]=(u+h)/y,e[1]=(f+p)/y,e[2]=.25*y),e}function Lc(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3],h=n+n,l=a+a,c=s+s,f=n*h,u=n*l,p=n*c,m=a*l,x=a*c,y=s*c,M=o*h,b=o*l,L=o*c,R=i[0],$=i[1],P=i[2];return e[0]=(1-(m+y))*R,e[1]=(u+L)*R,e[2]=(p-b)*R,e[3]=0,e[4]=(u-L)*$,e[5]=(1-(f+y))*$,e[6]=(x+M)*$,e[7]=0,e[8]=(p+b)*P,e[9]=(x-M)*P,e[10]=(1-(f+m))*P,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Rc(e,t,r,i,n){var a=t[0],s=t[1],o=t[2],h=t[3],l=a+a,c=s+s,f=o+o,u=a*l,p=a*c,m=a*f,x=s*c,y=s*f,M=o*f,b=h*l,L=h*c,R=h*f,$=i[0],P=i[1],k=i[2],X=n[0],j=n[1],W=n[2],D=(1-(x+M))*$,U=(p+R)*$,Y=(m-L)*$,z=(p-R)*P,w=(1-(u+M))*P,Oe=(y+b)*P,re=(m+L)*k,Be=(y-b)*k,$e=(1-(u+x))*k;return e[0]=D,e[1]=U,e[2]=Y,e[3]=0,e[4]=z,e[5]=w,e[6]=Oe,e[7]=0,e[8]=re,e[9]=Be,e[10]=$e,e[11]=0,e[12]=r[0]+X-(D*X+z*j+re*W),e[13]=r[1]+j-(U*X+w*j+Be*W),e[14]=r[2]+W-(Y*X+Oe*j+$e*W),e[15]=1,e}function $c(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r+r,o=i+i,h=n+n,l=r*s,c=i*s,f=i*o,u=n*s,p=n*o,m=n*h,x=a*s,y=a*o,M=a*h;return e[0]=1-f-m,e[1]=c+M,e[2]=u-y,e[3]=0,e[4]=c-M,e[5]=1-l-m,e[6]=p+x,e[7]=0,e[8]=u+y,e[9]=p-x,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ac(e,t,r,i,n,a,s){var o=1/(r-t),h=1/(n-i),l=1/(a-s);return e[0]=a*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*h,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*h,e[10]=(s+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*l,e[15]=0,e}function zc(e,t,r,i,n){var a=1/Math.tan(t/2),s;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(s=1/(i-n),e[10]=(n+i)*s,e[14]=2*n*i*s):(e[10]=-1,e[14]=-2*i),e}function Oc(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),h=2/(s+o),l=2/(n+a);return e[0]=h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((s-o)*h*.5),e[9]=(n-a)*l*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function Ic(e,t,r,i,n,a,s){var o=1/(t-r),h=1/(i-n),l=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*h,e[14]=(s+a)*l,e[15]=1,e}function Dc(e,t,r,i){var n,a,s,o,h,l,c,f,u,p,m=t[0],x=t[1],y=t[2],M=i[0],b=i[1],L=i[2],R=r[0],$=r[1],P=r[2];return Math.abs(m-R)<A&&Math.abs(x-$)<A&&Math.abs(y-P)<A?jn(e):(c=m-R,f=x-$,u=y-P,p=1/Math.hypot(c,f,u),c*=p,f*=p,u*=p,n=b*u-L*f,a=L*c-M*u,s=M*f-b*c,p=Math.hypot(n,a,s),p?(p=1/p,n*=p,a*=p,s*=p):(n=0,a=0,s=0),o=f*s-u*a,h=u*n-c*s,l=c*a-f*n,p=Math.hypot(o,h,l),p?(p=1/p,o*=p,h*=p,l*=p):(o=0,h=0,l=0),e[0]=n,e[1]=o,e[2]=c,e[3]=0,e[4]=a,e[5]=h,e[6]=f,e[7]=0,e[8]=s,e[9]=l,e[10]=u,e[11]=0,e[12]=-(n*m+a*x+s*y),e[13]=-(o*m+h*x+l*y),e[14]=-(c*m+f*x+u*y),e[15]=1,e)}function Hc(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=i[0],h=i[1],l=i[2],c=n-r[0],f=a-r[1],u=s-r[2],p=c*c+f*f+u*u;p>0&&(p=1/Math.sqrt(p),c*=p,f*=p,u*=p);var m=h*u-l*f,x=l*c-o*u,y=o*f-h*c;return p=m*m+x*x+y*y,p>0&&(p=1/Math.sqrt(p),m*=p,x*=p,y*=p),e[0]=m,e[1]=x,e[2]=y,e[3]=0,e[4]=f*y-u*x,e[5]=u*m-c*y,e[6]=c*x-f*m,e[7]=0,e[8]=c,e[9]=f,e[10]=u,e[11]=0,e[12]=n,e[13]=a,e[14]=s,e[15]=1,e}function Fc(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Vc(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Nc(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Bn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function kc(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function jc(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function Wc(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Yc(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],l=e[7],c=e[8],f=e[9],u=e[10],p=e[11],m=e[12],x=e[13],y=e[14],M=e[15],b=t[0],L=t[1],R=t[2],$=t[3],P=t[4],k=t[5],X=t[6],j=t[7],W=t[8],D=t[9],U=t[10],Y=t[11],z=t[12],w=t[13],Oe=t[14],re=t[15];return Math.abs(r-b)<=A*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-L)<=A*Math.max(1,Math.abs(i),Math.abs(L))&&Math.abs(n-R)<=A*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(a-$)<=A*Math.max(1,Math.abs(a),Math.abs($))&&Math.abs(s-P)<=A*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(o-k)<=A*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(h-X)<=A*Math.max(1,Math.abs(h),Math.abs(X))&&Math.abs(l-j)<=A*Math.max(1,Math.abs(l),Math.abs(j))&&Math.abs(c-W)<=A*Math.max(1,Math.abs(c),Math.abs(W))&&Math.abs(f-D)<=A*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(u-U)<=A*Math.max(1,Math.abs(u),Math.abs(U))&&Math.abs(p-Y)<=A*Math.max(1,Math.abs(p),Math.abs(Y))&&Math.abs(m-z)<=A*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(x-w)<=A*Math.max(1,Math.abs(x),Math.abs(w))&&Math.abs(y-Oe)<=A*Math.max(1,Math.abs(y),Math.abs(Oe))&&Math.abs(M-re)<=A*Math.max(1,Math.abs(M),Math.abs(re))}var qc=Wn,Xc=Bn;const Uc=Object.freeze(Object.defineProperty({__proto__:null,add:Nc,adjoint:dc,clone:hc,copy:lc,create:oc,determinant:pc,equals:Yc,exactEquals:Wc,frob:Vc,fromQuat:$c,fromQuat2:Pc,fromRotation:Tc,fromRotationTranslation:Yn,fromRotationTranslationScale:Lc,fromRotationTranslationScaleOrigin:Rc,fromScaling:Ec,fromTranslation:Mc,fromValues:cc,fromXRotation:bc,fromYRotation:Cc,fromZRotation:Sc,frustum:Ac,getRotation:Un,getScaling:Xn,getTranslation:qn,identity:jn,invert:uc,lookAt:Dc,mul:qc,multiply:Wn,multiplyScalar:kc,multiplyScalarAndAdd:jc,ortho:Ic,perspective:zc,perspectiveFromFieldOfView:Oc,rotate:yc,rotateX:gc,rotateY:wc,rotateZ:xc,scale:mc,set:vc,str:Fc,sub:Xc,subtract:Bn,targetTo:Hc,translate:_c,transpose:fc},Symbol.toStringTag,{value:"Module"}));function wi(){var e=new N(3);return N!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Bc(e){var t=new N(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Gn(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function xi(e,t,r){var i=new N(3);return i[0]=e,i[1]=t,i[2]=r,i}function Gc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Zc(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function Kc(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Zn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Kn(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Qn(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Qc(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Jc(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function ev(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function tv(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function rv(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function iv(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function nv(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function Jn(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function ea(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function ta(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function av(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function sv(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function ra(e,t){var r=t[0],i=t[1],n=t[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Mi(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function $r(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],h=r[2];return e[0]=n*h-a*o,e[1]=a*s-i*h,e[2]=i*o-n*s,e}function ov(e,t,r,i){var n=t[0],a=t[1],s=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e}function hv(e,t,r,i,n,a){var s=a*a,o=s*(2*a-3)+1,h=s*(a-2)+a,l=s*(a-1),c=s*(3-2*a);return e[0]=t[0]*o+r[0]*h+i[0]*l+n[0]*c,e[1]=t[1]*o+r[1]*h+i[1]*l+n[1]*c,e[2]=t[2]*o+r[2]*h+i[2]*l+n[2]*c,e}function lv(e,t,r,i,n,a){var s=1-a,o=s*s,h=a*a,l=o*s,c=3*a*o,f=3*h*s,u=h*a;return e[0]=t[0]*l+r[0]*c+i[0]*f+n[0]*u,e[1]=t[1]*l+r[1]*c+i[1]*f+n[1]*u,e[2]=t[2]*l+r[2]*c+i[2]*f+n[2]*u,e}function cv(e,t){t=t||1;var r=Fe()*2*Math.PI,i=Fe()*2-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function vv(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[3]*i+r[7]*n+r[11]*a+r[15];return s=s||1,e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/s,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/s,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/s,e}function fv(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e}function uv(e,t,r){var i=r[0],n=r[1],a=r[2],s=r[3],o=t[0],h=t[1],l=t[2],c=n*l-a*h,f=a*o-i*l,u=i*h-n*o,p=n*u-a*f,m=a*c-i*u,x=i*f-n*c,y=s*2;return c*=y,f*=y,u*=y,p*=2,m*=2,x*=2,e[0]=o+c+p,e[1]=h+f+m,e[2]=l+u+x,e}function dv(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function pv(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function _v(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function mv(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],s=t[1],o=t[2],h=Math.sqrt(r*r+i*i+n*n),l=Math.sqrt(a*a+s*s+o*o),c=h*l,f=c&&Mi(e,t)/c;return Math.acos(Math.min(Math.max(f,-1),1))}function yv(e){return e[0]=0,e[1]=0,e[2]=0,e}function gv(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function wv(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function xv(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(r-a)<=A*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=A*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=A*Math.max(1,Math.abs(n),Math.abs(o))}var Mv=Zn,Ev=Kn,Tv=Qn,bv=Jn,Cv=ea,ia=Gn,Sv=ta,Pv=function(){var e=wi();return function(t,r,i,n,a,s){var o,h;for(r||(r=3),i||(i=0),n?h=Math.min(n*r+i,t.length):h=t.length,o=i;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}();const Lv=Object.freeze(Object.defineProperty({__proto__:null,add:Kc,angle:mv,bezier:lv,ceil:Qc,clone:Bc,copy:Gc,create:wi,cross:$r,dist:bv,distance:Jn,div:Tv,divide:Qn,dot:Mi,equals:xv,exactEquals:wv,floor:Jc,forEach:Pv,fromValues:xi,hermite:hv,inverse:sv,len:ia,length:Gn,lerp:ov,max:tv,min:ev,mul:Ev,multiply:Kn,negate:av,normalize:ra,random:cv,rotateX:dv,rotateY:pv,rotateZ:_v,round:rv,scale:iv,scaleAndAdd:nv,set:Zc,sqrDist:Cv,sqrLen:Sv,squaredDistance:ea,squaredLength:ta,str:gv,sub:Mv,subtract:Zn,transformMat3:fv,transformMat4:vv,transformQuat:uv,zero:yv},Symbol.toStringTag,{value:"Module"}));function na(){var e=new N(4);return N!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function aa(e){var t=new N(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function sa(e,t,r,i){var n=new N(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function oa(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ha(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function la(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function ca(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function va(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function fa(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Rv(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function $v(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Av(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function zv(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Ov(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function ua(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Iv(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function da(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.hypot(r,i,n,a)}function pa(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function Ei(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function Ti(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function Dv(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Hv(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function _a(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=i*s,e[2]=n*s,e[3]=a*s,e}function ma(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Fv(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],a=r[0]*i[2]-r[2]*i[0],s=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],h=r[1]*i[3]-r[3]*i[1],l=r[2]*i[3]-r[3]*i[2],c=t[0],f=t[1],u=t[2],p=t[3];return e[0]=f*l-u*h+p*o,e[1]=-(c*l)+u*s-p*a,e[2]=c*h-f*s+p*n,e[3]=-(c*o)+f*a-u*n,e}function ya(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e[3]=o+i*(r[3]-o),e}function Vv(e,t){t=t||1;var r,i,n,a,s,o;do r=Fe()*2-1,i=Fe()*2-1,s=r*r+i*i;while(s>=1);do n=Fe()*2-1,a=Fe()*2-1,o=n*n+a*a;while(o>=1);var h=Math.sqrt((1-s)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*n*h,e[3]=t*a*h,e}function Nv(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*s,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*s,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*s,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*s,e}function kv(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],h=r[2],l=r[3],c=l*i+o*a-h*n,f=l*n+h*i-s*a,u=l*a+s*n-o*i,p=-s*i-o*n-h*a;return e[0]=c*l+p*-s+f*-h-u*-o,e[1]=f*l+p*-o+u*-s-c*-h,e[2]=u*l+p*-h+c*-o-f*-s,e[3]=t[3],e}function jv(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Wv(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function ga(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function wa(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=t[0],o=t[1],h=t[2],l=t[3];return Math.abs(r-s)<=A*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=A*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-h)<=A*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-l)<=A*Math.max(1,Math.abs(a),Math.abs(l))}var Yv=ca,qv=va,Xv=fa,Uv=da,Bv=pa,Gv=Ei,Zv=Ti,Kv=function(){var e=na();return function(t,r,i,n,a,s){var o,h;for(r||(r=4),i||(i=0),n?h=Math.min(n*r+i,t.length):h=t.length,o=i;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();const Qv=Object.freeze(Object.defineProperty({__proto__:null,add:la,ceil:Rv,clone:aa,copy:oa,create:na,cross:Fv,dist:Uv,distance:da,div:Xv,divide:fa,dot:ma,equals:wa,exactEquals:ga,floor:$v,forEach:Kv,fromValues:sa,inverse:Hv,len:Gv,length:Ei,lerp:ya,max:zv,min:Av,mul:qv,multiply:va,negate:Dv,normalize:_a,random:Vv,round:Ov,scale:ua,scaleAndAdd:Iv,set:ha,sqrDist:Bv,sqrLen:Zv,squaredDistance:pa,squaredLength:Ti,str:Wv,sub:Yv,subtract:ca,transformMat4:Nv,transformQuat:kv,zero:jv},Symbol.toStringTag,{value:"Module"}));function Ar(){var e=new N(4);return N!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Jv(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function xa(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function ef(e,t){var r=Math.acos(t[3])*2,i=Math.sin(r/2);return i>A?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function tf(e,t){var r=Ci(e,t);return Math.acos(2*r*r-1)}function Ma(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],h=r[1],l=r[2],c=r[3];return e[0]=i*c+s*o+n*l-a*h,e[1]=n*c+s*h+a*o-i*l,e[2]=a*c+s*l+i*h-n*o,e[3]=s*c-i*o-n*h-a*l,e}function Ea(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=i*h+s*o,e[1]=n*h+a*o,e[2]=a*h-n*o,e[3]=s*h-i*o,e}function Ta(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=i*h-a*o,e[1]=n*h+s*o,e[2]=a*h+i*o,e[3]=s*h-n*o,e}function ba(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=i*h+n*o,e[1]=n*h-i*o,e[2]=a*h+s*o,e[3]=s*h-a*o,e}function rf(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function Ca(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=Math.sqrt(r*r+i*i+n*n),o=Math.exp(a),h=s>0?o*Math.sin(s)/s:0;return e[0]=r*h,e[1]=i*h,e[2]=n*h,e[3]=o*Math.cos(s),e}function Sa(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=Math.sqrt(r*r+i*i+n*n),o=s>0?Math.atan2(s,a)/s:0;return e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=.5*Math.log(r*r+i*i+n*n+a*a),e}function nf(e,t,r){return Sa(e,t),La(e,e,r),Ca(e,e),e}function zr(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3],h=r[0],l=r[1],c=r[2],f=r[3],u,p,m,x,y;return p=n*h+a*l+s*c+o*f,p<0&&(p=-p,h=-h,l=-l,c=-c,f=-f),1-p>A?(u=Math.acos(p),m=Math.sin(u),x=Math.sin((1-i)*u)/m,y=Math.sin(i*u)/m):(x=1-i,y=i),e[0]=x*n+y*h,e[1]=x*a+y*l,e[2]=x*s+y*c,e[3]=x*o+y*f,e}function af(e){var t=Fe(),r=Fe(),i=Fe(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*i),e[3]=a*Math.cos(2*Math.PI*i),e}function sf(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a,o=s?1/s:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=a*o,e}function of(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Pa(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[a*3+a]-t[s*3+s]+1),e[n]=.5*i,i=.5/i,e[3]=(t[a*3+s]-t[s*3+a])*i,e[a]=(t[a*3+n]+t[n*3+a])*i,e[s]=(t[s*3+n]+t[n*3+s])*i}return e}function hf(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var a=Math.sin(t),s=Math.cos(t),o=Math.sin(r),h=Math.cos(r),l=Math.sin(i),c=Math.cos(i);return e[0]=a*h*c-s*o*l,e[1]=s*o*c+a*h*l,e[2]=s*h*l-a*o*c,e[3]=s*h*c+a*o*l,e}function lf(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var cf=aa,vf=sa,bi=oa,ff=ha,uf=la,df=Ma,La=ua,Ci=ma,pf=ya,Si=Ei,_f=Si,Pi=Ti,mf=Pi,Li=_a,yf=ga,gf=wa,wf=function(){var e=wi(),t=xi(1,0,0),r=xi(0,1,0);return function(i,n,a){var s=Mi(n,a);return s<-.999999?($r(e,t,n),ia(e)<1e-6&&$r(e,r,n),ra(e,e),xa(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):($r(e,n,a),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,Li(i,i))}}(),xf=function(){var e=Ar(),t=Ar();return function(r,i,n,a,s,o){return zr(e,i,s,o),zr(t,n,a,o),zr(r,e,t,2*o*(1-o)),r}}(),Mf=function(){var e=Vn();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Li(t,Pa(t,e))}}();const Ef=Object.freeze(Object.defineProperty({__proto__:null,add:uf,calculateW:rf,clone:cf,conjugate:of,copy:bi,create:Ar,dot:Ci,equals:gf,exactEquals:yf,exp:Ca,fromEuler:hf,fromMat3:Pa,fromValues:vf,getAngle:tf,getAxisAngle:ef,identity:Jv,invert:sf,len:_f,length:Si,lerp:pf,ln:Sa,mul:df,multiply:Ma,normalize:Li,pow:nf,random:af,rotateX:Ea,rotateY:Ta,rotateZ:ba,rotationTo:wf,scale:La,set:ff,setAxes:Mf,setAxisAngle:xa,slerp:zr,sqlerp:xf,sqrLen:mf,squaredLength:Pi,str:lf},Symbol.toStringTag,{value:"Module"}));function Tf(){var e=new N(8);return N!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function bf(e){var t=new N(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Cf(e,t,r,i,n,a,s,o){var h=new N(8);return h[0]=e,h[1]=t,h[2]=r,h[3]=i,h[4]=n,h[5]=a,h[6]=s,h[7]=o,h}function Sf(e,t,r,i,n,a,s){var o=new N(8);o[0]=e,o[1]=t,o[2]=r,o[3]=i;var h=n*.5,l=a*.5,c=s*.5;return o[4]=h*i+l*r-c*t,o[5]=l*i+c*e-h*r,o[6]=c*i+h*t-l*e,o[7]=-h*e-l*t-c*r,o}function Ra(e,t,r){var i=r[0]*.5,n=r[1]*.5,a=r[2]*.5,s=t[0],o=t[1],h=t[2],l=t[3];return e[0]=s,e[1]=o,e[2]=h,e[3]=l,e[4]=i*l+n*h-a*o,e[5]=n*l+a*s-i*h,e[6]=a*l+i*o-n*s,e[7]=-i*s-n*o-a*h,e}function Pf(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0]*.5,e[5]=t[1]*.5,e[6]=t[2]*.5,e[7]=0,e}function Lf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Rf(e,t){var r=Ar();Un(r,t);var i=new N(3);return qn(i,t),Ra(e,r,i),e}function $a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function $f(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Af(e,t,r,i,n,a,s,o,h){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=h,e}var zf=bi;function Of(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var If=bi;function Df(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Hf(e,t){var r=t[4],i=t[5],n=t[6],a=t[7],s=-t[0],o=-t[1],h=-t[2],l=t[3];return e[0]=(r*l+a*s+i*h-n*o)*2,e[1]=(i*l+a*o+n*s-r*h)*2,e[2]=(n*l+a*h+r*o-i*s)*2,e}function Ff(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=r[0]*.5,h=r[1]*.5,l=r[2]*.5,c=t[4],f=t[5],u=t[6],p=t[7];return e[0]=i,e[1]=n,e[2]=a,e[3]=s,e[4]=s*o+n*l-a*h+c,e[5]=s*h+a*o-i*l+f,e[6]=s*l+i*h-n*o+u,e[7]=-i*o-n*h-a*l+p,e}function Vf(e,t,r){var i=-t[0],n=-t[1],a=-t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=o*s+c*i+h*a-l*n,u=h*s+c*n+l*i-o*a,p=l*s+c*a+o*n-h*i,m=c*s-o*i-h*n-l*a;return Ea(e,t,r),i=e[0],n=e[1],a=e[2],s=e[3],e[4]=f*s+m*i+u*a-p*n,e[5]=u*s+m*n+p*i-f*a,e[6]=p*s+m*a+f*n-u*i,e[7]=m*s-f*i-u*n-p*a,e}function Nf(e,t,r){var i=-t[0],n=-t[1],a=-t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=o*s+c*i+h*a-l*n,u=h*s+c*n+l*i-o*a,p=l*s+c*a+o*n-h*i,m=c*s-o*i-h*n-l*a;return Ta(e,t,r),i=e[0],n=e[1],a=e[2],s=e[3],e[4]=f*s+m*i+u*a-p*n,e[5]=u*s+m*n+p*i-f*a,e[6]=p*s+m*a+f*n-u*i,e[7]=m*s-f*i-u*n-p*a,e}function kf(e,t,r){var i=-t[0],n=-t[1],a=-t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=o*s+c*i+h*a-l*n,u=h*s+c*n+l*i-o*a,p=l*s+c*a+o*n-h*i,m=c*s-o*i-h*n-l*a;return ba(e,t,r),i=e[0],n=e[1],a=e[2],s=e[3],e[4]=f*s+m*i+u*a-p*n,e[5]=u*s+m*n+p*i-f*a,e[6]=p*s+m*a+f*n-u*i,e[7]=m*s-f*i-u*n-p*a,e}function jf(e,t,r){var i=r[0],n=r[1],a=r[2],s=r[3],o=t[0],h=t[1],l=t[2],c=t[3];return e[0]=o*s+c*i+h*a-l*n,e[1]=h*s+c*n+l*i-o*a,e[2]=l*s+c*a+o*n-h*i,e[3]=c*s-o*i-h*n-l*a,o=t[4],h=t[5],l=t[6],c=t[7],e[4]=o*s+c*i+h*a-l*n,e[5]=h*s+c*n+l*i-o*a,e[6]=l*s+c*a+o*n-h*i,e[7]=c*s-o*i-h*n-l*a,e}function Wf(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],h=r[1],l=r[2],c=r[3];return e[0]=i*c+s*o+n*l-a*h,e[1]=n*c+s*h+a*o-i*l,e[2]=a*c+s*l+i*h-n*o,e[3]=s*c-i*o-n*h-a*l,o=r[4],h=r[5],l=r[6],c=r[7],e[4]=i*c+s*o+n*l-a*h,e[5]=n*c+s*h+a*o-i*l,e[6]=a*c+s*l+i*h-n*o,e[7]=s*c-i*o-n*h-a*l,e}function Yf(e,t,r,i){if(Math.abs(i)<A)return $a(e,t);var n=Math.hypot(r[0],r[1],r[2]);i=i*.5;var a=Math.sin(i),s=a*r[0]/n,o=a*r[1]/n,h=a*r[2]/n,l=Math.cos(i),c=t[0],f=t[1],u=t[2],p=t[3];e[0]=c*l+p*s+f*h-u*o,e[1]=f*l+p*o+u*s-c*h,e[2]=u*l+p*h+c*o-f*s,e[3]=p*l-c*s-f*o-u*h;var m=t[4],x=t[5],y=t[6],M=t[7];return e[4]=m*l+M*s+x*h-y*o,e[5]=x*l+M*o+y*s-m*h,e[6]=y*l+M*h+m*o-x*s,e[7]=M*l-m*s-x*o-y*h,e}function qf(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e}function Aa(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=r[4],h=r[5],l=r[6],c=r[7],f=t[4],u=t[5],p=t[6],m=t[7],x=r[0],y=r[1],M=r[2],b=r[3];return e[0]=i*b+s*x+n*M-a*y,e[1]=n*b+s*y+a*x-i*M,e[2]=a*b+s*M+i*y-n*x,e[3]=s*b-i*x-n*y-a*M,e[4]=i*c+s*o+n*l-a*h+f*b+m*x+u*M-p*y,e[5]=n*c+s*h+a*o-i*l+u*b+m*y+p*x-f*M,e[6]=a*c+s*l+i*h-n*o+p*b+m*M+f*y-u*x,e[7]=s*c-i*o-n*h-a*l+m*b-f*x-u*y-p*M,e}var Xf=Aa;function Uf(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e}var za=Ci;function Bf(e,t,r,i){var n=1-i;return za(t,r)<0&&(i=-i),e[0]=t[0]*n+r[0]*i,e[1]=t[1]*n+r[1]*i,e[2]=t[2]*n+r[2]*i,e[3]=t[3]*n+r[3]*i,e[4]=t[4]*n+r[4]*i,e[5]=t[5]*n+r[5]*i,e[6]=t[6]*n+r[6]*i,e[7]=t[7]*n+r[7]*i,e}function Gf(e,t){var r=Or(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e}function Zf(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var Oa=Si,Kf=Oa,Or=Pi,Qf=Or;function Jf(e,t){var r=Or(t);if(r>0){r=Math.sqrt(r);var i=t[0]/r,n=t[1]/r,a=t[2]/r,s=t[3]/r,o=t[4],h=t[5],l=t[6],c=t[7],f=i*o+n*h+a*l+s*c;e[0]=i,e[1]=n,e[2]=a,e[3]=s,e[4]=(o-i*f)/r,e[5]=(h-n*f)/r,e[6]=(l-a*f)/r,e[7]=(c-s*f)/r}return e}function eu(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function tu(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function ru(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],l=e[7],c=t[0],f=t[1],u=t[2],p=t[3],m=t[4],x=t[5],y=t[6],M=t[7];return Math.abs(r-c)<=A*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-f)<=A*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-u)<=A*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-p)<=A*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-m)<=A*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(o-x)<=A*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(h-y)<=A*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(l-M)<=A*Math.max(1,Math.abs(l),Math.abs(M))}const iu=Object.freeze(Object.defineProperty({__proto__:null,add:qf,clone:bf,conjugate:Zf,copy:$a,create:Tf,dot:za,equals:ru,exactEquals:tu,fromMat4:Rf,fromRotation:Lf,fromRotationTranslation:Ra,fromRotationTranslationValues:Sf,fromTranslation:Pf,fromValues:Cf,getDual:Of,getReal:zf,getTranslation:Hf,identity:$f,invert:Gf,len:Kf,length:Oa,lerp:Bf,mul:Xf,multiply:Aa,normalize:Jf,rotateAroundAxis:Yf,rotateByQuatAppend:jf,rotateByQuatPrepend:Wf,rotateX:Vf,rotateY:Nf,rotateZ:kf,scale:Uf,set:Af,setDual:Df,setReal:If,sqrLen:Qf,squaredLength:Or,str:eu,translate:Ff},Symbol.toStringTag,{value:"Module"}));function Ia(){var e=new N(2);return N!=Float32Array&&(e[0]=0,e[1]=0),e}function nu(e){var t=new N(2);return t[0]=e[0],t[1]=e[1],t}function au(e,t){var r=new N(2);return r[0]=e,r[1]=t,r}function su(e,t){return e[0]=t[0],e[1]=t[1],e}function ou(e,t,r){return e[0]=t,e[1]=r,e}function hu(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Da(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Ha(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function Fa(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function lu(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function cu(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function vu(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function fu(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function uu(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function du(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function pu(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function Va(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.hypot(r,i)}function Na(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function ka(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function ja(e){var t=e[0],r=e[1];return t*t+r*r}function _u(e,t){return e[0]=-t[0],e[1]=-t[1],e}function mu(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function yu(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function gu(e,t){return e[0]*t[0]+e[1]*t[1]}function wu(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function xu(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e}function Mu(e,t){t=t||1;var r=Fe()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Eu(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function Tu(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function bu(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function Cu(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function Su(e,t,r,i){var n=t[0]-r[0],a=t[1]-r[1],s=Math.sin(i),o=Math.cos(i);return e[0]=n*o-a*s+r[0],e[1]=n*s+a*o+r[1],e}function Pu(e,t){var r=e[0],i=e[1],n=t[0],a=t[1],s=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+a*a),o=s&&(r*n+i*a)/s;return Math.acos(Math.min(Math.max(o,-1),1))}function Lu(e){return e[0]=0,e[1]=0,e}function Ru(e){return"vec2("+e[0]+", "+e[1]+")"}function $u(e,t){return e[0]===t[0]&&e[1]===t[1]}function Au(e,t){var r=e[0],i=e[1],n=t[0],a=t[1];return Math.abs(r-n)<=A*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-a)<=A*Math.max(1,Math.abs(i),Math.abs(a))}var zu=ka,Ou=Da,Iu=Ha,Du=Fa,Hu=Va,Fu=Na,Vu=ja,Nu=function(){var e=Ia();return function(t,r,i,n,a,s){var o,h;for(r||(r=2),i||(i=0),n?h=Math.min(n*r+i,t.length):h=t.length,o=i;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],a(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}}();const ye=Po(Object.freeze(Object.defineProperty({__proto__:null,glMatrix:Ih,mat2:sl,mat2d:Rl,mat3:sc,mat4:Uc,quat:Ef,quat2:iu,vec2:Object.freeze(Object.defineProperty({__proto__:null,add:hu,angle:Pu,ceil:lu,clone:nu,copy:su,create:Ia,cross:wu,dist:Hu,distance:Va,div:Du,divide:Fa,dot:gu,equals:Au,exactEquals:$u,floor:cu,forEach:Nu,fromValues:au,inverse:mu,len:zu,length:ka,lerp:xu,max:fu,min:vu,mul:Iu,multiply:Ha,negate:_u,normalize:yu,random:Mu,rotate:Su,round:uu,scale:du,scaleAndAdd:pu,set:ou,sqrDist:Fu,sqrLen:Vu,squaredDistance:Na,squaredLength:ja,str:Ru,sub:Ou,subtract:Da,transformMat2:Eu,transformMat2d:Tu,transformMat3:bu,transformMat4:Cu,zero:Lu},Symbol.toStringTag,{value:"Module"})),vec3:Lv,vec4:Qv},Symbol.toStringTag,{value:"Module"})));function ku(e,t,r){return Math.min(Math.max(e,t),r)}var Vt=ku,ju=256,Wa=256,Ir=Vt,Wu=ye.vec4,Dr=ye.vec3,Nt=ye.mat4;function Ya(e,t,r){var i=e.createShader(t);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw e.getShaderInfoLog(i);return i}function Yu(e,t,r,i,n){var a=Ya(e,e.VERTEX_SHADER,t),s=Ya(e,e.FRAGMENT_SHADER,r),o=e.createProgram();if(e.attachShader(o,a),e.attachShader(o,s),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw e.getProgramInfoLog(o);for(var h=0;h<i.length;h++){var l=i[h];if(o[l]=e.getAttribLocation(o,l),o[l]===-1)throw new Error("Shader program has no "+l+" attribute")}for(var c=0;c<n.length;c++){var f=n[c];if(o[f]=e.getUniformLocation(o,f),o[f]===-1)throw new Error("Shader program has no "+f+" uniform")}return o}function qu(e,t){for(var r=e.getAttachedShaders(t),i=0;i<r.length;i++){var n=r[i];e.detachShader(t,n),e.deleteShader(n)}e.deleteProgram(t)}function Ri(e,t,r,i){var n=e.createBuffer();return e.bindBuffer(t,n),e.bufferData(t,i,r),n}function Xu(e,t,r,i){return{vertexIndices:Ri(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW,new Uint16Array(t)),vertexPositions:Ri(e,e.ARRAY_BUFFER,e.STATIC_DRAW,new Float32Array(r)),textureCoords:Ri(e,e.ARRAY_BUFFER,e.STATIC_DRAW,new Float32Array(i))}}function Uu(e,t){e.deleteBuffer(t.vertexIndices),e.deleteBuffer(t.vertexPositions),e.deleteBuffer(t.textureCoords)}function Bu(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++)e.enableVertexAttribArray(i)}function Gu(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++)e.disableVertexAttribArray(i)}function Zu(e,t,r){e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r._texture),e.uniform1i(t.uSampler,0)}function Ku(e,t,r,i){var n=((r+1)*Wa-i)/(Wa*ju);e.uniform1f(t.uDepth,n)}var Qu=1,Ju=Wu.create(),qa=Nt.create();Nt.identity(qa);function ed(e,t,r){var i=Qu;t&&t.opacity!=null&&(i=t.opacity),e.uniform1f(r.opacity,i);var n=Ju;t&&t.colorOffset&&(n=t.colorOffset),e.uniform4fv(r.colorOffset,n);var a=qa;t&&t.colorMatrix&&(a=t.colorMatrix),e.uniformMatrix4fv(r.colorMatrix,!1,a)}var Xa=Dr.create(),Ua=Dr.create();function td(e,t,r,i){if(r.x===0&&r.width===1&&r.y===0&&r.height===1){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),Nt.identity(i);return}var n=r.x,a=Ir(n,0,1),s=a-n,o=1-a,h=Ir(r.width-s,0,o),l=r.width-h,c=1-r.height-r.y,f=Ir(c,0,1),u=f-c,p=1-f,m=Ir(r.height-u,0,p),x=r.height-m;Dr.set(Ua,r.width/h,r.height/m,1),Dr.set(Xa,(l-s)/h,(x-u)/m,0),Nt.identity(i),Nt.translate(i,i,Xa),Nt.scale(i,i,Ua),e.viewport(e.drawingBufferWidth*a,e.drawingBufferHeight*f,e.drawingBufferWidth*h,e.drawingBufferHeight*m)}var Ba={createShaderProgram:Yu,destroyShaderProgram:qu,createConstantBuffers:Xu,destroyConstantBuffers:Uu,enableAttributes:Bu,disableAttributes:Gu,setTexture:Zu,setDepth:Ku,setViewport:td,setupPixelEffectUniforms:ed},rd=["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uProjMatrix;","varying vec2 vTextureCoord;","void main(void) {","  gl_Position = uViewportMatrix * uProjMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);","  gl_Position.z = uDepth * gl_Position.w;","  vTextureCoord = aTextureCoord;","}"].join(`
`),id=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec2 vTextureCoord;","void main(void) {","  vec4 color = texture2D(uSampler, vTextureCoord) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join(`
`),wt=ye.mat4,Ga=ye.vec3,nd=ie,We=Ba,ad=We.createConstantBuffers,sd=We.destroyConstantBuffers,od=We.createShaderProgram,hd=We.destroyShaderProgram,ld=We.enableAttributes,cd=We.disableAttributes,vd=We.setViewport,fd=We.setupPixelEffectUniforms,ud=We.setDepth,dd=We.setTexture,pd=rd,_d=id,Za=[0,1,2,0,2,3],md=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],yd=[0,0,1,0,1,1,0,1],gd=["aVertexPosition","aTextureCoord"],wd=["uDepth","uOpacity","uSampler","uProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix"];function Jt(e){this.gl=e,this.projMatrix=wt.create(),this.viewportMatrix=wt.create(),this.translateVector=Ga.create(),this.scaleVector=Ga.create(),this.constantBuffers=ad(e,Za,md,yd),this.shaderProgram=od(e,pd,_d,gd,wd)}Jt.prototype.destroy=function(){sd(this.gl,this.constantBuffers),hd(this.gl,this.shaderProgram),nd(this)},Jt.prototype.startLayer=function(e,t){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,a=this.viewportMatrix;r.useProgram(i),ld(r,i),vd(r,e,t,a),r.uniformMatrix4fv(i.uViewportMatrix,!1,a),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),r.vertexAttribPointer(i.aTextureCoord,2,r.FLOAT,r.FALSE,0,0),fd(r,e.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},Jt.prototype.endLayer=function(e,t){var r=this.gl,i=this.shaderProgram;cd(r,i)},Jt.prototype.renderTile=function(e,t,r,i){var n=this.gl,a=this.shaderProgram,s=this.constantBuffers,o=this.projMatrix,h=this.translateVector,l=this.scaleVector;h[0]=e.centerX(),h[1]=e.centerY(),h[2]=-.5,l[0]=e.scaleX(),l[1]=e.scaleY(),l[2]=1,wt.copy(o,r.view().projection()),wt.rotateX(o,o,e.rotX()),wt.rotateY(o,o,e.rotY()),wt.translate(o,o,h),wt.scale(o,o,l),n.uniformMatrix4fv(a.uProjMatrix,!1,o),ud(n,a,i,e.z),dd(n,a,t),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.vertexIndices),n.drawElements(n.TRIANGLES,Za.length,n.UNSIGNED_SHORT,0)};var Ka=Jt,xd=Ka,Md=je;function Qa(){this.constructor.super_.apply(this,arguments)}Md(Qa,xd);var Ja=Qa,Ed=Ka,Td=je;function es(){this.constructor.super_.apply(this,arguments)}Td(es,Ed);var ts=es,bd=["attribute vec3 aVertexPosition;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uInvProjMatrix;","varying vec4 vRay;","void main(void) {","  vRay = uInvProjMatrix * vec4(aVertexPosition.xy, 1.0, 1.0);","  gl_Position = uViewportMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);","}"].join(`
`),Cd=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform float uTextureX;","uniform float uTextureY;","uniform float uTextureWidth;","uniform float uTextureHeight;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec4 vRay;","const float PI = 3.14159265358979323846264;","void main(void) {","  float r = inversesqrt(vRay.x * vRay.x + vRay.y * vRay.y + vRay.z * vRay.z);","  float phi  = acos(vRay.y * r);","  float theta = atan(vRay.x, -1.0*vRay.z);","  float s = 0.5 + 0.5 * theta / PI;","  float t = 1.0 - phi / PI;","  s = s * uTextureWidth + uTextureX;","  t = t * uTextureHeight + uTextureY;","  vec4 color = texture2D(uSampler, vec2(s, t)) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join(`
`),Hr=ye.mat4,Sd=ie,Ye=Ba,Pd=Ye.createConstantBuffers,Ld=Ye.destroyConstantBuffers,Rd=Ye.createShaderProgram,$d=Ye.destroyShaderProgram,Ad=Ye.enableAttributes,zd=Ye.disableAttributes,Od=Ye.setViewport,Id=Ye.setupPixelEffectUniforms,Dd=Ye.setDepth,Hd=Ye.setTexture,Fd=bd,Vd=Cd,rs=[0,1,2,0,2,3],Nd=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],kd=[0,0,1,0,1,1,0,1],jd=["aVertexPosition"],Wd=["uDepth","uOpacity","uSampler","uInvProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix","uTextureX","uTextureY","uTextureWidth","uTextureHeight"];function er(e){this.gl=e,this.invProjMatrix=Hr.create(),this.viewportMatrix=Hr.create(),this.constantBuffers=Pd(e,rs,Nd,kd),this.shaderProgram=Rd(e,Fd,Vd,jd,Wd)}er.prototype.destroy=function(){Ld(this.gl,this.constantBuffers),$d(this.gl,this.shaderProgram),Sd(this)},er.prototype.startLayer=function(e,t){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,a=this.invProjMatrix,s=this.viewportMatrix;r.useProgram(i),Ad(r,i),Od(r,e,t,s),r.uniformMatrix4fv(i.uViewportMatrix,!1,s),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),Hr.copy(a,e.view().projection()),Hr.invert(a,a),r.uniformMatrix4fv(i.uInvProjMatrix,!1,a);var o=e.effects().textureCrop||{},h=o.x!=null?o.x:0,l=o.y!=null?o.y:0,c=o.width!=null?o.width:1,f=o.height!=null?o.height:1;r.uniform1f(i.uTextureX,h),r.uniform1f(i.uTextureY,l),r.uniform1f(i.uTextureWidth,c),r.uniform1f(i.uTextureHeight,f),Id(r,e.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},er.prototype.endLayer=function(e,t){var r=this.gl,i=this.shaderProgram;zd(r,i)},er.prototype.renderTile=function(e,t,r,i){var n=this.gl,a=this.shaderProgram,s=this.constantBuffers;Dd(n,a,i,e.z),Hd(n,a,t),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.vertexIndices),n.drawElements(n.TRIANGLES,rs.length,n.UNSIGNED_SHORT,0)};var is=er,Yd=Ja,qd=ts,Xd=is;function Ud(e){switch(e.type){case"webgl":e.registerRenderer("flat","flat",qd),e.registerRenderer("cube","rectilinear",Yd),e.registerRenderer("equirect","rectilinear",Xd);break;default:throw new Error("Unknown stage type: "+e.type)}}var ns=Ud;function Bd(){for(var e=0,t=0;t<arguments.length;t++){var r=arguments[t];e+=r,e+=r<<10,e^=r>>6}return e+=e<<3,e^=e>>11,e+=e<<15,e>=0?e:-e}var Fr=Bd;function Gd(e,t){return(+e%(t=+t)+t)%t}var ot=Gd,$i=ot,Zd=64;function xt(e){if(e!=null&&(!isFinite(e)||Math.floor(e)!==e||e<1))throw new Error("Set: invalid capacity");this._capacity=this._capacity||Zd,this._buckets=[];for(var t=0;t<this._capacity;t++)this._buckets.push([]);this._size=0}xt.prototype.add=function(e){for(var t=$i(e.hash(),this._capacity),r=this._buckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n))return r[i]=e,n}return r.push(e),this._size++,null},xt.prototype.remove=function(e){for(var t=$i(e.hash(),this._capacity),r=this._buckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n)){for(var a=i;a<r.length-1;a++)r[a]=r[a+1];return r.length=r.length-1,this._size--,n}}return null},xt.prototype.has=function(e){for(var t=$i(e.hash(),this._capacity),r=this._buckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n))return!0}return!1},xt.prototype.size=function(){return this._size},xt.prototype.clear=function(){for(var e=0;e<this._capacity;e++)this._buckets[e].length=0;this._size=0},xt.prototype.forEach=function(e){for(var t=0,r=0;r<this._capacity;r++)for(var i=this._buckets[r],n=0;n<i.length;n++)e(i[n]),t+=1;return t};var as=xt,Kd=as;function Ai(){this._stack=[],this._visited=new Kd,this._vertices=null}Ai.prototype.search=function(e,t,r){var i=this._stack,n=this._visited,a=this._vertices,s=0;for(this._clear(),i.push(t);i.length>0;){var o=i.pop();if(!n.has(o)&&e.intersects(o.vertices(a))){n.add(o);for(var h=o.neighbors(),l=0;l<h.length;l++)i.push(h[l]);r.push(o),s++}}return this._vertices=a,this._clear(),s},Ai.prototype._clear=function(){this._stack.length=0,this._visited.clear()};var ss=Ai,Qd=ot;function Je(e){if(!isFinite(e)||Math.floor(e)!==e||e<0)throw new Error("LruMap: invalid capacity");this._capacity=e,this._keys=new Array(this._capacity),this._values=new Array(this._capacity),this._start=0,this._size=0}Je.prototype._index=function(e){return Qd(this._start+e,this._capacity)},Je.prototype.get=function(e){for(var t=0;t<this._size;t++){var r=this._keys[this._index(t)];if(e.equals(r))return this._values[this._index(t)]}return null},Je.prototype.set=function(e,t){if(this._capacity===0)return e;this.del(e);var r=this._size===this._capacity?this._keys[this._index(0)]:null;return this._keys[this._index(this._size)]=e,this._values[this._index(this._size)]=t,this._size<this._capacity?this._size++:this._start=this._index(1),r},Je.prototype.del=function(e){for(var t=0;t<this._size;t++)if(e.equals(this._keys[this._index(t)])){for(var r=this._values[this._index(t)],i=t;i<this._size-1;i++)this._keys[this._index(i)]=this._keys[this._index(i+1)],this._values[this._index(i)]=this._values[this._index(i+1)];return this._size--,r}return null},Je.prototype.has=function(e){for(var t=0;t<this._size;t++)if(e.equals(this._keys[this._index(t)]))return!0;return!1},Je.prototype.size=function(){return this._size},Je.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._start=0,this._size=0},Je.prototype.forEach=function(e){for(var t=0,r=0;r<this._size;r++)e(this._keys[this._index(r)],this._values[this._index(r)]),t+=1;return t};var os=Je;function Vr(e){this._fallbackOnly=!!e.fallbackOnly}Vr.prototype.numHorizontalTiles=function(){return Math.ceil(this.width()/this.tileWidth())},Vr.prototype.numVerticalTiles=function(){return Math.ceil(this.height()/this.tileHeight())},Vr.prototype.fallbackOnly=function(){return this._fallbackOnly};var zi=Vr;function Jd(e,t){return e<t?-1:e>t?1:0}var tr=Jd,ep=tr;function tp(e,t){for(var r=[],i=0;i<e.length;i++)r.push(new t(e[i]));return r.sort(function(n,a){return ep(n.width(),a.width())}),r}function rp(e){for(var t=[],r=0;r<e.length;r++)e[r]._fallbackOnly||t.push(e[r]);if(!t.length)throw new Error("No selectable levels in list");return t}var rr={makeLevelList:tp,makeSelectableLevelList:rp};function ip(e){var t=typeof e;if(t==="object"){if(e===null)return"null";if(Object.prototype.toString.call(e)==="[object Array]")return"array";if(Object.prototype.toString.call(e)==="[object RegExp]")return"regexp"}return t}var ir=ip,np=je,ap=Fr,sp=ss,op=os,hp=zi,lp=rr.makeLevelList,cp=rr.makeSelectableLevelList,Nr=Vt,kr=tr,vp=ir,Ce=ye.vec3,Oi=ye.vec4,fp=64,Mt="fudlrb",Et={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},Ii=Ce.create();function nr(e,t,r,i){t&&Ce.rotateZ(e,e,Ii,t),r&&Ce.rotateX(e,e,Ii,r),i&&Ce.rotateY(e,e,Ii,i)}for(var Di={},Hi=0;Hi<Mt.length;Hi++){var hs=Mt[Hi],ls=Et[hs],cs=Ce.fromValues(0,0,-1);nr(cs,0,ls.x,ls.y),Di[hs]=cs}var jr={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},Fi=[[0,1],[1,0],[0,-1],[-1,0]];function ce(e,t,r,i,n){this.face=e,this.x=t,this.y=r,this.z=i,this._geometry=n,this._level=n.levelList[i]}ce.prototype.rotX=function(){return Et[this.face].x},ce.prototype.rotY=function(){return Et[this.face].y},ce.prototype.centerX=function(){return(this.x+.5)/this._level.numHorizontalTiles()-.5},ce.prototype.centerY=function(){return .5-(this.y+.5)/this._level.numVerticalTiles()},ce.prototype.scaleX=function(){return 1/this._level.numHorizontalTiles()},ce.prototype.scaleY=function(){return 1/this._level.numVerticalTiles()},ce.prototype.vertices=function(e){e||(e=[Ce.create(),Ce.create(),Ce.create(),Ce.create()]);var t=Et[this.face];function r(o,h,l){Ce.set(o,h,l,-.5),nr(o,0,t.x,t.y)}var i=this.centerX()-this.scaleX()/2,n=this.centerX()+this.scaleX()/2,a=this.centerY()-this.scaleY()/2,s=this.centerY()+this.scaleY()/2;return r(e[0],i,s),r(e[1],n,s),r(e[2],n,a),r(e[3],i,a),e},ce.prototype.parent=function(){if(this.z===0)return null;var e=this.face,t=this.z,r=this.x,i=this.y,n=this._geometry,a=n.levelList[t],s=n.levelList[t-1],o=Math.floor(r/a.numHorizontalTiles()*s.numHorizontalTiles()),h=Math.floor(i/a.numVerticalTiles()*s.numVerticalTiles()),l=t-1;return new ce(e,o,h,l,n)},ce.prototype.children=function(e){if(this.z===this._geometry.levelList.length-1)return null;var t=this.face,r=this.z,i=this.x,n=this.y,a=this._geometry,s=a.levelList[r],o=a.levelList[r+1],h=o.numHorizontalTiles()/s.numHorizontalTiles(),l=o.numVerticalTiles()/s.numVerticalTiles();e=e||[];for(var c=0;c<h;c++)for(var f=0;f<l;f++){var u=h*i+c,p=l*n+f,m=r+1;e.push(new ce(t,u,p,m,a))}return e},ce.prototype.neighbors=function(){var e=this._geometry,t=e._neighborsCache,r=t.get(this);if(r)return r;for(var i=e._vec,n=this.face,a=this.x,s=this.y,o=this.z,h=this._level,l=h.numHorizontalTiles(),c=h.numVerticalTiles(),f=[],u=0;u<Fi.length;u++){var p=Fi[u][0],m=Fi[u][1],x=a+p,y=s+m,M=o,b=n;if(x<0||x>=l||y<0||y>=c){var L=this.centerX(),R=this.centerY();x<0?(Ce.set(i,-.5,R,-.5),b=jr[n][0]):x>=l?(Ce.set(i,.5,R,-.5),b=jr[n][1]):y<0?(Ce.set(i,L,.5,-.5),b=jr[n][2]):y>=c&&(Ce.set(i,L,-.5,-.5),b=jr[n][3]);var $;$=Et[n],nr(i,0,$.x,$.y),$=Et[b],nr(i,0,-$.x,-$.y),x=Nr(Math.floor((.5+i[0])*l),0,l-1),y=Nr(Math.floor((.5-i[1])*c),0,c-1)}f.push(new ce(b,x,y,M,e))}return t.set(this,f),f},ce.prototype.hash=function(){return ap(Mt.indexOf(this.face),this.z,this.y,this.x)},ce.prototype.equals=function(e){return this._geometry===e._geometry&&this.face===e.face&&this.z===e.z&&this.y===e.y&&this.x===e.x},ce.prototype.cmp=function(e){return kr(this.z,e.z)||kr(Mt.indexOf(this.face),Mt.indexOf(e.face))||kr(this.y,e.y)||kr(this.x,e.x)},ce.prototype.str=function(){return"CubeTile("+tile.face+", "+tile.x+", "+tile.y+", "+tile.z+")"};function Tt(e){if(this.constructor.super_.call(this,e),this._size=e.size,this._tileSize=e.tileSize,this._size%this._tileSize!==0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}np(Tt,hp),Tt.prototype.width=function(){return this._size},Tt.prototype.height=function(){return this._size},Tt.prototype.tileWidth=function(){return this._tileSize},Tt.prototype.tileHeight=function(){return this._tileSize},Tt.prototype._validateWithParentLevel=function(e){var t=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),a=this.numHorizontalTiles(),s=this.numVerticalTiles(),o=e.width(),h=e.height(),l=e.tileWidth(),c=e.tileHeight(),f=e.numHorizontalTiles(),u=e.numVerticalTiles();if(t%o!==0)throw new Error("Level width must be multiple of parent level: "+t+" vs. "+o);if(r%h!==0)throw new Error("Level height must be multiple of parent level: "+r+" vs. "+h);if(a%f!==0)throw new Error("Number of horizontal tiles must be multiple of parent level: "+a+" ("+t+"/"+i+") vs. "+f+" ("+o+"/"+l+")");if(s%u!==0)throw new Error("Number of vertical tiles must be multiple of parent level: "+s+" ("+r+"/"+n+") vs. "+u+" ("+h+"/"+c+")")};function et(e){if(vp(e)!=="array")throw new Error("Level list must be an array");this.levelList=lp(e,Tt),this.selectableLevelList=cp(this.levelList);for(var t=1;t<this.levelList.length;t++)this.levelList[t]._validateWithParentLevel(this.levelList[t-1]);this._tileSearcher=new sp,this._neighborsCache=new op(fp),this._vec=Oi.create(),this._viewSize={}}et.prototype.maxTileSize=function(){for(var e=0,t=0;t<this.levelList.length;t++){var r=this.levelList[t];e=Math.max(e,r.tileWidth,r.tileHeight)}return e},et.prototype.levelTiles=function(e,t){var r=this.levelList.indexOf(e),i=e.numHorizontalTiles()-1,n=e.numVerticalTiles()-1;t=t||[];for(var a=0;a<Mt.length;a++)for(var s=Mt[a],o=0;o<=i;o++)for(var h=0;h<=n;h++)t.push(new ce(s,o,h,r,this));return t},et.prototype._closestTile=function(e,t){var r=this._vec;Oi.set(r,0,0,1,1),Oi.transformMat4(r,r,e.inverseProjection());var i=1/0,n=null;for(var a in Di){var s=Di[a],o=1-Ce.dot(s,r);o<i&&(i=o,n=a)}for(var h=Math.max(Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]))/.5,l=0;l<3;l++)r[l]=r[l]/h;var c=Et[n];nr(r,0,-c.x,-c.y);var f=this.levelList.indexOf(t),u=t.numHorizontalTiles(),p=t.numVerticalTiles(),m=Nr(Math.floor((.5+r[0])*u),0,u-1),x=Nr(Math.floor((.5-r[1])*p),0,p-1);return new ce(n,m,x,f,this)},et.prototype.visibleTiles=function(e,t,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],e.size(i),i.width===0||i.height===0)return r;var a=this._closestTile(e,t),s=n.search(e,a,r);if(!s)throw new Error("Starting tile is not visible");return r},et.Tile=et.prototype.Tile=ce,et.type=et.prototype.type="cube",ce.type=ce.prototype.type="cube";var up=et,dp=je,pp=Fr,_p=ss,mp=os,yp=zi,gp=rr.makeLevelList,wp=rr.makeSelectableLevelList,vs=Vt,fs=ot,Vi=tr,xp=ir,ht=ye.vec2,Ni=ye.vec4,Mp=64,ki=[[0,1],[1,0],[0,-1],[-1,0]];function ee(e,t,r,i){this.x=e,this.y=t,this.z=r,this._geometry=i,this._level=i.levelList[r]}ee.prototype.rotX=function(){return 0},ee.prototype.rotY=function(){return 0},ee.prototype.centerX=function(){var e=this._level.width(),t=this._level.tileWidth();return(this.x*t+.5*this.width())/e-.5},ee.prototype.centerY=function(){var e=this._level.height(),t=this._level.tileHeight();return .5-(this.y*t+.5*this.height())/e},ee.prototype.scaleX=function(){var e=this._level.width();return this.width()/e},ee.prototype.scaleY=function(){var e=this._level.height();return this.height()/e},ee.prototype.width=function(){var e=this._level.width(),t=this._level.tileWidth();if(this.x===this._level.numHorizontalTiles()-1){var r=fs(e,t);return r||t}else return t},ee.prototype.height=function(){var e=this._level.height(),t=this._level.tileHeight();if(this.y===this._level.numVerticalTiles()-1){var r=fs(e,t);return r||t}else return t},ee.prototype.levelWidth=function(){return this._level.width()},ee.prototype.levelHeight=function(){return this._level.height()},ee.prototype.vertices=function(e){e||(e=[ht.create(),ht.create(),ht.create(),ht.create()]);var t=this.centerX()-this.scaleX()/2,r=this.centerX()+this.scaleX()/2,i=this.centerY()-this.scaleY()/2,n=this.centerY()+this.scaleY()/2;return ht.set(e[0],t,n),ht.set(e[1],r,n),ht.set(e[2],r,i),ht.set(e[3],t,i),e},ee.prototype.parent=function(){if(this.z===0)return null;var e=this._geometry,t=this.z-1,r=Math.floor(this.x/2),i=Math.floor(this.y/2);return new ee(r,i,t,e)},ee.prototype.children=function(e){if(this.z===this._geometry.levelList.length-1)return null;var t=this._geometry,r=this.z+1;return e=e||[],e.push(new ee(2*this.x,2*this.y,r,t)),e.push(new ee(2*this.x,2*this.y+1,r,t)),e.push(new ee(2*this.x+1,2*this.y,r,t)),e.push(new ee(2*this.x+1,2*this.y+1,r,t)),e},ee.prototype.neighbors=function(){var e=this._geometry,t=e._neighborsCache,r=t.get(this);if(r)return r;for(var i=this.x,n=this.y,a=this.z,s=this._level,o=s.numHorizontalTiles()-1,h=s.numVerticalTiles()-1,l=[],c=0;c<ki.length;c++){var f=ki[c][0],u=ki[c][1],p=i+f,m=n+u,x=a;0<=p&&p<=o&&0<=m&&m<=h&&l.push(new ee(p,m,x,e))}return t.set(this,l),l},ee.prototype.hash=function(){return pp(this.z,this.y,this.x)},ee.prototype.equals=function(e){return this._geometry===e._geometry&&this.z===e.z&&this.y===e.y&&this.x===e.x},ee.prototype.cmp=function(e){return Vi(this.z,e.z)||Vi(this.y,e.y)||Vi(this.x,e.x)},ee.prototype.str=function(){return"FlatTile("+tile.x+", "+tile.y+", "+tile.z+")"};function bt(e){this.constructor.super_.call(this,e),this._width=e.width,this._height=e.height,this._tileWidth=e.tileWidth,this._tileHeight=e.tileHeight}dp(bt,yp),bt.prototype.width=function(){return this._width},bt.prototype.height=function(){return this._height},bt.prototype.tileWidth=function(){return this._tileWidth},bt.prototype.tileHeight=function(){return this._tileHeight},bt.prototype._validateWithParentLevel=function(e){var t=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),a=e.width(),s=e.height(),o=e.tileWidth(),h=e.tileHeight();if(t%a!==0)return new Error("Level width must be multiple of parent level: "+t+" vs. "+a);if(r%s!==0)return new Error("Level height must be multiple of parent level: "+r+" vs. "+s);if(i%o!==0)return new Error("Level tile width must be multiple of parent level: "+i+" vs. "+o);if(n%h!==0)return new Error("Level tile height must be multiple of parent level: "+n+" vs. "+h)};function tt(e){if(xp(e)!=="array")throw new Error("Level list must be an array");this.levelList=gp(e,bt),this.selectableLevelList=wp(this.levelList);for(var t=1;t<this.levelList.length;t++)this.levelList[t]._validateWithParentLevel(this.levelList[t-1]);this._tileSearcher=new _p,this._neighborsCache=new mp(Mp),this._vec=Ni.create(),this._viewSize={}}tt.prototype.maxTileSize=function(){for(var e=0,t=0;t<this.levelList.length;t++){var r=this.levelList[t];e=Math.max(e,r.tileWidth,r.tileHeight)}return e},tt.prototype.levelTiles=function(e,t){var r=this.levelList.indexOf(e),i=e.numHorizontalTiles()-1,n=e.numVerticalTiles()-1;t||(t=[]);for(var a=0;a<=i;a++)for(var s=0;s<=n;s++)t.push(new ee(a,s,r,this));return t},tt.prototype._closestTile=function(e,t){var r=this._vec;Ni.set(r,0,0,1,1),Ni.transformMat4(r,r,e.inverseProjection());var i=.5+r[0],n=.5-r[1],a=this.levelList.indexOf(t),s=t.width(),o=t.height(),h=t.tileWidth(),l=t.tileHeight(),c=t.numHorizontalTiles(),f=t.numVerticalTiles(),u=vs(Math.floor(i*s/h),0,c-1),p=vs(Math.floor(n*o/l),0,f-1);return new ee(u,p,a,this)},tt.prototype.visibleTiles=function(e,t,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],e.size(i),i.width===0||i.height===0)return r;var a=this._closestTile(e,t),s=n.search(e,a,r);if(!s)throw new Error("Starting tile is not visible");return r},tt.Tile=tt.prototype.Tile=ee,tt.type=tt.prototype.type="flat",ee.type=ee.prototype.type="flat";var Ep=tt,Tp=je,bp=Fr,Cp=tr,us=rr,Sp=zi,Pp=ir;function fe(e,t){this.z=e,this._geometry=t,this._level=t.levelList[e]}fe.prototype.rotX=function(){return 0},fe.prototype.rotY=function(){return 0},fe.prototype.centerX=function(){return .5},fe.prototype.centerY=function(){return .5},fe.prototype.scaleX=function(){return 1},fe.prototype.scaleY=function(){return 1},fe.prototype.parent=function(){return this.z===0?null:new fe(this.z-1,this._geometry)},fe.prototype.children=function(e){return this.z===this._geometry.levelList.length-1?null:(e=e||[],e.push(new fe(this.z+1,this._geometry)),e)},fe.prototype.neighbors=function(){return[]},fe.prototype.hash=function(){return bp(this.z)},fe.prototype.equals=function(e){return this._geometry===e._geometry&&this.z===e.z},fe.prototype.cmp=function(e){return Cp(this.z,e.z)},fe.prototype.str=function(){return"EquirectTile("+tile.z+")"};function kt(e){this.constructor.super_.call(this,e),this._width=e.width}Tp(kt,Sp),kt.prototype.width=function(){return this._width},kt.prototype.height=function(){return this._width/2},kt.prototype.tileWidth=function(){return this._width},kt.prototype.tileHeight=function(){return this._width/2};function lt(e){if(Pp(e)!=="array")throw new Error("Level list must be an array");this.levelList=us.makeLevelList(e,kt),this.selectableLevelList=us.makeSelectableLevelList(this.levelList)}lt.prototype.maxTileSize=function(){for(var e=0,t=0;t<this.levelList.length;t++){var r=this.levelList[t];e=Math.max(e,r.tileWidth,r.tileHeight)}return e},lt.prototype.levelTiles=function(e,t){var r=this.levelList.indexOf(e);return t=t||[],t.push(new fe(r,this)),t},lt.prototype.visibleTiles=function(e,t,r){var i=new fe(this.levelList.indexOf(t),this);r=r||[],r.length=0,r.push(i)},lt.Tile=lt.prototype.Tile=fe,lt.type=lt.prototype.type="equirect",fe.type=fe.prototype.type="equirect";var Lp=lt;function Ct(e,t,r){return 2*Math.atan(r*Math.tan(e/2)/t)}function Rp(e,t,r){return Ct(e,t,r)}function $p(e,t,r){return Ct(e,t,Math.sqrt(t*t+r*r))}function Ap(e,t,r){return Ct(e,r,t)}function zp(e,t,r){return Ct(e,r,Math.sqrt(t*t+r*r))}function Op(e,t,r){return Ct(e,Math.sqrt(t*t+r*r),t)}function Ip(e,t,r){return Ct(e,Math.sqrt(t*t+r*r),r)}var ds={convert:Ct,htov:Rp,htod:$p,vtoh:Ap,vtod:zp,dtoh:Op,dtov:Ip};function Dp(e){return typeof e=="number"&&isFinite(e)}var ji=Dp;function Hp(e){return e.toPrecision(15)}var Wi=Hp;function Fp(){var e=arguments;return function(r){for(var i=r,n=0;n<e.length;n++){var a=e[n];i=a.call(null,i)}return i}}var ps=Fp,Vp=se,ct=ye.mat4,ge=ye.vec4,_s=Rr,ar=ds,Yi=ot,vt=ji,St=Vt,qe=Wi,Np=ps,kp=ie,jp=0,Wp=0,Yp=0,qp=0,Xp=0,Up=Math.PI/4,Bp=0,Gp=0,ms=1e-6;function I(e,t){this._yaw=e&&e.yaw!=null?e.yaw:Yp,this._pitch=e&&e.pitch!=null?e.pitch:qp,this._roll=e&&e.roll!=null?e.roll:Xp,this._fov=e&&e.fov!=null?e.fov:Up,this._width=e&&e.width!=null?e.width:jp,this._height=e&&e.height!=null?e.height:Wp,this._projectionCenterX=e&&e.projectionCenterX!=null?e.projectionCenterX:Bp,this._projectionCenterY=e&&e.projectionCenterY!=null?e.projectionCenterY:Gp,this._limiter=t||null,this._projMatrix=ct.create(),this._invProjMatrix=ct.create(),this._frustum=[ge.create(),ge.create(),ge.create(),ge.create(),ge.create()],this._projectionChanged=!0,this._params={},this._fovs={},this._tmpVec=ge.create(),this._update()}Vp(I),I.prototype.destroy=function(){kp(this)},I.prototype.yaw=function(){return this._yaw},I.prototype.pitch=function(){return this._pitch},I.prototype.roll=function(){return this._roll},I.prototype.projectionCenterX=function(){return this._projectionCenterX},I.prototype.projectionCenterY=function(){return this._projectionCenterY},I.prototype.fov=function(){return this._fov},I.prototype.width=function(){return this._width},I.prototype.height=function(){return this._height},I.prototype.size=function(e){return e=e||{},e.width=this._width,e.height=this._height,e},I.prototype.parameters=function(e){return e=e||{},e.yaw=this._yaw,e.pitch=this._pitch,e.roll=this._roll,e.fov=this._fov,e},I.prototype.limiter=function(){return this._limiter},I.prototype.setYaw=function(e){this._resetParams(),this._params.yaw=e,this._update(this._params)},I.prototype.setPitch=function(e){this._resetParams(),this._params.pitch=e,this._update(this._params)},I.prototype.setRoll=function(e){this._resetParams(),this._params.roll=e,this._update(this._params)},I.prototype.setFov=function(e){this._resetParams(),this._params.fov=e,this._update(this._params)},I.prototype.setProjectionCenterX=function(e){this._resetParams(),this._params.projectionCenterX=e,this._update(this._params)},I.prototype.setProjectionCenterY=function(e){this._resetParams(),this._params.projectionCenterY=e,this._update(this._params)},I.prototype.offsetYaw=function(e){this.setYaw(this._yaw+e)},I.prototype.offsetPitch=function(e){this.setPitch(this._pitch+e)},I.prototype.offsetRoll=function(e){this.setRoll(this._roll+e)},I.prototype.offsetFov=function(e){this.setFov(this._fov+e)},I.prototype.setSize=function(e){this._resetParams(),this._params.width=e.width,this._params.height=e.height,this._update(this._params)},I.prototype.setParameters=function(e){this._resetParams(),this._params.yaw=e.yaw,this._params.pitch=e.pitch,this._params.roll=e.roll,this._params.fov=e.fov,this._params.projectionCenterX=e.projectionCenterX,this._params.projectionCenterY=e.projectionCenterY,this._update(this._params)},I.prototype.setLimiter=function(e){this._limiter=e||null,this._update()},I.prototype._resetParams=function(){var e=this._params;e.yaw=null,e.pitch=null,e.roll=null,e.fov=null,e.width=null,e.height=null},I.prototype._update=function(e){e==null&&(this._resetParams(),e=this._params);var t=this._yaw,r=this._pitch,i=this._roll,n=this._fov,a=this._projectionCenterX,s=this._projectionCenterY,o=this._width,h=this._height;if(e.yaw=e.yaw!=null?e.yaw:t,e.pitch=e.pitch!=null?e.pitch:r,e.roll=e.roll!=null?e.roll:i,e.fov=e.fov!=null?e.fov:n,e.width=e.width!=null?e.width:o,e.height=e.height!=null?e.height:h,e.projectionCenterX=e.projectionCenterX!=null?e.projectionCenterX:a,e.projectionCenterY=e.projectionCenterY!=null?e.projectionCenterY:s,this._limiter&&(e=this._limiter(e),!e))throw new Error("Bad view limiter");e=this._normalize(e);var l=e.yaw,c=e.pitch,f=e.roll,u=e.fov,p=e.width,m=e.height,x=e.projectionCenterX,y=e.projectionCenterY;if(!vt(l)||!vt(c)||!vt(f)||!vt(u)||!vt(p)||!vt(m)||!vt(x)||!vt(y))throw new Error("Bad view - suspect a broken limiter");this._yaw=l,this._pitch=c,this._roll=f,this._fov=u,this._width=p,this._height=m,this._projectionCenterX=x,this._projectionCenterY=y,(l!==t||c!==r||f!==i||u!==n||p!==o||m!==h||x!==a||y!==s)&&(this._projectionChanged=!0,this.emit("change")),(p!==o||m!==h)&&this.emit("resize")},I.prototype._normalize=function(e){this._normalizeCoordinates(e);var t=ar.htov(Math.PI,e.width,e.height),r=isNaN(t)?Math.PI:Math.min(Math.PI,t);return e.fov=St(e.fov,ms,r-ms),e},I.prototype._normalizeCoordinates=function(e){return"yaw"in e&&(e.yaw=Yi(e.yaw-Math.PI,-2*Math.PI)+Math.PI),"pitch"in e&&(e.pitch=Yi(e.pitch-Math.PI,-2*Math.PI)+Math.PI),"roll"in e&&(e.roll=Yi(e.roll-Math.PI,-2*Math.PI)+Math.PI),e},I.prototype.normalizeToClosest=function(e,t){var r=this._yaw,i=this._pitch,n=e.yaw,a=e.pitch,s=n-2*Math.PI,o=n+2*Math.PI;Math.abs(s-r)<Math.abs(n-r)?n=s:Math.abs(o-r)<Math.abs(n-r)&&(n=o);var h=a-2*Math.PI,l=a+2*Math.PI;return Math.abs(h-i)<Math.abs(a-i)?a=h:Math.abs(h-i)<Math.abs(a-i)&&(a=l),t=t||{},t.yaw=n,t.pitch=a,t},I.prototype.updateWithControlParameters=function(e){var t=this._fov,r=ar.vtoh(t,this._width,this._height);isNaN(r)&&(r=t),this.offsetYaw(e.axisScaledX*r+e.x*2*r+e.yaw),this.offsetPitch(e.axisScaledY*t+e.y*2*r+e.pitch),this.offsetRoll(-e.roll),this.offsetFov(e.zoom*t)},I.prototype._updateProjection=function(){var e=this._projMatrix,t=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._width,n=this._height,a=this._fov,s=ar.vtoh(a,i,n),o=i/n,h=this._projectionCenterX,l=this._projectionCenterY;if(h!==0||l!==0){var c=Math.atan(h*2*Math.tan(s/2)),f=Math.atan(l*2*Math.tan(a/2)),u=this._fovs;u.leftDegrees=(s/2+c)*180/Math.PI,u.rightDegrees=(s/2-c)*180/Math.PI,u.upDegrees=(a/2+f)*180/Math.PI,u.downDegrees=(a/2-f)*180/Math.PI,ct.perspectiveFromFieldOfView(e,u,-1,1)}else ct.perspective(e,a,o,-1,1);ct.rotateZ(e,e,this._roll),ct.rotateX(e,e,this._pitch),ct.rotateY(e,e,this._yaw),ct.invert(t,e),this._matrixToFrustum(e,r),this._projectionChanged=!1}},I.prototype._matrixToFrustum=function(e,t){ge.set(t[0],e[3]+e[0],e[7]+e[4],e[11]+e[8],0),ge.set(t[1],e[3]-e[0],e[7]-e[4],e[11]-e[8],0),ge.set(t[2],e[3]+e[1],e[7]+e[5],e[11]+e[9],0),ge.set(t[3],e[3]-e[1],e[7]-e[5],e[11]-e[9],0),ge.set(t[4],e[3]+e[2],e[7]+e[6],e[11]+e[10],0)},I.prototype.projection=function(){return this._updateProjection(),this._projMatrix},I.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},I.prototype.intersects=function(e){this._updateProjection();for(var t=this._frustum,r=this._tmpVec,i=0;i<t.length;i++){for(var n=t[i],a=!1,s=0;s<e.length;s++){var o=e[s];ge.set(r,o[0],o[1],o[2],0),ge.dot(n,r)>=0&&(a=!0)}if(!a)return!1}return!0},I.prototype.selectLevel=function(e){for(var t=_s()*this._height,r=Math.tan(.5*this._fov),i=0;i<e.length;i++){var n=e[i];if(r*n.height()>=t)return n}return e[e.length-1]},I.prototype.coordinatesToScreen=function(e,t){var r=this._tmpVec;t||(t={});var i=this._width,n=this._height;if(i<=0||n<=0)return t.x=null,t.y=null,null;var a=e.yaw,s=e.pitch,o=Math.sin(a)*Math.cos(s),h=-Math.sin(s),l=-Math.cos(a)*Math.cos(s);if(ge.set(r,o,h,l,1),ge.transformMat4(r,r,this.projection()),r[3]>=0)t.x=i*(r[0]/r[3]+1)/2,t.y=n*(1-r[1]/r[3])/2;else return t.x=null,t.y=null,null;return t},I.prototype.screenToCoordinates=function(e,t){var r=this._tmpVec;t||(t={});var i=this._width,n=this._height,a=2*e.x/i-1,s=1-2*e.y/n;ge.set(r,a,s,1,1),ge.transformMat4(r,r,this.inverseProjection());var o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);return t.yaw=Math.atan2(r[0],-r[2]),t.pitch=Math.acos(r[1]/o)-Math.PI/2,this._normalizeCoordinates(t),t},I.prototype.coordinatesToPerspectiveTransform=function(e,t,r){r=r||"";var i=this._height,n=this._width,a=this._fov,s=.5*i/Math.tan(a/2),o="";return o+="translateX("+qe(n/2)+"px) ",o+="translateY("+qe(i/2)+"px) ",o+="translateX(-50%) translateY(-50%) ",o+="perspective("+qe(s)+"px) ",o+="translateZ("+qe(s)+"px) ",o+="rotateZ("+qe(-this._roll)+"rad) ",o+="rotateX("+qe(-this._pitch)+"rad) ",o+="rotateY("+qe(this._yaw)+"rad) ",o+="rotateY("+qe(-e.yaw)+"rad) ",o+="rotateX("+qe(e.pitch)+"rad) ",o+="translateZ("+qe(-t)+"px) ",o+=r+" ",o},I.limit={yaw:function(e,t){return function(i){return i.yaw=St(i.yaw,e,t),i}},pitch:function(e,t){return function(i){return i.pitch=St(i.pitch,e,t),i}},roll:function(e,t){return function(i){return i.roll=St(i.roll,e,t),i}},hfov:function(e,t){return function(i){var n=i.width,a=i.height;if(n>0&&a>0){var s=ar.htov(e,n,a),o=ar.htov(t,n,a);i.fov=St(i.fov,s,o)}return i}},vfov:function(e,t){return function(i){return i.fov=St(i.fov,e,t),i}},resolution:function(e){return function(r){var i=r.height;if(i){var n=_s()*i,a=2*Math.atan(n/e);r.fov=St(r.fov,a,1/0)}return r}},traditional:function(e,t,r){return r=r??t,Np(I.limit.resolution(e),I.limit.vfov(0,t),I.limit.hfov(0,r),I.limit.pitch(-Math.PI/2,Math.PI/2))}},I.type=I.prototype.type="rectilinear";var Zp=I,Kp=se,Wr=ye.mat4,sr=ye.vec4,ys=Rr,jt=ji,rt=Vt,Qp=ie,Jp=0,e_=0,gs=.5,ws=.5,t_=1,r_=[1,0,1,0],i_=[-1,-1,1,1],n_=1e-6;function q(e,t){if(!(e&&e.mediaAspectRatio!=null))throw new Error("mediaAspectRatio must be defined");this._x=e&&e.x!=null?e.x:gs,this._y=e&&e.y!=null?e.y:ws,this._zoom=e&&e.zoom!=null?e.zoom:t_,this._mediaAspectRatio=e.mediaAspectRatio,this._width=e&&e.width!=null?e.width:Jp,this._height=e&&e.height!=null?e.height:e_,this._limiter=t||null,this._projMatrix=Wr.create(),this._invProjMatrix=Wr.create(),this._frustum=[0,0,0,0],this._projectionChanged=!0,this._params={},this._vec=sr.create(),this._update()}Kp(q),q.prototype.destroy=function(){Qp(this)},q.prototype.x=function(){return this._x},q.prototype.y=function(){return this._y},q.prototype.zoom=function(){return this._zoom},q.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},q.prototype.width=function(){return this._width},q.prototype.height=function(){return this._height},q.prototype.size=function(e){return e=e||{},e.width=this._width,e.height=this._height,e},q.prototype.parameters=function(e){return e=e||{},e.x=this._x,e.y=this._y,e.zoom=this._zoom,e.mediaAspectRatio=this._mediaAspectRatio,e},q.prototype.limiter=function(){return this._limiter},q.prototype.setX=function(e){this._resetParams(),this._params.x=e,this._update(this._params)},q.prototype.setY=function(e){this._resetParams(),this._params.y=e,this._update(this._params)},q.prototype.setZoom=function(e){this._resetParams(),this._params.zoom=e,this._update(this._params)},q.prototype.offsetX=function(e){this.setX(this._x+e)},q.prototype.offsetY=function(e){this.setY(this._y+e)},q.prototype.offsetZoom=function(e){this.setZoom(this._zoom+e)},q.prototype.setMediaAspectRatio=function(e){this._resetParams(),this._params.mediaAspectRatio=e,this._update(this._params)},q.prototype.setSize=function(e){this._resetParams(),this._params.width=e.width,this._params.height=e.height,this._update(this._params)},q.prototype.setParameters=function(e){this._resetParams(),this._params.x=e.x,this._params.y=e.y,this._params.zoom=e.zoom,this._params.mediaAspectRatio=e.mediaAspectRatio,this._update(this._params)},q.prototype.setLimiter=function(e){this._limiter=e||null,this._update()},q.prototype._resetParams=function(){var e=this._params;e.x=null,e.y=null,e.zoom=null,e.mediaAspectRatio=null,e.width=null,e.height=null},q.prototype._update=function(e){e==null&&(this._resetParams(),e=this._params);var t=this._x,r=this._y,i=this._zoom,n=this._mediaAspectRatio,a=this._width,s=this._height;if(e.x=e.x!=null?e.x:t,e.y=e.y!=null?e.y:r,e.zoom=e.zoom!=null?e.zoom:i,e.mediaAspectRatio=e.mediaAspectRatio!=null?e.mediaAspectRatio:n,e.width=e.width!=null?e.width:a,e.height=e.height!=null?e.height:s,this._limiter&&(e=this._limiter(e),!e))throw new Error("Bad view limiter");var o=e.x,h=e.y,l=e.zoom,c=e.mediaAspectRatio,f=e.width,u=e.height;if(!jt(o)||!jt(h)||!jt(l)||!jt(c)||!jt(f)||!jt(u))throw new Error("Bad view - suspect a broken limiter");l=rt(l,n_,1/0),this._x=o,this._y=h,this._zoom=l,this._mediaAspectRatio=c,this._width=f,this._height=u,(o!==t||h!==r||l!==i||c!==n||f!==a||u!==s)&&(this._projectionChanged=!0,this.emit("change")),(f!==a||u!==s)&&this.emit("resize")},q.prototype._zoomX=function(){return this._zoom},q.prototype._zoomY=function(){var e=this._mediaAspectRatio,t=this._width/this._height,r=this._zoom,i=r*e/t;return isNaN(i)&&(i=r),i},q.prototype.updateWithControlParameters=function(e){var t=this.zoom(),r=this._zoomX(),i=this._zoomY();this.offsetX(e.axisScaledX*r+e.x*t),this.offsetY(e.axisScaledY*i+e.y*t),this.offsetZoom(e.zoom*t)},q.prototype._updateProjection=function(){var e=this._projMatrix,t=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._x,n=this._y,a=this._zoomX(),s=this._zoomY(),o=r[0]=.5-n+.5*s,h=r[1]=i-.5+.5*a,l=r[2]=.5-n-.5*s,c=r[3]=i-.5-.5*a;Wr.ortho(e,c,h,l,o,-1,1),Wr.invert(t,e),this._projectionChanged=!1}},q.prototype.projection=function(){return this._updateProjection(),this._projMatrix},q.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},q.prototype.intersects=function(e){this._updateProjection();for(var t=this._frustum,r=0;r<t.length;r++){for(var i=t[r],n=r_[r],a=i_[r],s=!1,o=0;o<e.length;o++){var h=e[o];if(a<0&&h[n]<i||a>0&&h[n]>i){s=!0;break}}if(!s)return!1}return!0},q.prototype.selectLevel=function(e){for(var t=ys()*this.width(),r=this._zoom,i=0;i<e.length;i++){var n=e[i];if(r*n.width()>=t)return n}return e[e.length-1]},q.prototype.coordinatesToScreen=function(e,t){var r=this._vec;t||(t={});var i=this._width,n=this._height;if(i<=0||n<=0)return t.x=null,t.y=null,null;var a=e&&e.x!=null?e.x:gs,s=e&&e.y!=null?e.y:ws;sr.set(r,a-.5,.5-s,-1,1),sr.transformMat4(r,r,this.projection());for(var o=0;o<3;o++)r[o]/=r[3];return t.x=i*(r[0]+1)/2,t.y=n*(1-r[1])/2,t},q.prototype.screenToCoordinates=function(e,t){var r=this._vec;t||(t={});var i=this._width,n=this._height,a=2*e.x/i-1,s=1-2*e.y/n;return sr.set(r,a,s,1,1),sr.transformMat4(r,r,this.inverseProjection()),t.x=.5+r[0],t.y=.5-r[1],t},q.limit={x:function(e,t){return function(i){return i.x=rt(i.x,e,t),i}},y:function(e,t){return function(i){return i.y=rt(i.y,e,t),i}},zoom:function(e,t){return function(i){return i.zoom=rt(i.zoom,e,t),i}},resolution:function(e){return function(r){if(r.width<=0||r.height<=0)return r;var i=r.width,n=ys()*i/e;return r.zoom=rt(r.zoom,n,1/0),r}},visibleX:function(e,t){return function(i){var n=t-e;i.zoom>n&&(i.zoom=n);var a=e+.5*i.zoom,s=t-.5*i.zoom;return i.x=rt(i.x,a,s),i}},visibleY:function(e,t){return function(i){if(i.width<=0||i.height<=0)return i;var n=i.width/i.height,a=n/i.mediaAspectRatio,s=(t-e)*a;i.zoom>s&&(i.zoom=s);var o=e+.5*i.zoom/a,h=t-.5*i.zoom/a;return i.y=rt(i.y,o,h),i}},letterbox:function(){return function(t){if(t.width<=0||t.height<=0)return t;var r=t.width/t.height,i=1,n=r/t.mediaAspectRatio;t.mediaAspectRatio>=r&&(t.zoom=Math.min(t.zoom,i)),t.mediaAspectRatio<=r&&(t.zoom=Math.min(t.zoom,n));var a,s;t.zoom>i?a=s=.5:(a=0+.5*t.zoom/i,s=1-.5*t.zoom/i);var o,h;return t.zoom>n?o=h=.5:(o=0+.5*t.zoom/n,h=1-.5*t.zoom/n),t.x=rt(t.x,a,s),t.y=rt(t.y,o,h),t}}},q.type=q.prototype.type="flat";var a_=q,s_=xn,o_=ot;function or(e){this._concurrency=e&&e.concurrency||1,this._paused=e&&!!e.paused||!1,this._pool=[];for(var t=0;t<this._concurrency;t++)this._pool.push(new s_(e));this._next=0}or.prototype.length=function(){for(var e=0,t=0;t<this._pool.length;t++)e+=this._pool[t].length();return e},or.prototype.push=function(e,t){var r=this._next,i=this._pool[r].push(e,t);return this._next=o_(this._next+1,this._concurrency),i},or.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var e=0;e<this._concurrency;e++)this._pool[e].pause()}},or.prototype.resume=function(){if(this._paused){this._paused=!1;for(var e=0;e<this._concurrency;e++)this._pool[e].resume()}};var h_=or;function l_(){}var hr=l_,c_=hr;function v_(){var e=Array.prototype.slice.call(arguments,0);return function(){var r=e.slice(0),i=null,n=null,a=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],s=arguments.length?arguments[arguments.length-1]:c_;function o(){var l=arguments[0];if(l){i=n=null,s.apply(null,arguments);return}if(!r.length){i=n=null,s.apply(null,arguments);return}i=r.shift();var c=i,f=Array.prototype.slice.call(arguments,1);f.push(o);var u=i.apply(null,f);if(c===i){if(typeof u!="function")throw new Error("chain: chaining on non-cancellable function");n=u}}function h(){n&&n.apply(null,arguments)}return a.unshift(null),o.apply(null,a),h}}var qi=v_;function f_(e,t){var r=null;function i(){r!=null&&(r=null,t(null))}function n(){r!=null&&(clearTimeout(r),r=null,t.apply(null,arguments))}return r=setTimeout(i,e),n}var xs=f_,u_=se,d_=Pn,p_=h_,__=qi,m_=xs,Ms=gt,Es={x:"x",y:"y",z:"z",f:"face"},y_="bdflru",g_=4,w_=1e4;function lr(e,t){t=t||{},this._loadPool=new p_({concurrency:t.concurrency||g_}),this._retryDelay=t.retryDelay||w_,this._retryMap={},this._sourceFromTile=e}u_(lr),lr.prototype.loadAsset=function(e,t,r){var i=this,n=this._retryDelay,a=this._retryMap,s=this._sourceFromTile(t),o=s.url,h=s.rect,l=e.loadImage.bind(e,o,h),c=function(y){return i._loadPool.push(l,function(M,b){M?(M instanceof d_&&(a[o]=Ms(),i.emit("networkError",M,t)),y(M,t)):(delete a[o],y(null,t,b))})},f,u=a[o];if(u!=null){var p=Ms(),m=p-u;m<n?f=n-m:(f=0,delete a[o])}var x=m_.bind(null,f);return __(x,c)(r)},lr.fromString=function(e,t){t=t||{};var r=t&&t.cubeMapPreviewFaceOrder||y_,i=t.cubeMapPreviewUrl?a:n;return new lr(i,t);function n(o){var h=e;for(var l in Es){var c=Es[l],f=x_(l),u=o.hasOwnProperty(c)?o[c]:"";h=h.replace(f,u)}return{url:h}}function a(o){return o.z===0?s(o):n(o)}function s(o){var h=r.indexOf(o.face)/6;return{url:t.cubeMapPreviewUrl,rect:{x:0,y:h,width:1,height:1/6}}}};function x_(e){var t="\\{("+e+")\\}";return new RegExp(t,"g")}var M_=lr;function Xi(e){this._asset=e}Xi.prototype.asset=function(){return this._asset},Xi.prototype.loadAsset=function(e,t,r){var i=this,n=setTimeout(function(){r(null,t,i._asset)},0);function a(){clearTimeout(n),r.apply(null,arguments)}return a};var E_=Xi,T_=di,b_=je,C_=se,S_=ie;function Pt(e){this.constructor.super_.call(this,e),this._timestamp=0}b_(Pt,T_),C_(Pt),Pt.prototype.destroy=function(){S_(this)},Pt.prototype.timestamp=function(){return this._timestamp},Pt.prototype.isDynamic=function(){return!0},Pt.prototype.markDirty=function(){this._timestamp++,this.emit("change")};var P_=Pt,Yr=ot,L_=64;function ft(e){if(e!=null&&(!isFinite(e)||Math.floor(e)!==e||e<1))throw new Error("Map: invalid capacity");this._capacity=e||L_,this._keyBuckets=[],this._valBuckets=[];for(var t=0;t<this._capacity;t++)this._keyBuckets.push([]),this._valBuckets.push([]);this._size=0}ft.prototype.get=function(e){for(var t=Yr(e.hash(),this._capacity),r=this._keyBuckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n)){var a=this._valBuckets[t],s=a[i];return s}}return null},ft.prototype.set=function(e,t){for(var r=Yr(e.hash(),this._capacity),i=this._keyBuckets[r],n=this._valBuckets[r],a=0;a<i.length;a++){var s=i[a];if(e.equals(s)){var o=n[a];return i[a]=e,n[a]=t,o}}return i.push(e),n.push(t),this._size++,null},ft.prototype.del=function(e){for(var t=Yr(e.hash(),this._capacity),r=this._keyBuckets[t],i=this._valBuckets[t],n=0;n<r.length;n++){var a=r[n];if(e.equals(a)){for(var s=i[n],o=n;o<r.length-1;o++)r[o]=r[o+1],i[o]=i[o+1];return r.length=r.length-1,i.length=i.length-1,this._size--,s}}return null},ft.prototype.has=function(e){for(var t=Yr(e.hash(),this._capacity),r=this._keyBuckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n))return!0}return!1},ft.prototype.size=function(){return this._size},ft.prototype.clear=function(){for(var e=0;e<this._capacity;e++)this._keyBuckets[e].length=0,this._valBuckets[e].length=0;this._size=0},ft.prototype.forEach=function(e){for(var t=0,r=0;r<this._capacity;r++)for(var i=this._keyBuckets[r],n=this._valBuckets[r],a=0;a<i.length;a++)e(i[a],n[a]),t+=1;return t};var R_=ft,$_=ot;function ut(e){if(!isFinite(e)||Math.floor(e)!==e||e<0)throw new Error("LruSet: invalid capacity");this._capacity=e,this._elements=new Array(this._capacity),this._start=0,this._size=0}ut.prototype._index=function(e){return $_(this._start+e,this._capacity)},ut.prototype.add=function(e){if(this._capacity===0)return e;this.remove(e);var t=this._size===this._capacity?this._elements[this._index(0)]:null;return this._elements[this._index(this._size)]=e,this._size<this._capacity?this._size++:this._start=this._index(1),t},ut.prototype.remove=function(e){for(var t=0;t<this._size;t++){var r=this._elements[this._index(t)];if(e.equals(r)){for(var i=t;i<this._size-1;i++)this._elements[this._index(i)]=this._elements[this._index(i+1)];return this._size--,r}}return null},ut.prototype.has=function(e){for(var t=0;t<this._size;t++)if(e.equals(this._elements[this._index(t)]))return!0;return!1},ut.prototype.size=function(){return this._size},ut.prototype.clear=function(){this._elements.length=0,this._start=0,this._size=0},ut.prototype.forEach=function(e){for(var t=0,r=0;r<this._size;r++)e(this._elements[this._index(r)]),t+=1;return t};var A_=ut;function z_(e,t){for(var r in t)r in e||(e[r]=t[r]);return e}var Xe=z_,O_=hr;function I_(e){return function(){var r=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],i=arguments.length?arguments[arguments.length-1]:O_,n=null,a=!1;function s(){var o=arguments[0];!o||a?i.apply(null,arguments):n=e.apply(null,r)}return r.push(s),s(!0),function(){a=!0,n.apply(null,arguments)}}}var Ts=I_,bs=R_,Cs=as,D_=A_,Ss=se,H_=Xe,F_=Ts,V_=qi,N_=je,Ps=ie,cr=typeof MARZIPANODEBUG<"u"&&MARZIPANODEBUG.textureStore,Ae={IDLE:0,START:1,MARK:2,END:3},k_={previouslyVisibleCacheSize:512},j_=0;function Ui(){}N_(Ui,Error);function vr(e,t){var r=this,i=j_++;r._id=i,r._store=e,r._tile=t,r._asset=null,r._texture=null,r._changeHandler=function(){e.emit("textureInvalid",t)};var n=e.source(),a=e.stage(),s=n.loadAsset.bind(n),o=a.createTexture.bind(a),h=V_(F_(s),o);e.emit("textureStartLoad",t),cr&&console.log("loading",i,t),r._cancel=h(a,t,function(l,c,f,u){if(r._cancel=null,l){f&&f.destroy(),u&&u.destroy(),l instanceof Ui?(e.emit("textureCancel",t),cr&&console.log("cancel",i,t)):(e.emit("textureError",t,l),cr&&console.log("error",i,t));return}r._texture=u,f.isDynamic()?(r._asset=f,f.addEventListener("change",r._changeHandler)):f.destroy(),e.emit("textureLoad",t),cr&&console.log("load",i,t)})}vr.prototype.asset=function(){return this._asset},vr.prototype.texture=function(){return this._texture},vr.prototype.destroy=function(){var e=this._id,t=this._store,r=this._tile,i=this._asset,n=this._texture,a=this._cancel;if(a){a(new Ui);return}i&&(i.removeEventListener("change",this._changeHandler),i.destroy()),n&&n.destroy(),t.emit("textureUnload",r),cr&&console.log("unload",e,r),Ps(this)},Ss(vr);function _e(e,t,r){r=H_(r||{},k_),this._source=e,this._stage=t,this._state=Ae.IDLE,this._delimCount=0,this._itemMap=new bs,this._visible=new Cs,this._previouslyVisible=new D_(r.previouslyVisibleCacheSize),this._pinMap=new bs,this._newVisible=new Cs,this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}Ss(_e),_e.prototype.destroy=function(){this.clear(),Ps(this)},_e.prototype.stage=function(){return this._stage},_e.prototype.source=function(){return this._source},_e.prototype.clear=function(){var e=this;e._evicted.length=0,e._itemMap.forEach(function(t){e._evicted.push(t)}),e._evicted.forEach(function(t){e._unloadTile(t)}),e._itemMap.clear(),e._visible.clear(),e._previouslyVisible.clear(),e._pinMap.clear(),e._newVisible.clear(),e._noLongerVisible.length=0,e._visibleAgain.length=0,e._evicted.length=0},_e.prototype.clearNotPinned=function(){var e=this;e._evicted.length=0,e._itemMap.forEach(function(t){e._pinMap.has(t)||e._evicted.push(t)}),e._evicted.forEach(function(t){e._unloadTile(t)}),e._visible.clear(),e._previouslyVisible.clear(),e._evicted.length=0},_e.prototype.startFrame=function(){if(this._state!==Ae.IDLE&&this._state!==Ae.START)throw new Error("TextureStore: startFrame called out of sequence");this._state=Ae.START,this._delimCount++},_e.prototype.markTile=function(e){if(this._state!==Ae.START&&this._state!==Ae.MARK)throw new Error("TextureStore: markTile called out of sequence");this._state=Ae.MARK;var t=this._itemMap.get(e),r=t&&t.texture(),i=t&&t.asset();r&&i&&r.refresh(e,i),this._newVisible.add(e)},_e.prototype.endFrame=function(){if(this._state!==Ae.START&&this._state!==Ae.MARK&&this._state!==Ae.END)throw new Error("TextureStore: endFrame called out of sequence");this._state=Ae.END,this._delimCount--,this._delimCount||(this._update(),this._state=Ae.IDLE)},_e.prototype._update=function(){var e=this;e._noLongerVisible.length=0,e._visible.forEach(function(r){e._newVisible.has(r)||e._noLongerVisible.push(r)}),e._visibleAgain.length=0,e._newVisible.forEach(function(r){e._previouslyVisible.has(r)&&e._visibleAgain.push(r)}),e._visibleAgain.forEach(function(r){e._previouslyVisible.remove(r)}),e._evicted.length=0,e._noLongerVisible.forEach(function(r){var i=e._itemMap.get(r),n=i&&i.texture();if(n){var a=e._previouslyVisible.add(r);a!=null&&e._evicted.push(a)}else i&&e._unloadTile(r)}),e._evicted.forEach(function(r){e._pinMap.has(r)||e._unloadTile(r)}),e._newVisible.forEach(function(r){var i=e._itemMap.get(r);i||e._loadTile(r)});var t=e._visible;e._visible=e._newVisible,e._newVisible=t,e._newVisible.clear(),e._noLongerVisible.length=0,e._visibleAgain.length=0,e._evicted.length=0},_e.prototype._loadTile=function(e){if(this._itemMap.has(e))throw new Error("TextureStore: loading texture already in cache");var t=new vr(this,e);this._itemMap.set(e,t)},_e.prototype._unloadTile=function(e){var t=this._itemMap.del(e);if(!t)throw new Error("TextureStore: unloading texture not in cache");t.destroy()},_e.prototype.asset=function(e){var t=this._itemMap.get(e);return t?t.asset():null},_e.prototype.texture=function(e){var t=this._itemMap.get(e);return t?t.texture():null},_e.prototype.pin=function(e){var t=(this._pinMap.get(e)||0)+1;return this._pinMap.set(e,t),this._itemMap.has(e)||this._loadTile(e),t},_e.prototype.unpin=function(e){var t=this._pinMap.get(e);if(t)t--,t>0?this._pinMap.set(e,t):(this._pinMap.del(e),!this._visible.has(e)&&!this._previouslyVisible.has(e)&&this._unloadTile(e));else throw new Error("TextureStore: unpin when not pinned");return t},_e.prototype.query=function(e){var t=this._itemMap.get(e),r=this._pinMap.get(e)||0;return{visible:this._visible.has(e),previouslyVisible:this._previouslyVisible.has(e),hasAsset:t!=null&&t.asset()!=null,hasTexture:t!=null&&t.texture()!=null,pinned:r!==0,pinCount:r}};var Ls=_e;function W_(e,t){for(var r in t)e[r]=t[r];return e}var Rs=W_,Y_=se,q_=Rs,X_=ie;function me(e,t,r,i,n){n=n||{};var a=this;this._source=e,this._geometry=t,this._view=r,this._textureStore=i,this._effects=n.effects||{},this._fixedLevelIndex=null,this._viewChangeHandler=function(){a.emit("viewChange",a.view())},this._view.addEventListener("change",this._viewChangeHandler),this._textureStoreChangeHandler=function(){a.emit("textureStoreChange",a.textureStore())},this._textureStore.addEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureInvalid",this._textureStoreChangeHandler)}Y_(me),me.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureInvalid",this._textureStoreChangeHandler),X_(this)},me.prototype.source=function(){return this._source},me.prototype.geometry=function(){return this._geometry},me.prototype.view=function(){return this._view},me.prototype.textureStore=function(){return this._textureStore},me.prototype.effects=function(){return this._effects},me.prototype.setEffects=function(e){this._effects=e,this.emit("effectsChange",this._effects)},me.prototype.mergeEffects=function(e){q_(this._effects,e),this.emit("effectsChange",this._effects)},me.prototype.fixedLevel=function(){return this._fixedLevelIndex},me.prototype.setFixedLevel=function(e){if(e!==this._fixedLevelIndex){if(e!=null&&(e>=this._geometry.levelList.length||e<0))throw new Error("Level index out of range: "+e);this._fixedLevelIndex=e,this.emit("fixedLevelChange",this._fixedLevelIndex)}},me.prototype._selectLevel=function(){var e;return this._fixedLevelIndex!=null?e=this._geometry.levelList[this._fixedLevelIndex]:e=this._view.selectLevel(this._geometry.selectableLevelList),e},me.prototype.visibleTiles=function(e){var t=this._selectLevel();return this._geometry.visibleTiles(this._view,t,e)},me.prototype.pinLevel=function(e){for(var t=this._geometry.levelList[e],r=this._geometry.levelTiles(t),i=0;i<r.length;i++)this._textureStore.pin(r[i])},me.prototype.unpinLevel=function(e){for(var t=this._geometry.levelList[e],r=this._geometry.levelTiles(t),i=0;i<r.length;i++)this._textureStore.unpin(r[i])},me.prototype.pinFirstLevel=function(){return this.pinLevel(0)},me.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)};var $s=me,U_=se,B_=ie;function dt(e){var t=this;this._stage=e,this._running=!1,this._rendering=!1,this._requestHandle=null,this._boundLoop=this._loop.bind(this),this._renderInvalidHandler=function(){t._rendering||t.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}U_(dt),dt.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),B_(this)},dt.prototype.stage=function(){return this._stage},dt.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},dt.prototype.stop=function(){this._requestHandle&&(window.cancelAnimationFrame(this._requestHandle),this._requestHandle=null),this._running=!1},dt.prototype.renderOnNextFrame=function(){this._running&&!this._requestHandle&&(this._requestHandle=window.requestAnimationFrame(this._boundLoop))},dt.prototype._loop=function(){if(!this._running)throw new Error("Render loop running while in stopped state");this._requestHandle=null,this._rendering=!0,this.emit("beforeRender"),this._rendering=!1,this._stage.render(),this.emit("afterRender")};var As=dt;function it(){this.velocity=null,this.friction=null,this.offset=null}it.equals=function(e,t){return e.velocity===t.velocity&&e.friction===t.friction&&e.offset===t.offset},it.prototype.equals=function(e){return it.equals(this,e)},it.prototype.update=function(e,t){e.offset&&(this.offset=this.offset||0,this.offset+=e.offset);var r=this.offsetFromVelocity(t);r&&(this.offset=this.offset||0,this.offset+=r),this.velocity=e.velocity,this.friction=e.friction},it.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},it.prototype.velocityAfter=function(e){return this.velocity?this.friction?G_(this.velocity,this.friction*e):this.velocity:null},it.prototype.offsetFromVelocity=function(e){e=Math.min(e,this.nullVelocityTime());var t=this.velocityAfter(e),r=(this.velocity+t)/2;return r*e},it.prototype.nullVelocityTime=function(){return this.velocity==null?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)};function G_(e,t){return e<0?Math.min(0,e+t):e>0?Math.max(0,e-t):0}var nt=it,Z_=se,K_=nt,Q_=ie;function Wt(e,t,r,i,n){if(!e)throw new Error("KeyControlMethod: keyCode must be defined");if(!t)throw new Error("KeyControlMethod: parameter must be defined");if(!r)throw new Error("KeyControlMethod: velocity must be defined");if(!i)throw new Error("KeyControlMethod: friction must be defined");n=n||document,this._keyCode=e,this._parameter=t,this._velocity=r,this._friction=i,this._element=n,this._keydownHandler=this._handlePress.bind(this),this._keyupHandler=this._handleRelease.bind(this),this._blurHandler=this._handleBlur.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler),this._dynamics=new K_,this._pressing=!1}Z_(Wt),Wt.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler),Q_(this)},Wt.prototype._handlePress=function(e){e.keyCode===this._keyCode&&(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))},Wt.prototype._handleRelease=function(e){e.keyCode===this._keyCode&&(this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1)},Wt.prototype._handleBlur=function(){this._dynamics.velocity=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive"),this._pressing=!1};var zs=Wt,Os={exports:{}};/*! Hammer.JS - v2.0.4 - 2014-09-28
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2014 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,r,i,n){var a=["","webkit","moz","MS","ms","o"],s=r.createElement("div"),o="function",h=Math.round,l=Math.abs,c=Date.now;function f(v,d,g){return setTimeout(M(v,g),d)}function u(v,d,g){return Array.isArray(v)?(p(v,g[d],g),!0):!1}function p(v,d,g){var E;if(v)if(v.forEach)v.forEach(d,g);else if(v.length!==n)for(E=0;E<v.length;)d.call(g,v[E],E,v),E++;else for(E in v)v.hasOwnProperty(E)&&d.call(g,v[E],E,v)}function m(v,d,g){for(var E=Object.keys(d),C=0;C<E.length;)(!g||g&&v[E[C]]===n)&&(v[E[C]]=d[E[C]]),C++;return v}function x(v,d){return m(v,d,!0)}function y(v,d,g){var E=d.prototype,C;C=v.prototype=Object.create(E),C.constructor=v,C._super=E,g&&m(C,g)}function M(v,d){return function(){return v.apply(d,arguments)}}function b(v,d){return typeof v==o?v.apply(d&&d[0]||n,d):v}function L(v,d){return v===n?d:v}function R(v,d,g){p(X(d),function(E){v.addEventListener(E,g,!1)})}function $(v,d,g){p(X(d),function(E){v.removeEventListener(E,g,!1)})}function P(v,d){for(;v;){if(v==d)return!0;v=v.parentNode}return!1}function k(v,d){return v.indexOf(d)>-1}function X(v){return v.trim().split(/\s+/g)}function j(v,d,g){if(v.indexOf&&!g)return v.indexOf(d);for(var E=0;E<v.length;){if(g&&v[E][g]==d||!g&&v[E]===d)return E;E++}return-1}function W(v){return Array.prototype.slice.call(v,0)}function D(v,d,g){for(var E=[],C=[],F=0;F<v.length;){var K=d?v[F][d]:v[F];j(C,K)<0&&E.push(v[F]),C[F]=K,F++}return g&&(d?E=E.sort(function(Se,Ke){return Se[d]>Ke[d]}):E=E.sort()),E}function U(v,d){for(var g,E,C=d[0].toUpperCase()+d.slice(1),F=0;F<a.length;){if(g=a[F],E=g?g+C:d,E in v)return E;F++}return n}var Y=1;function z(){return Y++}function w(v){var d=v.ownerDocument;return d.defaultView||d.parentWindow}var Oe=/mobile|tablet|ip(ad|hone|od)|android/i,re="ontouchstart"in t,Be=U(t,"PointerEvent")!==n,$e=re&&Oe.test(navigator.userAgent),Me="touch",Zr="pen",Bt="mouse",Kr="kinect",tn=25,Ee=1,Ne=2,oe=4,de=8,_t=1,Ge=2,$t=4,mt=8,At=16,Ie=Ge|$t,De=mt|At,zt=Ie|De,yr=["x","y"],Ot=["clientX","clientY"];function xe(v,d){var g=this;this.manager=v,this.callback=d,this.element=v.element,this.target=v.options.inputTarget,this.domHandler=function(E){b(v.options.enable,[v])&&g.handler(E)},this.init()}xe.prototype={handler:function(){},init:function(){this.evEl&&R(this.element,this.evEl,this.domHandler),this.evTarget&&R(this.target,this.evTarget,this.domHandler),this.evWin&&R(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&$(this.element,this.evEl,this.domHandler),this.evTarget&&$(this.target,this.evTarget,this.domHandler),this.evWin&&$(w(this.element),this.evWin,this.domHandler)}};function rn(v){var d,g=v.options.inputClass;return g?d=g:Be?d=Ze:$e?d=Ht:re?d=Cr:d=Zt,new d(v,nn)}function nn(v,d,g){var E=g.pointers.length,C=g.changedPointers.length,F=d&Ee&&E-C===0,K=d&(oe|de)&&E-C===0;g.isFirst=!!F,g.isFinal=!!K,F&&(v.session={}),g.eventType=d,gr(v,g),v.emit("hammer.input",g),v.recognize(g),v.session.prevInput=g}function gr(v,d){var g=v.session,E=d.pointers,C=E.length;g.firstInput||(g.firstInput=wr(d)),C>1&&!g.firstMultiple?g.firstMultiple=wr(d):C===1&&(g.firstMultiple=!1);var F=g.firstInput,K=g.firstMultiple,be=K?K.center:F.center,Se=d.center=xr(E);d.timeStamp=c(),d.deltaTime=d.timeStamp-F.timeStamp,d.angle=Gt(be,Se),d.distance=Dt(be,Se),an(g,d),d.offsetDirection=Qr(d.deltaX,d.deltaY),d.scale=K?on(K.pointers,E):1,d.rotation=K?Mr(K.pointers,E):0,sn(g,d);var Ke=v.element;P(d.srcEvent.target,Ke)&&(Ke=d.srcEvent.target),d.target=Ke}function an(v,d){var g=d.center,E=v.offsetDelta||{},C=v.prevDelta||{},F=v.prevInput||{};(d.eventType===Ee||F.eventType===oe)&&(C=v.prevDelta={x:F.deltaX||0,y:F.deltaY||0},E=v.offsetDelta={x:g.x,y:g.y}),d.deltaX=C.x+(g.x-E.x),d.deltaY=C.y+(g.y-E.y)}function sn(v,d){var g=v.lastInterval||d,E=d.timeStamp-g.timeStamp,C,F,K,be;if(d.eventType!=de&&(E>tn||g.velocity===n)){var Se=g.deltaX-d.deltaX,Ke=g.deltaY-d.deltaY,Qt=It(E,Se,Ke);F=Qt.x,K=Qt.y,C=l(Qt.x)>l(Qt.y)?Qt.x:Qt.y,be=Qr(Se,Ke),v.lastInterval=d}else C=g.velocity,F=g.velocityX,K=g.velocityY,be=g.direction;d.velocity=C,d.velocityX=F,d.velocityY=K,d.direction=be}function wr(v){for(var d=[],g=0;g<v.pointers.length;)d[g]={clientX:h(v.pointers[g].clientX),clientY:h(v.pointers[g].clientY)},g++;return{timeStamp:c(),pointers:d,center:xr(d),deltaX:v.deltaX,deltaY:v.deltaY}}function xr(v){var d=v.length;if(d===1)return{x:h(v[0].clientX),y:h(v[0].clientY)};for(var g=0,E=0,C=0;C<d;)g+=v[C].clientX,E+=v[C].clientY,C++;return{x:h(g/d),y:h(E/d)}}function It(v,d,g){return{x:d/v||0,y:g/v||0}}function Qr(v,d){return v===d?_t:l(v)>=l(d)?v>0?Ge:$t:d>0?mt:At}function Dt(v,d,g){g||(g=yr);var E=d[g[0]]-v[g[0]],C=d[g[1]]-v[g[1]];return Math.sqrt(E*E+C*C)}function Gt(v,d,g){g||(g=yr);var E=d[g[0]]-v[g[0]],C=d[g[1]]-v[g[1]];return Math.atan2(C,E)*180/Math.PI}function Mr(v,d){return Gt(d[1],d[0],Ot)-Gt(v[1],v[0],Ot)}function on(v,d){return Dt(d[0],d[1],Ot)/Dt(v[0],v[1],Ot)}var hn={mousedown:Ee,mousemove:Ne,mouseup:oe},ln="mousedown",cn="mousemove mouseup";function Zt(){this.evEl=ln,this.evWin=cn,this.allow=!0,this.pressed=!1,xe.apply(this,arguments)}y(Zt,xe,{handler:function(d){var g=hn[d.type];g&Ee&&d.button===0&&(this.pressed=!0),g&Ne&&d.which!==1&&(g=oe),!(!this.pressed||!this.allow)&&(g&oe&&(this.pressed=!1),this.callback(this.manager,g,{pointers:[d],changedPointers:[d],pointerType:Bt,srcEvent:d}))}});var vn={pointerdown:Ee,pointermove:Ne,pointerup:oe,pointercancel:de,pointerout:de},fn={2:Me,3:Zr,4:Bt,5:Kr},Kt="pointerdown",Er="pointermove pointerup pointercancel";t.MSPointerEvent&&(Kt="MSPointerDown",Er="MSPointerMove MSPointerUp MSPointerCancel");function Ze(){this.evEl=Kt,this.evWin=Er,xe.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}y(Ze,xe,{handler:function(d){var g=this.store,E=!1,C=d.type.toLowerCase().replace("ms",""),F=vn[C],K=fn[d.pointerType]||d.pointerType,be=K==Me,Se=j(g,d.pointerId,"pointerId");F&Ee&&(d.button===0||be)?Se<0&&(g.push(d),Se=g.length-1):F&(oe|de)&&(E=!0),!(Se<0)&&(g[Se]=d,this.callback(this.manager,F,{pointers:g,changedPointers:[d],pointerType:K,srcEvent:d}),E&&g.splice(Se,1))}});var Tr={touchstart:Ee,touchmove:Ne,touchend:oe,touchcancel:de},br="touchstart",Jr="touchstart touchmove touchend touchcancel";function ei(){this.evTarget=br,this.evWin=Jr,this.started=!1,xe.apply(this,arguments)}y(ei,xe,{handler:function(d){var g=Tr[d.type];if(g===Ee&&(this.started=!0),!!this.started){var E=ti.call(this,d,g);g&(oe|de)&&E[0].length-E[1].length===0&&(this.started=!1),this.callback(this.manager,g,{pointers:E[0],changedPointers:E[1],pointerType:Me,srcEvent:d})}}});function ti(v,d){var g=W(v.touches),E=W(v.changedTouches);return d&(oe|de)&&(g=D(g.concat(E),"identifier",!0)),[g,E]}var un={touchstart:Ee,touchmove:Ne,touchend:oe,touchcancel:de},ri="touchstart touchmove touchend touchcancel";function Ht(){this.evTarget=ri,this.targetIds={},xe.apply(this,arguments)}y(Ht,xe,{handler:function(d){var g=un[d.type],E=dn.call(this,d,g);E&&this.callback(this.manager,g,{pointers:E[0],changedPointers:E[1],pointerType:Me,srcEvent:d})}});function dn(v,d){var g=W(v.touches),E=this.targetIds;if(d&(Ee|Ne)&&g.length===1)return E[g[0].identifier]=!0,[g,g];var C,F,K=W(v.changedTouches),be=[],Se=this.target;if(F=g.filter(function(Ke){return P(Ke.target,Se)}),d===Ee)for(C=0;C<F.length;)E[F[C].identifier]=!0,C++;for(C=0;C<K.length;)E[K[C].identifier]&&be.push(K[C]),d&(oe|de)&&delete E[K[C].identifier],C++;if(be.length)return[D(F.concat(be),"identifier",!0),be]}function Cr(){xe.apply(this,arguments);var v=M(this.handler,this);this.touch=new Ht(this.manager,v),this.mouse=new Zt(this.manager,v)}y(Cr,xe,{handler:function(d,g,E){var C=E.pointerType==Me,F=E.pointerType==Bt;if(C)this.mouse.allow=!1;else if(F&&!this.mouse.allow)return;g&(oe|de)&&(this.mouse.allow=!0),this.callback(d,g,E)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Sr=U(s.style,"touchAction"),ii=Sr!==n,ni="compute",ai="auto",Pr="manipulation",_="none",T="pan-x",S="pan-y";function O(v,d){this.manager=v,this.set(d)}O.prototype={set:function(v){v==ni&&(v=this.compute()),ii&&(this.manager.element.style[Sr]=v),this.actions=v.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var v=[];return p(this.manager.recognizers,function(d){b(d.options.enable,[d])&&(v=v.concat(d.getTouchAction()))}),B(v.join(" "))},preventDefaults:function(v){if(!ii){var d=v.srcEvent,g=v.offsetDirection;if(this.manager.session.prevented){d.preventDefault();return}var E=this.actions,C=k(E,_),F=k(E,S),K=k(E,T);if(C||F&&g&Ie||K&&g&De)return this.preventSrc(d)}},preventSrc:function(v){this.manager.session.prevented=!0,v.preventDefault()}};function B(v){if(k(v,_))return _;var d=k(v,T),g=k(v,S);return d&&g?T+" "+S:d||g?d?T:S:k(v,Pr)?Pr:ai}var G=1,H=2,V=4,he=8,Z=he,ne=16,le=32;function Te(v){this.id=z(),this.manager=null,this.options=x(v||{},this.defaults),this.options.enable=L(this.options.enable,!0),this.state=G,this.simultaneous={},this.requireFail=[]}Te.prototype={defaults:{},set:function(v){return m(this.options,v),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(v){if(u(v,"recognizeWith",this))return this;var d=this.simultaneous;return v=oi(v,this),d[v.id]||(d[v.id]=v,v.recognizeWith(this)),this},dropRecognizeWith:function(v){return u(v,"dropRecognizeWith",this)?this:(v=oi(v,this),delete this.simultaneous[v.id],this)},requireFailure:function(v){if(u(v,"requireFailure",this))return this;var d=this.requireFail;return v=oi(v,this),j(d,v)===-1&&(d.push(v),v.requireFailure(this)),this},dropRequireFailure:function(v){if(u(v,"dropRequireFailure",this))return this;v=oi(v,this);var d=j(this.requireFail,v);return d>-1&&this.requireFail.splice(d,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(v){return!!this.simultaneous[v.id]},emit:function(v){var d=this,g=this.state;function E(C){d.manager.emit(d.options.event+(C?si(g):""),v)}g<he&&E(!0),E(),g>=he&&E(!0)},tryEmit:function(v){if(this.canEmit())return this.emit(v);this.state=le},canEmit:function(){for(var v=0;v<this.requireFail.length;){if(!(this.requireFail[v].state&(le|G)))return!1;v++}return!0},recognize:function(v){var d=m({},v);if(!b(this.options.enable,[this,d])){this.reset(),this.state=le;return}this.state&(Z|ne|le)&&(this.state=G),this.state=this.process(d),this.state&(H|V|he|ne)&&this.tryEmit(d)},process:function(v){},getTouchAction:function(){},reset:function(){}};function si(v){return v&ne?"cancel":v&he?"end":v&V?"move":v&H?"start":""}function He(v){return v==At?"down":v==mt?"up":v==Ge?"left":v==$t?"right":""}function oi(v,d){var g=d.manager;return g?g.get(v):v}function ke(){Te.apply(this,arguments)}y(ke,Te,{defaults:{pointers:1},attrTest:function(v){var d=this.options.pointers;return d===0||v.pointers.length===d},process:function(v){var d=this.state,g=v.eventType,E=d&(H|V),C=this.attrTest(v);return E&&(g&de||!C)?d|ne:E||C?g&oe?d|he:d&H?d|V:H:le}});function hi(){ke.apply(this,arguments),this.pX=null,this.pY=null}y(hi,ke,{defaults:{event:"pan",threshold:10,pointers:1,direction:zt},getTouchAction:function(){var v=this.options.direction,d=[];return v&Ie&&d.push(S),v&De&&d.push(T),d},directionTest:function(v){var d=this.options,g=!0,E=v.distance,C=v.direction,F=v.deltaX,K=v.deltaY;return C&d.direction||(d.direction&Ie?(C=F===0?_t:F<0?Ge:$t,g=F!=this.pX,E=Math.abs(v.deltaX)):(C=K===0?_t:K<0?mt:At,g=K!=this.pY,E=Math.abs(v.deltaY))),v.direction=C,g&&E>d.threshold&&C&d.direction},attrTest:function(v){return ke.prototype.attrTest.call(this,v)&&(this.state&H||!(this.state&H)&&this.directionTest(v))},emit:function(v){this.pX=v.deltaX,this.pY=v.deltaY;var d=He(v.direction);d&&this.manager.emit(this.options.event+d,v),this._super.emit.call(this,v)}});function pn(){ke.apply(this,arguments)}y(pn,ke,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[_]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.scale-1)>this.options.threshold||this.state&H)},emit:function(v){if(this._super.emit.call(this,v),v.scale!==1){var d=v.scale<1?"in":"out";this.manager.emit(this.options.event+d,v)}}});function _n(){Te.apply(this,arguments),this._timer=null,this._input=null}y(_n,Te,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[ai]},process:function(v){var d=this.options,g=v.pointers.length===d.pointers,E=v.distance<d.threshold,C=v.deltaTime>d.time;if(this._input=v,!E||!g||v.eventType&(oe|de)&&!C)this.reset();else if(v.eventType&Ee)this.reset(),this._timer=f(function(){this.state=Z,this.tryEmit()},d.time,this);else if(v.eventType&oe)return Z;return le},reset:function(){clearTimeout(this._timer)},emit:function(v){this.state===Z&&(v&&v.eventType&oe?this.manager.emit(this.options.event+"up",v):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}});function mn(){ke.apply(this,arguments)}y(mn,ke,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[_]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.rotation)>this.options.threshold||this.state&H)}});function yn(){ke.apply(this,arguments)}y(yn,ke,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ie|De,pointers:1},getTouchAction:function(){return hi.prototype.getTouchAction.call(this)},attrTest:function(v){var d=this.options.direction,g;return d&(Ie|De)?g=v.velocity:d&Ie?g=v.velocityX:d&De&&(g=v.velocityY),this._super.attrTest.call(this,v)&&d&v.direction&&v.distance>this.options.threshold&&l(g)>this.options.velocity&&v.eventType&oe},emit:function(v){var d=He(v.direction);d&&this.manager.emit(this.options.event+d,v),this.manager.emit(this.options.event,v)}});function li(){Te.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}y(li,Te,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Pr]},process:function(v){var d=this.options,g=v.pointers.length===d.pointers,E=v.distance<d.threshold,C=v.deltaTime<d.time;if(this.reset(),v.eventType&Ee&&this.count===0)return this.failTimeout();if(E&&C&&g){if(v.eventType!=oe)return this.failTimeout();var F=this.pTime?v.timeStamp-this.pTime<d.interval:!0,K=!this.pCenter||Dt(this.pCenter,v.center)<d.posThreshold;this.pTime=v.timeStamp,this.pCenter=v.center,!K||!F?this.count=1:this.count+=1,this._input=v;var be=this.count%d.taps;if(be===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=Z,this.tryEmit()},d.interval,this),H):Z}return le},failTimeout:function(){return this._timer=f(function(){this.state=le},this.options.interval,this),le},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Z&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function yt(v,d){return d=d||{},d.recognizers=L(d.recognizers,yt.defaults.preset),new gn(v,d)}yt.VERSION="2.0.4",yt.defaults={domEvents:!1,touchAction:ni,enable:!0,inputTarget:null,inputClass:null,preset:[[mn,{enable:!1}],[pn,{enable:!1},["rotate"]],[yn,{direction:Ie}],[hi,{direction:Ie},["swipe"]],[li],[li,{event:"doubletap",taps:2},["tap"]],[_n]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var v0=1,To=2;function gn(v,d){d=d||{},this.options=x(d,yt.defaults),this.options.inputTarget=this.options.inputTarget||v,this.handlers={},this.session={},this.recognizers=[],this.element=v,this.input=rn(this),this.touchAction=new O(this,this.options.touchAction),bo(this,!0),p(d.recognizers,function(g){var E=this.add(new g[0](g[1]));g[2]&&E.recognizeWith(g[2]),g[3]&&E.requireFailure(g[3])},this)}gn.prototype={set:function(v){return m(this.options,v),v.touchAction&&this.touchAction.update(),v.inputTarget&&(this.input.destroy(),this.input.target=v.inputTarget,this.input.init()),this},stop:function(v){this.session.stopped=v?To:v0},recognize:function(v){var d=this.session;if(!d.stopped){this.touchAction.preventDefaults(v);var g,E=this.recognizers,C=d.curRecognizer;(!C||C&&C.state&Z)&&(C=d.curRecognizer=null);for(var F=0;F<E.length;)g=E[F],d.stopped!==To&&(!C||g==C||g.canRecognizeWith(C))?g.recognize(v):g.reset(),!C&&g.state&(H|V|he)&&(C=d.curRecognizer=g),F++}},get:function(v){if(v instanceof Te)return v;for(var d=this.recognizers,g=0;g<d.length;g++)if(d[g].options.event==v)return d[g];return null},add:function(v){if(u(v,"add",this))return this;var d=this.get(v.options.event);return d&&this.remove(d),this.recognizers.push(v),v.manager=this,this.touchAction.update(),v},remove:function(v){if(u(v,"remove",this))return this;var d=this.recognizers;return v=this.get(v),d.splice(j(d,v),1),this.touchAction.update(),this},on:function(v,d){var g=this.handlers;return p(X(v),function(E){g[E]=g[E]||[],g[E].push(d)}),this},off:function(v,d){var g=this.handlers;return p(X(v),function(E){d?g[E].splice(j(g[E],d),1):delete g[E]}),this},emit:function(v,d){this.options.domEvents&&f0(v,d);var g=this.handlers[v]&&this.handlers[v].slice();if(!(!g||!g.length)){d.type=v,d.preventDefault=function(){d.srcEvent.preventDefault()};for(var E=0;E<g.length;)g[E](d),E++}},destroy:function(){this.element&&bo(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function bo(v,d){var g=v.element;p(v.options.cssProps,function(E,C){g.style[U(g.style,C)]=d?E:""})}function f0(v,d){var g=r.createEvent("Event");g.initEvent(v,!0,!0),g.gesture=d,d.target.dispatchEvent(g)}m(yt,{INPUT_START:Ee,INPUT_MOVE:Ne,INPUT_END:oe,INPUT_CANCEL:de,STATE_POSSIBLE:G,STATE_BEGAN:H,STATE_CHANGED:V,STATE_ENDED:he,STATE_RECOGNIZED:Z,STATE_CANCELLED:ne,STATE_FAILED:le,DIRECTION_NONE:_t,DIRECTION_LEFT:Ge,DIRECTION_RIGHT:$t,DIRECTION_UP:mt,DIRECTION_DOWN:At,DIRECTION_HORIZONTAL:Ie,DIRECTION_VERTICAL:De,DIRECTION_ALL:zt,Manager:gn,Input:xe,TouchAction:O,TouchInput:Ht,MouseInput:Zt,PointerEventInput:Ze,TouchMouseInput:Cr,SingleTouchInput:ei,Recognizer:Te,AttrRecognizer:ke,Tap:li,Pan:hi,Swipe:yn,Pinch:pn,Rotate:mn,Press:_n,on:R,off:$,each:p,merge:x,extend:m,inherit:y,bindFn:M,prefixed:U}),typeof n==o&&n.amd?n(function(){return yt}):e.exports?e.exports=yt:t[i]=yt})(window,document,"Hammer")})(Os);var Is=Os.exports,Yt=Is,J_=1,Bi="MarzipanoHammerElementId";function Ds(e,t){return e[Bi]||(e[Bi]=J_++),t+e[Bi]}function qr(){this._managers={},this._refCount={}}qr.prototype.get=function(e,t){var r=Ds(e,t);return this._managers[r]||(this._managers[r]=this._createManager(e,t),this._refCount[r]=0),this._refCount[r]++,new Xr(this,this._managers[r],e,t)},qr.prototype._createManager=function(e,t){var r=new Yt.Manager(e);return t==="mouse"?r.add(new Yt.Pan({direction:Yt.DIRECTION_ALL,threshold:0})):(t==="touch"||t==="pen"||t==="kinect")&&(r.add(new Yt.Pan({direction:Yt.DIRECTION_ALL,threshold:20,pointers:1})),r.add(new Yt.Pinch)),r},qr.prototype._releaseHandle=function(e,t){var r=Ds(e,t);this._refCount[r]&&(this._refCount[r]--,this._refCount[r]||(this._managers[r].destroy(),delete this._managers[r],delete this._refCount[r]))};function Xr(e,t,r,i){this._manager=t,this._element=r,this._type=i,this._hammerGestures=e,this._eventHandlers=[]}Xr.prototype.on=function(e,t){var r=this._type,i=function(n){r===n.pointerType&&t(n)};this._eventHandlers.push({events:e,handler:i}),this._manager.on(e,i)},Xr.prototype.release=function(){for(var e=0;e<this._eventHandlers.length;e++){var t=this._eventHandlers[e];this._manager.off(t.events,t.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},Xr.prototype.manager=function(){return this._manager};var Ur=new qr;function em(e,t,r,i,n){var a=Math.sqrt(Math.pow(t,2)+Math.pow(r,2));e=Math.max(e,a/i),Hs(t,r,e,n),n[0]=Math.abs(n[0]),n[1]=Math.abs(n[1])}function Hs(e,t,r,i){var n=Math.atan(t/e);i[0]=r*Math.cos(n),i[1]=r*Math.sin(n)}var Fs={maxFriction:em,changeVectorNorm:Hs},tm=se,Vs=nt,rm=Ur,im=Xe,nm=Fs.maxFriction,am=ie,sm={friction:6,maxFrictionTime:.3,hammerEvent:"pan"},Ns=typeof MARZIPANODEBUG<"u"&&MARZIPANODEBUG.controls;function at(e,t,r){if(this._element=e,this._opts=im(r||{},sm),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new Vs,y:new Vs},this._hammer=rm.get(e,t),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),this._opts.hammerEvent!="pan"&&this._opts.hammerEvent!="pinch")throw new Error(this._opts.hammerEvent+" is not a hammerEvent managed in DragControlMethod");this._hammer.on(this._opts.hammerEvent+"start",this._handleStart.bind(this)),this._hammer.on(this._opts.hammerEvent+"move",this._handleMove.bind(this)),this._hammer.on(this._opts.hammerEvent+"end",this._handleEnd.bind(this)),this._hammer.on(this._opts.hammerEvent+"cancel",this._handleEnd.bind(this))}tm(at),at.prototype.destroy=function(){this._hammer.release(),am(this)},at.prototype._handleHammerEvent=function(e){if(e.isFirst){if(Ns&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}if(e.isFinal){if(Ns&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},at.prototype._handleStart=function(e){e.preventDefault(),this._startEvent=e},at.prototype._handleMove=function(e){e.preventDefault(),this._startEvent&&(this._updateDynamicsMove(e),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},at.prototype._handleEnd=function(e){e.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(e),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},at.prototype._updateDynamicsMove=function(e){var t=e.deltaX,r=e.deltaY,i=this._lastEvent||this._startEvent;i&&(t-=i.deltaX,r-=i.deltaY);var n=this._element.getBoundingClientRect(),a=n.right-n.left,s=n.bottom-n.top;t/=a,r/=s,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-t,this._dynamics.y.offset=-r,this._lastEvent=e};var Gi=[null,null];at.prototype._updateDynamicsRelease=function(e){var t=this._element.getBoundingClientRect(),r=t.right-t.left,i=t.bottom-t.top,n=1e3*e.velocityX/r,a=1e3*e.velocityY/i;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=n,this._dynamics.y.velocity=a,nm(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,Gi),this._dynamics.x.friction=Gi[0],this._dynamics.y.friction=Gi[1]};var ks=at,om=se,js=nt,hm=Ur,lm=Xe,cm=Fs.maxFriction,vm=ie,fm={speed:8,friction:6,maxFrictionTime:.3};function Lt(e,t,r){this._element=e,this._opts=lm(r||{},fm),this._active=!1,this._hammer=hm.get(e,t),this._dynamics={x:new js,y:new js},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}om(Lt),Lt.prototype.destroy=function(){this._hammer.release(),vm(this)},Lt.prototype._handleStart=function(e){e.preventDefault(),this._active||(this._active=!0,this.emit("active"))},Lt.prototype._handleMove=function(e){e.preventDefault(),this._updateDynamics(e,!1)},Lt.prototype._handleRelease=function(e){e.preventDefault(),this._updateDynamics(e,!0),this._active&&(this._active=!1,this.emit("inactive"))};var Zi=[null,null];Lt.prototype._updateDynamics=function(e,t){var r=this._element.getBoundingClientRect(),i=r.right-r.left,n=r.bottom-r.top,a=Math.max(i,n),s=e.deltaX/a*this._opts.speed,o=e.deltaY/a*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=s,this._dynamics.y.velocity=o,t&&(cm(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,Zi),this._dynamics.x.friction=Zi[0],this._dynamics.y.friction=Zi[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)};var Ws=Lt,um=se,dm=nt,pm=Xe,_m=ie,mm={frictionTime:.2,zoomDelta:.001};function fr(e,t){this._element=e,this._opts=pm(t||{},mm),this._dynamics=new dm,this._eventList=[];var r=this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing;this._wheelListener=r.bind(this),e.addEventListener("wheel",this._wheelListener)}um(fr),fr.prototype.destroy=function(){this._element.removeEventListener("wheel",this._wheelListener),_m(this)},fr.prototype.withoutSmoothing=function(e){this._dynamics.offset=Ys(e)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),e.preventDefault(),this.emit("active"),this.emit("inactive")},fr.prototype.withSmoothing=function(e){var t=e.timeStamp;for(this._eventList.push(e);this._eventList[0].timeStamp<t-this._opts.frictionTime*1e3;)this._eventList.shift(0);for(var r=0,i=0;i<this._eventList.length;i++){var n=Ys(this._eventList[i])*this._opts.zoomDelta;r+=n/this._opts.frictionTime}this._dynamics.velocity=r,this._dynamics.friction=Math.abs(r)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),e.preventDefault(),this.emit("active"),this.emit("inactive")};function Ys(e){var t=e.deltaMode==1?20:1;return e.deltaY*t}var qs=fr,ym=se,gm=nt,wm=Ur,xm=ie;function qt(e,t,r){this._hammer=wm.get(e,t),this._lastEvent=null,this._active=!1,this._dynamics=new gm,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}ym(qt),qt.prototype.destroy=function(){this._hammer.release(),xm(this)},qt.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},qt.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},qt.prototype._handleEvent=function(e){var t=e.scale;this._lastEvent&&(t/=this._lastEvent.scale),this._dynamics.offset=(t-1)*-1,this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=e};var Xs=qt,Mm=se,Em=nt,Tm=ie;function ur(e){if(!e)throw new Error("VelocityControlMethod: parameter must be defined");this._parameter=e,this._dynamics=new Em}Mm(ur),ur.prototype.destroy=function(){Tm(this)},ur.prototype.setVelocity=function(e){this._dynamics.velocity=e,this.emit("parameterDynamics",this._parameter,this._dynamics)},ur.prototype.setFriction=function(e){this._dynamics.friction=e,this.emit("parameterDynamics",this._parameter,this._dynamics)};var bm=ur,Cm=se,Sm=nt,Pm=ie;function dr(e,t,r,i){if(!e)throw new Error("ElementPressControlMethod: element must be defined");if(!t)throw new Error("ElementPressControlMethod: parameter must be defined");if(!r)throw new Error("ElementPressControlMethod: velocity must be defined");if(!i)throw new Error("ElementPressControlMethod: friction must be defined");this._element=e,this._pressHandler=this._handlePress.bind(this),this._releaseHandler=this._handleRelease.bind(this),e.addEventListener("mousedown",this._pressHandler),e.addEventListener("mouseup",this._releaseHandler),e.addEventListener("mouseleave",this._releaseHandler),e.addEventListener("touchstart",this._pressHandler),e.addEventListener("touchmove",this._releaseHandler),e.addEventListener("touchend",this._releaseHandler),this._parameter=t,this._velocity=r,this._friction=i,this._dynamics=new Sm,this._pressing=!1}Cm(dr),dr.prototype.destroy=function(){this._element.removeEventListener("mousedown",this._pressHandler),this._element.removeEventListener("mouseup",this._releaseHandler),this._element.removeEventListener("mouseleave",this._releaseHandler),this._element.removeEventListener("touchstart",this._pressHandler),this._element.removeEventListener("touchmove",this._releaseHandler),this._element.removeEventListener("touchend",this._releaseHandler),Pm(this)},dr.prototype._handlePress=function(){this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active")},dr.prototype._handleRelease=function(){this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1};var Lm=dr,Rm=se,$m=nt,Am=gt,zm=ie;function Ve(e){e=e||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch","roll"],this._now=e.nowForTesting||Am,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}Rm(Ve),Ve.prototype.add=function(e){if(!this.has(e)){var t={};this._parameters.forEach(function(n){t[n]={dynamics:new $m,time:null}});var r=this._updateDynamics.bind(this,t),i={instance:e,dynamics:t,parameterDynamicsHandler:r};e.addEventListener("parameterDynamics",r),this._methods.push(i)}},Ve.prototype.remove=function(e){var t=this._indexOfInstance(e);if(t>=0){var r=this._methods.splice(t,1)[0];r.instance.removeEventListener("parameterDynamics",r.parameterDynamicsHandler)}},Ve.prototype.has=function(e){return this._indexOfInstance(e)>=0},Ve.prototype._indexOfInstance=function(e){for(var t=0;t<this._methods.length;t++)if(this._methods[t].instance===e)return t;return-1},Ve.prototype.list=function(){for(var e=[],t=0;t<this._methods.length;t++)e.push(this._methods[t].instance);return e},Ve.prototype._updateDynamics=function(e,t,r){var i=e[t];if(!i)throw new Error("Unknown control parameter "+t);var n=this._now();i.dynamics.update(r,(n-i.time)/1e3),i.time=n,this.emit("change")},Ve.prototype._resetComposedOffsets=function(){for(var e=0;e<this._parameters.length;e++)this._composedOffsets[this._parameters[e]]=0},Ve.prototype.offsets=function(){var e,t=!1,r=this._now();this._resetComposedOffsets();for(var i=0;i<this._methods.length;i++)for(var n=this._methods[i].dynamics,a=0;a<this._parameters.length;a++){e=this._parameters[a];var s=n[e],o=s.dynamics;o.offset!=null&&(this._composedOffsets[e]+=o.offset,o.offset=null);var h=(r-s.time)/1e3,l=o.offsetFromVelocity(h);l&&(this._composedOffsets[e]+=l);var c=o.velocityAfter(h);o.velocity=c,c&&(t=!0),s.time=r}return this._composeReturn.changing=t,this._composeReturn},Ve.prototype.destroy=function(){for(var e=this.list(),t=0;t<e.length;t++)this.remove(e[t]);zm(this)};var Om=Ve,Im=se,Dm=Om,Hm=ie,Us=typeof MARZIPANODEBUG<"u"&&MARZIPANODEBUG.controls;function te(e){e=e||{},this._methods={},this._methodGroups={},this._composer=new Dm,this._enabled=e&&e.enabled?!!e.enabled:!0,this._activeCount=0,this.updatedViews_=[],this._attachedRenderLoop=null}Im(te),te.prototype.destroy=function(){this.detach(),this._composer.destroy(),Hm(this)},te.prototype.methods=function(){var e={};for(var t in this._methods)e[t]=this._methods[t];return e},te.prototype.method=function(e){return this._methods[e]},te.prototype.registerMethod=function(e,t,r){if(this._methods[e])throw new Error("Control method already registered with id "+e);this._methods[e]={instance:t,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,e),inactiveHandler:this._handleInactive.bind(this,e)},r&&this.enableMethod(e,t)},te.prototype.unregisterMethod=function(e){var t=this._methods[e];if(!t)throw new Error("No control method registered with id "+e);t.enabled&&this.disableMethod(e),delete this._methods[e]},te.prototype.enableMethod=function(e){var t=this._methods[e];if(!t)throw new Error("No control method registered with id "+e);t.enabled||(t.enabled=!0,t.active&&this._incrementActiveCount(),this._listen(e),this._updateComposer(),this.emit("methodEnabled",e))},te.prototype.disableMethod=function(e){var t=this._methods[e];if(!t)throw new Error("No control method registered with id "+e);t.enabled&&(t.enabled=!1,t.active&&this._decrementActiveCount(),this._unlisten(e),this._updateComposer(),this.emit("methodDisabled",e))},te.prototype.addMethodGroup=function(e,t){this._methodGroups[e]=t},te.prototype.removeMethodGroup=function(e){delete this._methodGroups[e]},te.prototype.methodGroups=function(){var e={};for(var t in this._methodGroups)e[t]=this._methodGroups[t];return e},te.prototype.enableMethodGroup=function(e){var t=this;t._methodGroups[e].forEach(function(r){t.enableMethod(r)})},te.prototype.disableMethodGroup=function(e){var t=this;t._methodGroups[e].forEach(function(r){t.disableMethod(r)})},te.prototype.enabled=function(){return this._enabled},te.prototype.enable=function(){this._enabled||(this._enabled=!0,this._activeCount>0&&this.emit("active"),this.emit("enabled"),this._updateComposer())},te.prototype.disable=function(){this._enabled&&(this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this.emit("disabled"),this._updateComposer())},te.prototype.attach=function(e){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=e,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=e.renderOnNextFrame.bind(e),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},te.prototype.detach=function(){this._attachedRenderLoop&&(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},te.prototype.attached=function(){return this._attachedRenderLoop!=null},te.prototype._listen=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");t.instance.addEventListener("active",t.activeHandler),t.instance.addEventListener("inactive",t.inactiveHandler)},te.prototype._unlisten=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");t.instance.removeEventListener("active",t.activeHandler),t.instance.removeEventListener("inactive",t.inactiveHandler)},te.prototype._handleActive=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");if(!t.enabled)throw new Error("Should not receive event from disabled control method");t.active||(t.active=!0,this._incrementActiveCount())},te.prototype._handleInactive=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");if(!t.enabled)throw new Error("Should not receive event from disabled control method");t.active&&(t.active=!1,this._decrementActiveCount())},te.prototype._incrementActiveCount=function(){this._activeCount++,Us&&this._checkActiveCount(),this._enabled&&this._activeCount===1&&this.emit("active")},te.prototype._decrementActiveCount=function(){this._activeCount--,Us&&this._checkActiveCount(),this._enabled&&this._activeCount===0&&this.emit("inactive")},te.prototype._checkActiveCount=function(){var e=0;for(var t in this._methods){var r=this._methods[t];r.enabled&&r.active&&e++}if(e!=this._activeCount)throw new Error("Bad control state")},te.prototype._updateComposer=function(){var e=this._composer;for(var t in this._methods){var r=this._methods[t],i=this._enabled&&r.enabled;i&&!e.has(r.instance)&&e.add(r.instance),!i&&e.has(r.instance)&&e.remove(r.instance)}},te.prototype._updateViewsWithControls=function(){var e=this._composer.offsets();e.changing&&this._attachedRenderLoop.renderOnNextFrame(),this.updatedViews_.length=0;for(var t=this._attachedRenderLoop.stage().listLayers(),r=0;r<t.length;r++){var i=t[r].view();this.updatedViews_.indexOf(i)<0&&(t[r].view().updateWithControlParameters(e.offsets),this.updatedViews_.push(i))}};var Bs=te,Fm=Pe.setTransform,Gs=Wi;function Vm(e,t,r,i){i=i||"";var n="translateX("+Gs(t)+"px) translateY("+Gs(r)+"px) translateZ(0) "+i;Fm(e,n)}var Zs=Vm,Nm=se,km=Zs,jm=Pe.setTransform,Wm=ie;function Le(e,t,r,i,n){n=n||{},n.perspective=n.perspective||{},n.perspective.extraTransforms=n.perspective.extraTransforms!=null?n.perspective.extraTransforms:"",this._domElement=e,this._parentDomElement=t,this._view=r,this._coords={},this._perspective={},this.setPosition(i),this._parentDomElement.appendChild(this._domElement),this.setPerspective(n.perspective),this._visible=!0,this._position={x:0,y:0}}Nm(Le),Le.prototype.destroy=function(){this._parentDomElement.removeChild(this._domElement),Wm(this)},Le.prototype.domElement=function(){return this._domElement},Le.prototype.position=function(){return this._coords},Le.prototype.setPosition=function(e){for(var t in e)this._coords[t]=e[t];this._update()},Le.prototype.perspective=function(){return this._perspective},Le.prototype.setPerspective=function(e){for(var t in e)this._perspective[t]=e[t];this._update()},Le.prototype.show=function(){this._visible||(this._visible=!0,this._update())},Le.prototype.hide=function(){this._visible&&(this._visible=!1,this._update())},Le.prototype._update=function(){var e=this._domElement,t=this._coords,r=this._position,i,n,a=!1;if(this._visible){var s=this._view;this._perspective.radius?(a=!0,this._setEmbeddedPosition(s,t)):(s.coordinatesToScreen(t,r),i=r.x,n=r.y,i!=null&&n!=null&&(a=!0,this._setPosition(i,n)))}a?(e.style.display="block",e.style.position="absolute"):(e.style.display="none",e.style.position="")},Le.prototype._setEmbeddedPosition=function(e,t){var r=e.coordinatesToPerspectiveTransform(t,this._perspective.radius,this._perspective.extraTransforms);jm(this._domElement,r)},Le.prototype._setPosition=function(e,t){km(this._domElement,e,t,this._perspective.extraTransforms)};var Ks=Le,Ym=se,qm=Ks,Xm=Mn,Qs=Zs,Js=Pe.setAbsolute,Um=Pe.setOverflowHidden,Bm=Pe.setOverflowVisible,Gm=Pe.setNullSize,Zm=Pe.setPixelSize,eo=Pe.setWithVendorPrefix("pointer-events"),Km=ie;function Re(e,t,r,i,n){n=n||{},this._parentDomElement=e,this._stage=t,this._view=r,this._renderLoop=i,this._hotspots=[],this._visible=!0,this._rect=n.rect,this._visibilityOrRectChanged=!0,this._stageWidth=null,this._stageHeight=null,this._tmpRect={},this._hotspotContainerWrapper=document.createElement("div"),Js(this._hotspotContainerWrapper),eo(this._hotspotContainerWrapper,"none"),this._parentDomElement.appendChild(this._hotspotContainerWrapper),this._hotspotContainer=document.createElement("div"),Js(this._hotspotContainer),eo(this._hotspotContainer,"all"),this._hotspotContainerWrapper.appendChild(this._hotspotContainer),this._updateHandler=this._update.bind(this),this._renderLoop.addEventListener("afterRender",this._updateHandler)}Ym(Re),Re.prototype.destroy=function(){for(;this._hotspots.length;)this.destroyHotspot(this._hotspots[0]);this._parentDomElement.removeChild(this._hotspotContainerWrapper),this._renderLoop.removeEventListener("afterRender",this._updateHandler),Km(this)},Re.prototype.domElement=function(){return this._hotspotContainer},Re.prototype.setRect=function(e){this._rect=e,this._visibilityOrRectChanged=!0},Re.prototype.rect=function(){return this._rect},Re.prototype.createHotspot=function(e,t,r){t=t||{};var i=new qm(e,this._hotspotContainer,this._view,t,r);return this._hotspots.push(i),i._update(),this.emit("hotspotsChange"),i},Re.prototype.hasHotspot=function(e){return this._hotspots.indexOf(e)>=0},Re.prototype.listHotspots=function(){return[].concat(this._hotspots)},Re.prototype.destroyHotspot=function(e){var t=this._hotspots.indexOf(e);if(t<0)throw new Error("No such hotspot");this._hotspots.splice(t,1),e.destroy(),this.emit("hotspotsChange")},Re.prototype.hide=function(){this._visible&&(this._visible=!1,this._visibilityOrRectChanged=!0,this._update())},Re.prototype.show=function(){this._visible||(this._visible=!0,this._visibilityOrRectChanged=!0,this._update())},Re.prototype._update=function(){var e=this._hotspotContainerWrapper,t=this._stage.width(),r=this._stage.height(),i=this._tmpRect;if(this._visibilityOrRectChanged||this._rect&&(t!==this._stageWidth||r!==this._stageHeight)){var n=this._visible;e.style.display=n?"block":"none",n&&(this._rect?(Xm(t,r,this._rect,i),Qs(e,t*i.x,r*i.y),Zm(e,t*i.width,r*i.height),Um(e)):(Qs(e,0,0),Gm(e),Bm(e))),this._stageWidth=t,this._stageHeight=r,this._visibilityOrRectChanged=!1}for(var a=0;a<this._hotspots.length;a++)this._hotspots[a]._update()};var to=Re,Qm=$s,Jm=Ls,e1=to,t1=se,ro=gt,r1=hr,i1=ir,io=Xe,n1=ie;function ue(e,t){this._viewer=e,this._view=t,this._layers=[],this._hotspotContainer=new e1(e._controlContainer,e.stage(),this._view,e.renderLoop()),this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotContainerHandler=this._updateHotspotContainer.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotContainerHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._view.addEventListener("change",this._viewChangeHandler),this._updateHotspotContainer()}t1(ue),ue.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotContainerHandler),this._movement&&this.stopMovement(),this._hotspotContainer.destroy(),this.destroyAllLayers(),n1(this)},ue.prototype.hotspotContainer=function(){return this._hotspotContainer},ue.prototype.layer=function(){return this._layers[0]},ue.prototype.listLayers=function(){return[].concat(this._layers)},ue.prototype.view=function(){return this._view},ue.prototype.viewer=function(){return this._viewer},ue.prototype.visible=function(){return this._viewer.scene()===this},ue.prototype.createLayer=function(e){e=e||{};var t=e.textureStoreOpts||{},r=e.layerOpts||{},i=e.source,n=e.geometry,a=this._view,s=this._viewer.stage(),o=new Jm(i,s,t),h=new Qm(i,n,a,o,r);return this._layers.push(h),e.pinFirstLevel&&h.pinFirstLevel(),this.emit("layerChange"),h},ue.prototype.destroyLayer=function(e){var t=this._layers.indexOf(e);if(t<0)throw new Error("No such layer in scene");this._layers.splice(t,1),this.emit("layerChange"),e.textureStore().destroy(),e.destroy()},ue.prototype.destroyAllLayers=function(){for(;this._layers.length>0;)this.destroyLayer(this._layers[0])},ue.prototype.switchTo=function(e,t){return this._viewer.switchScene(this,e,t)},ue.prototype.lookTo=function(e,t,r){var i=this;if(t=t||{},r=r||r1,i1(e)!=="object")throw new Error("Target view parameters must be an object");var n=function(m){return(m*=2)<1?.5*m*m:-.5*(--m*(m-2)-1)},a=t.ease!=null?t.ease:n,s=t.controlsInterrupt!=null?t.controlsInterrupt:!1,o=t.transitionDuration!=null?t.transitionDuration:1e3,h=t.shortest!=null?t.shortest:!0,l=this._view,c=l.parameters(),f={};io(f,e),io(f,c),h&&l.normalizeToClosest&&l.normalizeToClosest(f,f);var u=function(){var m=!1;return function(x,y){if(y>=o&&m)return null;var M=Math.min(y/o,1);for(var b in x){var L=c[b],R=f[b];x[b]=L+a(M)*(R-L)}return m=y>=o,x}},p=this._viewer.controls().enabled();s||this._viewer.controls().disable(),this.startMovement(u,function(){p&&i._viewer.controls().enable(),r()})},ue.prototype.startMovement=function(e,t){var r=this._viewer.renderLoop();this._movement&&this.stopMovement();var i=e();if(typeof i!="function")throw new Error("Bad movement");this._movement=e,this._movementStep=i,this._movementStartTime=ro(),this._movementParams={},this._movementCallback=t,r.addEventListener("beforeRender",this._updateMovementHandler),r.renderOnNextFrame()},ue.prototype.stopMovement=function(){var e=this._movementCallback,t=this._viewer.renderLoop();this._movement&&(this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null,t.removeEventListener("beforeRender",this._updateMovementHandler),e&&e())},ue.prototype.movement=function(){return this._movement},ue.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var e=this._viewer.renderLoop(),t=this._view,r=ro()-this._movementStartTime,i=this._movementStep,n=this._movementParams;n=t.parameters(n),n=i(n,r),n==null?this.stopMovement():(t.setParameters(n),e.renderOnNextFrame())},ue.prototype._updateHotspotContainer=function(){this.visible()?this._hotspotContainer.show():this._hotspotContainer.hide()};var no=ue,a1=se,s1=Xe,ao=gt,o1={duration:1/0};function Ue(e){e=s1(e||{},o1),this._duration=e.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}a1(Ue),Ue.prototype.start=function(){this._startTime=ao(),this._handle==null&&this._duration<1/0&&this._setup(this._duration)},Ue.prototype.started=function(){return this._startTime!=null},Ue.prototype.stop=function(){this._startTime=null,this._handle!=null&&(clearTimeout(this._handle),this._handle=null)},Ue.prototype._setup=function(e){this._handle=setTimeout(this._check,e)},Ue.prototype._teardown=function(){clearTimeout(this._handle),this._handle=null},Ue.prototype._check=function(){var e=ao(),t=e-this._startTime,r=this._duration-t;this._teardown(),r<=0?(this.emit("timeout"),this._startTime=null):r<1/0&&this._setup(r)},Ue.prototype.duration=function(){return this._duration},Ue.prototype.setDuration=function(e){this._duration=e,this._startTime!=null&&this._check()};var h1=Ue,l1=Xe,c1=ie,v1={active:"move",inactive:"default",disabled:"default"};function Xt(e,t,r,i){i=l1(i||{},v1),this._element=r,this._controls=e,this._id=t,this._attached=!1,this._setActiveCursor=this._setCursor.bind(this,i.active),this._setInactiveCursor=this._setCursor.bind(this,i.inactive),this._setDisabledCursor=this._setCursor.bind(this,i.disabled),this._setOriginalCursor=this._setCursor.bind(this,this._element.style.cursor),this._updateAttachmentHandler=this._updateAttachment.bind(this),e.addEventListener("methodEnabled",this._updateAttachmentHandler),e.addEventListener("methodDisabled",this._updateAttachmentHandler),e.addEventListener("enabled",this._updateAttachmentHandler),e.addEventListener("disabled",this._updateAttachmentHandler),this._updateAttachment()}Xt.prototype.destroy=function(){this._detachFromControlMethod(this._controls.method(this._id)),this._setOriginalCursor(),this._controls.removeEventListener("methodEnabled",this._updateAttachmentHandler),this._controls.removeEventListener("methodDisabled",this._updateAttachmentHandler),this._controls.removeEventListener("enabled",this._updateAttachmentHandler),this._controls.removeEventListener("disabled",this._updateAttachmentHandler),c1(this)},Xt.prototype._updateAttachment=function(){var e=this._controls,t=this._id;e.enabled()&&e.method(t).enabled?this._attachToControlMethod(e.method(t)):this._detachFromControlMethod(e.method(t))},Xt.prototype._attachToControlMethod=function(e){this._attached||(e.instance.addEventListener("active",this._setActiveCursor),e.instance.addEventListener("inactive",this._setInactiveCursor),e.active?this._setActiveCursor():this._setInactiveCursor(),this._attached=!0)},Xt.prototype._detachFromControlMethod=function(e){this._attached&&(e.instance.removeEventListener("active",this._setActiveCursor),e.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor(),this._attached=!1)},Xt.prototype._setCursor=function(e){this._element.style.cursor=e};var f1=Xt,u1=Xe,Ki=ks,d1=Ws,p1=qs,_1=Xs,ze=zs,m1={mouseViewMode:"drag",dragMode:"pan"};function y1(e,t,r){r=u1(r||{},m1);var i={mouseViewDrag:new Ki(t,"mouse"),mouseViewQtvr:new d1(t,"mouse"),leftArrowKey:new ze(37,"x",-.7,3),rightArrowKey:new ze(39,"x",.7,3),upArrowKey:new ze(38,"y",-.7,3),downArrowKey:new ze(40,"y",.7,3),plusKey:new ze(107,"zoom",-.7,3),minusKey:new ze(109,"zoom",.7,3),wKey:new ze(87,"y",-.7,3),aKey:new ze(65,"x",-.7,3),sKey:new ze(83,"y",.7,3),dKey:new ze(68,"x",.7,3),qKey:new ze(81,"roll",.7,3),eKey:new ze(69,"roll",-.7,3)},n=["scrollZoom","touchView","pinch"];r.scrollZoom!==!1&&(i.scrollZoom=new p1(t));var a={arrowKeys:["leftArrowKey","rightArrowKey","upArrowKey","downArrowKey"],plusMinusKeys:["plusKey","minusKey"],wasdKeys:["wKey","aKey","sKey","dKey"],qeKeys:["qKey","eKey"]};switch(r.dragMode){case"pinch":i.pinch=new Ki(t,"touch",{hammerEvent:"pinch"});break;case"pan":i.touchView=new Ki(t,"touch"),i.pinch=new _1(t,"touch");break;default:throw new Error("Unknown drag mode: "+r.dragMode)}switch(r.mouseViewMode){case"drag":n.push("mouseViewDrag");break;case"qtvr":n.push("mouseViewQtvr");break;default:throw new Error("Unknown mouse view mode: "+r.mouseViewMode)}for(var s in i){var o=i[s];e.registerMethod(s,o),n.indexOf(s)>=0&&e.enableMethod(s)}for(var h in a){var l=a[h];e.addMethodGroup(h,l)}return i}var so=y1,oo=gt;function g1(e,t,r){var i=!1,n=oo();function a(){if(!i){var s=(oo()-n)/e;s<1?(t(s),requestAnimationFrame(a)):(t(1),r())}}return t(0),requestAnimationFrame(a),function(){i=!0,r.apply(null,arguments)}}var ho=g1,w1=se,x1=As,M1=Bs,E1=no,T1=h1,b1=On,C1=f1,lo=Ur,S1=so,P1=ns,L1=Pe.setOverflowHidden,R1=Pe.setAbsolute,$1=Pe.setFullSize,A1=ho,z1=hr,O1=ie;function Q(e,t){t=t||{},this._domElement=e,L1(e),this._stage=new b1(t.stage),P1(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),R1(this._controlContainer),$1(this._controlContainer),e.appendChild(this._controlContainer),this._size={},this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new x1(this._stage),this._controls=new M1,this._controlMethods=S1(this._controls,this._controlContainer,t.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=lo.get(this._controlContainer,"touch"),this._hammerManagerMouse=lo.get(this._controlContainer,"mouse"),this._dragCursor=new C1(this._controls,"mouseViewDrag",e,t.cursors&&t.cursors.drag||{}),this._renderLoop.start(),this._scenes=[],this._currentScene=null,this._replacedScene=null,this._cancelCurrentTween=null,this._layerChangeHandler=this._updateSceneLayers.bind(this),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new T1,this._idleTimer.start(),this._resetIdleTimerHandler=this._resetIdleTimer.bind(this),this.addEventListener("viewChange",this._resetIdleTimerHandler),this._triggerIdleTimerHandler=this._triggerIdleTimer.bind(this),this._idleTimer.addEventListener("timeout",this._triggerIdleTimerHandler),this._stopMovementHandler=this.stopMovement.bind(this),this._controls.addEventListener("active",this._stopMovementHandler),this.addEventListener("sceneChange",this._stopMovementHandler),this._idleMovement=null}w1(Q),Q.prototype.destroy=function(){window.removeEventListener("resize",this._updateSizeListener),this._currentScene&&this._removeSceneEventListeners(this._currentScene),this._replacedScene&&this._removeSceneEventListeners(this._replacedScene),this._dragCursor.destroy();for(var e in this._controlMethods)this._controlMethods[e].destroy();for(;this._scenes.length;)this.destroyScene(this._scenes[0]);this._domElement.removeChild(this._stage.domElement()),this._stage.destroy(),this._renderLoop.destroy(),this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&this._cancelCurrentTween(),O1(this)},Q.prototype.updateSize=function(){var e=this._size;e.width=this._domElement.clientWidth,e.height=this._domElement.clientHeight,this._stage.setSize(e)},Q.prototype.stage=function(){return this._stage},Q.prototype.renderLoop=function(){return this._renderLoop},Q.prototype.controls=function(){return this._controls},Q.prototype.domElement=function(){return this._domElement},Q.prototype.createScene=function(e){e=e||{};var t=this.createEmptyScene({view:e.view});return t.createLayer({source:e.source,geometry:e.geometry,pinFirstLevel:e.pinFirstLevel,textureStoreOpts:e.textureStoreOpts,layerOpts:e.layerOpts}),t},Q.prototype.createEmptyScene=function(e){e=e||{};var t=new E1(this,e.view);return this._scenes.push(t),t},Q.prototype._updateSceneLayers=function(){var e,t,r=this._stage,i=this._currentScene,n=this._replacedScene,a=r.listLayers(),s=[];if(n&&(s=s.concat(n.listLayers())),i&&(s=s.concat(i.listLayers())),Math.abs(a.length-s.length)!==1)throw new Error("Stage and scene out of sync");if(s.length<a.length){for(e=0;e<a.length;e++)if(t=a[e],s.indexOf(t)<0){this._removeLayerFromStage(t);break}}if(s.length>a.length)for(e=0;e<s.length;e++)t=s[e],a.indexOf(t)<0&&this._addLayerToStage(t,e)},Q.prototype._addLayerToStage=function(e,t){e.pinFirstLevel(),this._stage.addLayer(e,t)},Q.prototype._removeLayerFromStage=function(e){this._stage.removeLayer(e),e.unpinFirstLevel(),e.textureStore().clearNotPinned()},Q.prototype._addSceneEventListeners=function(e){e.addEventListener("layerChange",this._layerChangeHandler),e.addEventListener("viewChange",this._viewChangeHandler)},Q.prototype._removeSceneEventListeners=function(e){e.removeEventListener("layerChange",this._layerChangeHandler),e.removeEventListener("viewChange",this._viewChangeHandler)},Q.prototype.destroyScene=function(e){var t=this._scenes.indexOf(e);if(t<0)throw new Error("No such scene in viewer");var r,i;if(this._currentScene===e){for(this._removeSceneEventListeners(e),i=e.listLayers(),r=0;r<i.length;r++)this._removeLayerFromStage(i[r]);this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._currentScene=null,this.emit("sceneChange")}if(this._replacedScene===e){for(this._removeSceneEventListeners(e),i=e.listLayers(),r=0;r<i.length;r++)this._removeLayerFromStage(i[r]);this._replacedScene=null}this._scenes.splice(t,1),e.destroy()},Q.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},Q.prototype.hasScene=function(e){return this._scenes.indexOf(e)>=0},Q.prototype.listScenes=function(){return[].concat(this._scenes)},Q.prototype.scene=function(){return this._currentScene},Q.prototype.view=function(){var e=this._currentScene;return e?e.view():null},Q.prototype.lookTo=function(e,t,r){var i=this._currentScene;i&&i.lookTo(e,t,r)},Q.prototype.startMovement=function(e,t){var r=this._currentScene;r&&r.startMovement(e,t)},Q.prototype.stopMovement=function(){var e=this._currentScene;e&&e.stopMovement()},Q.prototype.movement=function(){var e=this._currentScene;if(e)return e.movement()},Q.prototype.setIdleMovement=function(e,t){this._idleTimer.setDuration(e),this._idleMovement=t},Q.prototype.breakIdleMovement=function(){this.stopMovement(),this._resetIdleTimer()},Q.prototype._resetIdleTimer=function(){this._idleTimer.start()},Q.prototype._triggerIdleTimer=function(){var e=this._idleMovement;e&&this.startMovement(e)};var I1=1e3;function D1(e,t,r){var i=t.listLayers();i.forEach(function(n){n.mergeEffects({opacity:e})}),t._hotspotContainer.domElement().style.opacity=e}Q.prototype.switchScene=function(e,t,r){var i=this;t=t||{},r=r||z1;var n=this._stage,a=this._currentScene;if(a===e){r();return}if(this._scenes.indexOf(e)<0)throw new Error("No such scene in viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var s=a?a.listLayers():[],o=e.listLayers(),h=n.listLayers();if(a&&(h.length!==s.length||h.length>1&&h[0]!=s[0]))throw new Error("Stage not in sync with viewer");for(var l=t.transitionDuration!=null?t.transitionDuration:I1,c=t.transitionUpdate!=null?t.transitionUpdate:D1,f=0;f<o.length;f++)this._addLayerToStage(o[f]);function u(m){c(m,e,a)}function p(){if(i._replacedScene){i._removeSceneEventListeners(i._replacedScene),s=i._replacedScene.listLayers();for(var m=0;m<s.length;m++)i._removeLayerFromStage(s[m]);i._replacedScene=null}i._cancelCurrentTween=null,r()}this._cancelCurrentTween=A1(l,u,p),this._currentScene=e,this._replacedScene=a,this.emit("sceneChange"),this.emit("viewChange"),this._addSceneEventListeners(e)};var H1=Q,Br=ye.vec4,F1=ye.mat4;function V1(e){var t=e||{};return t.colorOffset=t.colorOffset||Br.create(),t.colorMatrix=t.colorMatrix||F1.create(),t}function co(e,t,r){N1(r,e,t.colorMatrix),Br.add(r,r,t.colorOffset)}function N1(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3];return e[0]=r[0]*i+r[1]*n+r[2]*a+r[3]*s,e[1]=r[4]*i+r[5]*n+r[6]*a+r[7]*s,e[2]=r[8]*i+r[9]*n+r[10]*a+r[11]*s,e[3]=r[12]*i+r[13]*n+r[14]*a+r[15]*s,e}var Rt=Br.create();function k1(e,t){for(var r=e.width,i=e.height,n=e.data,a=0;a<r*i;a++)Br.set(Rt,n[a*4+0]/255,n[a*4+1]/255,n[a*4+2]/255,n[a*4+3]/255),co(Rt,t,Rt),n[a*4+0]=Rt[0]*255,n[a*4+1]=Rt[1]*255,n[a*4+2]=Rt[2]*255,n[a*4+3]=Rt[3]*255}var j1={identity:V1,applyToPixel:co,applyToImageData:k1},W1=Xe,Qi=.1,Ji=.01,Y1={yawSpeed:Qi,pitchSpeed:Qi,fovSpeed:Qi,yawAccel:Ji,pitchAccel:Ji,fovAccel:Ji,targetPitch:0,targetFov:null};function q1(e){e=W1(e||{},Y1);var t=e.yawSpeed,r=e.pitchSpeed,i=e.fovSpeed,n=e.yawAccel,a=e.pitchAccel,s=e.fovAccel,o=e.targetPitch,h=e.targetFov;return function(){var c=0,f=0,u=0,p=0,m=0,x=0,y=0,M,b,L,R;return function(P,k){if(M=(k-c)/1e3,m=Math.min(f+M*n,t),b=m*M,P.yaw=P.yaw+b,o!=null&&P.pitch!==o){var X=.5*u*u/a;Math.abs(o-P.pitch)>X?x=Math.min(u+M*a,r):x=Math.max(u-M*a,0),L=x*M,o<P.pitch&&(P.pitch=Math.max(o,P.pitch-L)),o>P.pitch&&(P.pitch=Math.min(o,P.pitch+L))}if(h!=null&&P.fov!==o){var j=.5*p*p/s;Math.abs(h-P.fov)>j?y=Math.min(p+M*s,i):y=Math.max(p-M*s,0),R=y*M,h<P.fov&&(P.fov=Math.max(h,P.fov-R)),h>P.fov&&(P.fov=Math.min(h,P.fov+R))}return c=k,f=m,u=x,p=y,P}}}var X1=q1;function U1(e,t){function r(){t&&t.length>0?e.apply(null,t):e()}setTimeout(r,0)}var B1=U1;function G1(e){return e*Math.PI/180}var Z1=G1;function K1(e){return e*180/Math.PI}var Q1=K1,we={WebGlStage:On,WebGlCubeRenderer:Ja,WebGlFlatRenderer:ts,WebGlEquirectRenderer:is,registerDefaultRenderers:ns,CubeGeometry:up,FlatGeometry:Ep,EquirectGeometry:Lp,RectilinearView:Zp,FlatView:a_,ImageUrlSource:M_,SingleAssetSource:E_,StaticAsset:di,DynamicAsset:P_,TextureStore:Ls,Layer:$s,RenderLoop:As,KeyControlMethod:zs,DragControlMethod:ks,QtvrControlMethod:Ws,ScrollZoomControlMethod:qs,PinchZoomControlMethod:Xs,VelocityControlMethod:bm,ElementPressControlMethod:Lm,Controls:Bs,Dynamics:nt,Viewer:H1,Scene:no,Hotspot:Ks,HotspotContainer:to,colorEffects:j1,registerDefaultControls:so,autorotate:X1,util:{async:En,cancelize:Tn,chain:qi,clamp:Vt,clearOwnProperties:ie,cmp:tr,compose:ps,convertFov:ds,decimal:Wi,defaults:Xe,defer:B1,degToRad:Z1,delay:xs,dom:Pe,extend:Rs,hash:Fr,inherits:je,mod:ot,noop:hr,now:gt,once:vi,pixelRatio:Rr,radToDeg:Q1,real:ji,retry:Ts,tween:ho,type:ir},dependencies:{bowser:pi,glMatrix:ye,eventEmitter:se,hammerjs:Is}};const J1=Co({__proto__:null,default:So(we)},[we]);var Ut=function(){return Ut=Object.assign||function(t){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},Ut.apply(this,arguments)};typeof SuppressedError=="function"&&SuppressedError;var en={exports:{}},pr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vo;function e0(){if(vo)return pr;vo=1;var e=ae,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(o,h,l){var c,f={},u=null,p=null;l!==void 0&&(u=""+l),h.key!==void 0&&(u=""+h.key),h.ref!==void 0&&(p=h.ref);for(c in h)i.call(h,c)&&!a.hasOwnProperty(c)&&(f[c]=h[c]);if(o&&o.defaultProps)for(c in h=o.defaultProps,h)f[c]===void 0&&(f[c]=h[c]);return{$$typeof:t,type:o,key:u,ref:p,props:f,_owner:n.current}}return pr.Fragment=r,pr.jsx=s,pr.jsxs=s,pr}var _r={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fo;function t0(){return fo||(fo=1,process.env.NODE_ENV!=="production"&&function(){var e=ae,t=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),m=Symbol.iterator,x="@@iterator";function y(_){if(_===null||typeof _!="object")return null;var T=m&&_[m]||_[x];return typeof T=="function"?T:null}var M=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function b(_){{for(var T=arguments.length,S=new Array(T>1?T-1:0),O=1;O<T;O++)S[O-1]=arguments[O];L("error",_,S)}}function L(_,T,S){{var O=M.ReactDebugCurrentFrame,B=O.getStackAddendum();B!==""&&(T+="%s",S=S.concat([B]));var G=S.map(function(H){return String(H)});G.unshift("Warning: "+T),Function.prototype.apply.call(console[_],console,G)}}var R=!1,$=!1,P=!1,k=!1,X=!1,j;j=Symbol.for("react.module.reference");function W(_){return!!(typeof _=="string"||typeof _=="function"||_===i||_===a||X||_===n||_===l||_===c||k||_===p||R||$||P||typeof _=="object"&&_!==null&&(_.$$typeof===u||_.$$typeof===f||_.$$typeof===s||_.$$typeof===o||_.$$typeof===h||_.$$typeof===j||_.getModuleId!==void 0))}function D(_,T,S){var O=_.displayName;if(O)return O;var B=T.displayName||T.name||"";return B!==""?S+"("+B+")":S}function U(_){return _.displayName||"Context"}function Y(_){if(_==null)return null;if(typeof _.tag=="number"&&b("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case i:return"Fragment";case r:return"Portal";case a:return"Profiler";case n:return"StrictMode";case l:return"Suspense";case c:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case o:var T=_;return U(T)+".Consumer";case s:var S=_;return U(S._context)+".Provider";case h:return D(_,_.render,"ForwardRef");case f:var O=_.displayName||null;return O!==null?O:Y(_.type)||"Memo";case u:{var B=_,G=B._payload,H=B._init;try{return Y(H(G))}catch{return null}}}return null}var z=Object.assign,w=0,Oe,re,Be,$e,Me,Zr,Bt;function Kr(){}Kr.__reactDisabledLog=!0;function tn(){{if(w===0){Oe=console.log,re=console.info,Be=console.warn,$e=console.error,Me=console.group,Zr=console.groupCollapsed,Bt=console.groupEnd;var _={configurable:!0,enumerable:!0,value:Kr,writable:!0};Object.defineProperties(console,{info:_,log:_,warn:_,error:_,group:_,groupCollapsed:_,groupEnd:_})}w++}}function Ee(){{if(w--,w===0){var _={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:z({},_,{value:Oe}),info:z({},_,{value:re}),warn:z({},_,{value:Be}),error:z({},_,{value:$e}),group:z({},_,{value:Me}),groupCollapsed:z({},_,{value:Zr}),groupEnd:z({},_,{value:Bt})})}w<0&&b("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Ne=M.ReactCurrentDispatcher,oe;function de(_,T,S){{if(oe===void 0)try{throw Error()}catch(B){var O=B.stack.trim().match(/\n( *(at )?)/);oe=O&&O[1]||""}return`
`+oe+_}}var _t=!1,Ge;{var $t=typeof WeakMap=="function"?WeakMap:Map;Ge=new $t}function mt(_,T){if(!_||_t)return"";{var S=Ge.get(_);if(S!==void 0)return S}var O;_t=!0;var B=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var G;G=Ne.current,Ne.current=null,tn();try{if(T){var H=function(){throw Error()};if(Object.defineProperty(H.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(H,[])}catch(He){O=He}Reflect.construct(_,[],H)}else{try{H.call()}catch(He){O=He}_.call(H.prototype)}}else{try{throw Error()}catch(He){O=He}_()}}catch(He){if(He&&O&&typeof He.stack=="string"){for(var V=He.stack.split(`
`),he=O.stack.split(`
`),Z=V.length-1,ne=he.length-1;Z>=1&&ne>=0&&V[Z]!==he[ne];)ne--;for(;Z>=1&&ne>=0;Z--,ne--)if(V[Z]!==he[ne]){if(Z!==1||ne!==1)do if(Z--,ne--,ne<0||V[Z]!==he[ne]){var le=`
`+V[Z].replace(" at new "," at ");return _.displayName&&le.includes("<anonymous>")&&(le=le.replace("<anonymous>",_.displayName)),typeof _=="function"&&Ge.set(_,le),le}while(Z>=1&&ne>=0);break}}}finally{_t=!1,Ne.current=G,Ee(),Error.prepareStackTrace=B}var Te=_?_.displayName||_.name:"",si=Te?de(Te):"";return typeof _=="function"&&Ge.set(_,si),si}function At(_,T,S){return mt(_,!1)}function Ie(_){var T=_.prototype;return!!(T&&T.isReactComponent)}function De(_,T,S){if(_==null)return"";if(typeof _=="function")return mt(_,Ie(_));if(typeof _=="string")return de(_);switch(_){case l:return de("Suspense");case c:return de("SuspenseList")}if(typeof _=="object")switch(_.$$typeof){case h:return At(_.render);case f:return De(_.type,T,S);case u:{var O=_,B=O._payload,G=O._init;try{return De(G(B),T,S)}catch{}}}return""}var zt=Object.prototype.hasOwnProperty,yr={},Ot=M.ReactDebugCurrentFrame;function xe(_){if(_){var T=_._owner,S=De(_.type,_._source,T?T.type:null);Ot.setExtraStackFrame(S)}else Ot.setExtraStackFrame(null)}function rn(_,T,S,O,B){{var G=Function.call.bind(zt);for(var H in _)if(G(_,H)){var V=void 0;try{if(typeof _[H]!="function"){var he=Error((O||"React class")+": "+S+" type `"+H+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof _[H]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw he.name="Invariant Violation",he}V=_[H](T,H,O,S,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Z){V=Z}V&&!(V instanceof Error)&&(xe(B),b("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",O||"React class",S,H,typeof V),xe(null)),V instanceof Error&&!(V.message in yr)&&(yr[V.message]=!0,xe(B),b("Failed %s type: %s",S,V.message),xe(null))}}}var nn=Array.isArray;function gr(_){return nn(_)}function an(_){{var T=typeof Symbol=="function"&&Symbol.toStringTag,S=T&&_[Symbol.toStringTag]||_.constructor.name||"Object";return S}}function sn(_){try{return wr(_),!1}catch{return!0}}function wr(_){return""+_}function xr(_){if(sn(_))return b("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",an(_)),wr(_)}var It=M.ReactCurrentOwner,Qr={key:!0,ref:!0,__self:!0,__source:!0},Dt,Gt,Mr;Mr={};function on(_){if(zt.call(_,"ref")){var T=Object.getOwnPropertyDescriptor(_,"ref").get;if(T&&T.isReactWarning)return!1}return _.ref!==void 0}function hn(_){if(zt.call(_,"key")){var T=Object.getOwnPropertyDescriptor(_,"key").get;if(T&&T.isReactWarning)return!1}return _.key!==void 0}function ln(_,T){if(typeof _.ref=="string"&&It.current&&T&&It.current.stateNode!==T){var S=Y(It.current.type);Mr[S]||(b('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',Y(It.current.type),_.ref),Mr[S]=!0)}}function cn(_,T){{var S=function(){Dt||(Dt=!0,b("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",T))};S.isReactWarning=!0,Object.defineProperty(_,"key",{get:S,configurable:!0})}}function Zt(_,T){{var S=function(){Gt||(Gt=!0,b("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",T))};S.isReactWarning=!0,Object.defineProperty(_,"ref",{get:S,configurable:!0})}}var vn=function(_,T,S,O,B,G,H){var V={$$typeof:t,type:_,key:T,ref:S,props:H,_owner:G};return V._store={},Object.defineProperty(V._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(V,"_self",{configurable:!1,enumerable:!1,writable:!1,value:O}),Object.defineProperty(V,"_source",{configurable:!1,enumerable:!1,writable:!1,value:B}),Object.freeze&&(Object.freeze(V.props),Object.freeze(V)),V};function fn(_,T,S,O,B){{var G,H={},V=null,he=null;S!==void 0&&(xr(S),V=""+S),hn(T)&&(xr(T.key),V=""+T.key),on(T)&&(he=T.ref,ln(T,B));for(G in T)zt.call(T,G)&&!Qr.hasOwnProperty(G)&&(H[G]=T[G]);if(_&&_.defaultProps){var Z=_.defaultProps;for(G in Z)H[G]===void 0&&(H[G]=Z[G])}if(V||he){var ne=typeof _=="function"?_.displayName||_.name||"Unknown":_;V&&cn(H,ne),he&&Zt(H,ne)}return vn(_,V,he,B,O,It.current,H)}}var Kt=M.ReactCurrentOwner,Er=M.ReactDebugCurrentFrame;function Ze(_){if(_){var T=_._owner,S=De(_.type,_._source,T?T.type:null);Er.setExtraStackFrame(S)}else Er.setExtraStackFrame(null)}var Tr;Tr=!1;function br(_){return typeof _=="object"&&_!==null&&_.$$typeof===t}function Jr(){{if(Kt.current){var _=Y(Kt.current.type);if(_)return`

Check the render method of \``+_+"`."}return""}}function ei(_){{if(_!==void 0){var T=_.fileName.replace(/^.*[\\\/]/,""),S=_.lineNumber;return`

Check your code at `+T+":"+S+"."}return""}}var ti={};function un(_){{var T=Jr();if(!T){var S=typeof _=="string"?_:_.displayName||_.name;S&&(T=`

Check the top-level render call using <`+S+">.")}return T}}function ri(_,T){{if(!_._store||_._store.validated||_.key!=null)return;_._store.validated=!0;var S=un(T);if(ti[S])return;ti[S]=!0;var O="";_&&_._owner&&_._owner!==Kt.current&&(O=" It was passed a child from "+Y(_._owner.type)+"."),Ze(_),b('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',S,O),Ze(null)}}function Ht(_,T){{if(typeof _!="object")return;if(gr(_))for(var S=0;S<_.length;S++){var O=_[S];br(O)&&ri(O,T)}else if(br(_))_._store&&(_._store.validated=!0);else if(_){var B=y(_);if(typeof B=="function"&&B!==_.entries)for(var G=B.call(_),H;!(H=G.next()).done;)br(H.value)&&ri(H.value,T)}}}function dn(_){{var T=_.type;if(T==null||typeof T=="string")return;var S;if(typeof T=="function")S=T.propTypes;else if(typeof T=="object"&&(T.$$typeof===h||T.$$typeof===f))S=T.propTypes;else return;if(S){var O=Y(T);rn(S,_.props,"prop",O,_)}else if(T.PropTypes!==void 0&&!Tr){Tr=!0;var B=Y(T);b("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",B||"Unknown")}typeof T.getDefaultProps=="function"&&!T.getDefaultProps.isReactClassApproved&&b("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Cr(_){{for(var T=Object.keys(_.props),S=0;S<T.length;S++){var O=T[S];if(O!=="children"&&O!=="key"){Ze(_),b("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",O),Ze(null);break}}_.ref!==null&&(Ze(_),b("Invalid attribute `ref` supplied to `React.Fragment`."),Ze(null))}}function Sr(_,T,S,O,B,G){{var H=W(_);if(!H){var V="";(_===void 0||typeof _=="object"&&_!==null&&Object.keys(_).length===0)&&(V+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var he=ei(B);he?V+=he:V+=Jr();var Z;_===null?Z="null":gr(_)?Z="array":_!==void 0&&_.$$typeof===t?(Z="<"+(Y(_.type)||"Unknown")+" />",V=" Did you accidentally export a JSX literal instead of a component?"):Z=typeof _,b("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Z,V)}var ne=fn(_,T,S,B,G);if(ne==null)return ne;if(H){var le=T.children;if(le!==void 0)if(O)if(gr(le)){for(var Te=0;Te<le.length;Te++)Ht(le[Te],_);Object.freeze&&Object.freeze(le)}else b("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Ht(le,_)}return _===i?Cr(ne):dn(ne),ne}}function ii(_,T,S){return Sr(_,T,S,!0)}function ni(_,T,S){return Sr(_,T,S,!1)}var ai=ni,Pr=ii;_r.Fragment=i,_r.jsx=ai,_r.jsxs=Pr}()),_r}process.env.NODE_ENV==="production"?en.exports=e0():en.exports=t0();var pt=en.exports,r0={controls:{mouseViewMode:"drag",scrollZoom:!0}};function uo(e){var t=e.viewerOpts,r=t===void 0?r0:t,i=ae.useRef(null),n=ae.useState(null),a=n[0],s=n[1];return ae.useEffect(function(){if(i.current&&!a){var o=new we.Viewer(i.current,r);s(o)}},[a,r]),{viewerRef:i,viewer:a}}var i0={viewerRef:null,viewer:null},po=ae.createContext(i0),n0=function(){return ae.useContext(po)};function _o(e){var t=e.children,r=e.opts,i=e.className,n=e.style,a=e.onLoaded,s=uo({viewerOpts:r}),o=s.viewerRef,h=s.viewer;return ae.useEffect(function(){!o.current||!h||a&&a(h)},[]),pt.jsx("div",Ut({ref:o,className:i,style:n},{children:pt.jsx(po.Provider,Ut({value:{viewerRef:o,viewer:h}},{children:t}))}))}var mo=ae.createContext({setSource:function(){},setGeometry:function(){},setView:function(){}}),mr=function(){return ae.useContext(mo)};function yo(e){var t=e.children,r=e.pinFirstLevel,i=r===void 0?!0:r,n=e.onLoaded,a=n0(),s=a.viewerRef,o=a.viewer,h=ae.useState(null),l=h[0],c=h[1],f=ae.useState(null),u=f[0],p=f[1],m=ae.useState(null),x=m[0],y=m[1];return ae.useEffect(function(){if(!(!s||!o||!l||!u||!x)){var M=o.createScene({source:l,geometry:u,view:x,pinFirstLevel:i});M.switchTo(),n&&n(M)}},[s,o,n]),pt.jsx(mo.Provider,Ut({value:{setSource:c,setGeometry:p,setView:y}},{children:t}))}function a0(e){var t=e.source,r=e.options,i=mr().setSource;return ae.useEffect(function(){i(typeof t=="string"?we.ImageUrlSource.fromString(t,r):new we.ImageUrlSource(t,r))},[t,r,i]),null}function go(e){var t=e.asset,r=mr().setSource;return ae.useEffect(function(){r(new we.SingleAssetSource(t))},[t,r]),null}var s0={cube:we.CubeGeometry,equirect:we.EquirectGeometry,flat:we.FlatGeometry};function Gr(e){var t=e.type,r=e.levelPropertiesList,i=mr().setGeometry;ae.useEffect(function(){var n=new s0[t](r);i(n)},[r,i])}function wo(e){var t=e.levelPropertiesList;return Gr({type:"equirect",levelPropertiesList:t}),null}function o0(e){var t=e.levelPropertiesList;return Gr({type:"flat",levelPropertiesList:t}),null}function h0(e){var t=e.levelPropertiesList;return Gr({type:"cube",levelPropertiesList:t}),null}function xo(e){var t=e.params,r=e.limiters,i=mr().setView;return ae.useEffect(function(){var n=null;r&&(n=we.util.compose.apply(we.util,r(we.RectilinearView.limit)));var a=new we.RectilinearView(t,n??void 0);i(a)},[t,r,i]),null}function l0(e){var t=e.params,r=e.limiters,i=mr().setView;return ae.useEffect(function(){var n=null;r&&(n=we.util.compose.apply(we.util,r(we.FlatView.limit)));var a=new we.FlatView(t??{},n??void 0);i(a)},[t,r,i]),null}var Mo=function(){function e(t){Object.defineProperty(this,"_videoElement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_destroyed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_emitChange",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_lastTimestamp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_emptyCanvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_emitChangeIfPlayingLoop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._videoElement=null,this._destroyed=!1,this._emitChange=this.emit.bind(this,"change"),this._lastTimestamp=-1,this._emptyCanvas=document.createElement("canvas"),this._emptyCanvas.width=1,this._emptyCanvas.height=1,t&&this.setVideo(t)}return Object.defineProperty(e.prototype,"setVideo",{enumerable:!1,configurable:!0,writable:!0,value:function(t){var r=this;if(this._videoElement&&this._videoElement.removeEventListener("timeupdate",this._emitChange),this._videoElement=t,!this._videoElement)return;this._videoElement.addEventListener("timeupdate",this._emitChange),this._emitChangeIfPlayingLoop&&(cancelAnimationFrame(this._emitChangeIfPlayingLoop),this._emitChangeIfPlayingLoop=null);function i(){r._videoElement&&!r._videoElement.paused&&r.emit("change"),r._destroyed||(r._emitChangeIfPlayingLoop=requestAnimationFrame(i))}i(),this.emit("change")}}),Object.defineProperty(e.prototype,"width",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._videoElement?this._videoElement.videoWidth:this._emptyCanvas.width}}),Object.defineProperty(e.prototype,"height",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._videoElement?this._videoElement.videoHeight:this._emptyCanvas.height}}),Object.defineProperty(e.prototype,"element",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._videoElement?this._videoElement:this._emptyCanvas}}),Object.defineProperty(e.prototype,"isDynamic",{enumerable:!1,configurable:!0,writable:!0,value:function(){return!0}}),Object.defineProperty(e.prototype,"timestamp",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._videoElement&&(this._lastTimestamp=this._videoElement.currentTime),this._lastTimestamp}}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._destroyed=!0,this._videoElement&&this._videoElement.removeEventListener("timeupdate",this._emitChange),this._emitChangeIfPlayingLoop&&(cancelAnimationFrame(this._emitChangeIfPlayingLoop),this._emitChangeIfPlayingLoop=null)}}),Object.defineProperty(e.prototype,"addEventListener",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){var i=this.__events=this.__events||{},n=i[t]=i[t]||[];n.push(r)}}),Object.defineProperty(e.prototype,"removeEventListener",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){var i=this.__events=this.__events||{},n=i[t];if(n){var a=n.indexOf(r);a>=0&&n.splice(a,1)}}}),Object.defineProperty(e.prototype,"emit",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r,i,n,a,s){var o=this.__events=this.__events||{},h=o[t];if(h)for(var l=0;l<h.length;l++){var c=h[l];c.call(this,r,i,n,a,s)}}}),e}();function Eo(e,t,r,i){var n=setInterval(function(){e.readyState>=t&&(clearInterval(n),i(null,!0))},r)}function c0(e){var t=e.source,r=e.className,i=e.style,n=e.levelPropertiesList,a=n===void 0?[{width:1}]:n,s=e.params,o=s===void 0?{fov:Math.PI/2}:s,h=e.limiters,l=h===void 0?function(f){return[f.vfov(90*Math.PI/180,90*Math.PI/180)]}:h,c=ae.useMemo(function(){if(!t)return null;var f=new Mo,u=document.createElement("video");return u.src=t,u.playsInline=!0,u.crossOrigin="anonymous",u.muted=!0,u.load(),u.play(),Eo(u,u.HAVE_METADATA,100,function(){Eo(u,u.HAVE_ENOUGH_DATA,100,function(){f.setVideo(u)})}),f},[t]);return c?pt.jsx(_o,Ut({className:r,style:i},{children:pt.jsxs(yo,{children:[pt.jsx(go,{asset:c}),pt.jsx(wo,{levelPropertiesList:a}),pt.jsx(xo,{params:o,limiters:l})]})})):null}ve.CubeGeometry=h0,ve.EquirectGeometry=wo,ve.FlatGeometry=o0,ve.FlatView=l0,ve.ImageUrlSource=a0,ve.Marzipano=J1,ve.RectilinearView=xo,ve.Scene=yo,ve.SingleAssetSource=go,ve.VideoAsset=Mo,ve.VideoViewer=c0,ve.Viewer=_o,ve.useCreateGeometry=Gr,ve.useViewer=uo,Object.defineProperty(ve,Symbol.toStringTag,{value:"Module"})});
